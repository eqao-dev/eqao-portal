<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>授業書類 - EQAO PORTAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/nav-menu.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f8f9fc 0%, #e8ecf4 100%);
      min-height: 100vh;
      padding-bottom: 40px;
    }

    /* ヘッダー */
    .header {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 4px 20px rgba(26, 35, 126, 0.3);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
      text-decoration: none;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 2px;
      flex: 1;
    }

    .hamburger-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px;
    }

    /* ===== テーマ一覧ビュー ===== */
    .list-view {
      display: block;
    }

    .list-view.hidden {
      display: none;
    }

    /* 説明セクション */
    .intro-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .intro-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .intro-title .material-icons {
      font-size: 24px;
    }

    /* 説明テキスト */
    .intro-description {
      margin-bottom: 20px;
      padding: 0 4px;
    }

    .intro-description p {
      font-size: 14px;
      color: #444;
      line-height: 1.8;
      margin-bottom: 8px;
    }

    .intro-description p:last-child {
      margin-bottom: 0;
    }

    /* 三点セット */
    .three-set {
      background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
    }

    .three-set-title {
      font-size: 13px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .three-set-title .material-icons {
      font-size: 18px;
    }

    .three-set-items {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .three-set-item {
      display: flex;
      align-items: center;
      gap: 10px;
      background: white;
      padding: 10px 16px;
      border-radius: 10px;
      flex: 1;
      min-width: 140px;
      max-width: 180px;
    }

    .three-set-item .material-icons {
      font-size: 28px;
      color: #1a237e;
    }

    .three-set-item .item-text {
      display: flex;
      flex-direction: column;
    }

    .three-set-item .item-text strong {
      font-size: 14px;
      color: #333;
    }

    .three-set-item .item-text span {
      font-size: 11px;
      color: #666;
    }

    /* 学習サイクル */
    .learning-cycle {
      background: #f5f7fa;
      border-radius: 12px;
      padding: 16px 20px;
    }

    .cycle-title {
      font-size: 13px;
      font-weight: 700;
      color: #666;
      margin-bottom: 12px;
      text-align: center;
    }

    .cycle-flow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .cycle-step {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 600;
    }

    .cycle-step.step-input {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      color: #1565c0;
    }

    .cycle-step.step-output {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      color: #e65100;
    }

    .cycle-step.step-redo {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      color: #2e7d32;
    }

    .cycle-step .material-icons {
      font-size: 20px;
    }

    .cycle-text {
      display: flex;
      flex-direction: column;
    }

    .cycle-text strong {
      font-size: 13px;
    }

    .cycle-text span {
      font-size: 10px;
      opacity: 0.8;
    }

    .cycle-arrow {
      color: #bdbdbd;
      font-size: 20px;
    }

    .cycle-note {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 10px 12px;
      background: #fff8e1;
      border-radius: 8px;
      font-size: 12px;
      color: #f57c00;
      line-height: 1.5;
    }

    .cycle-note .material-icons {
      font-size: 18px;
      flex-shrink: 0;
    }

    /* 詳細説明セクション */
    .detail-intro-section {
      background: white;
      border-radius: 16px;
      padding: 20px 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .detail-intro-title {
      font-size: 14px;
      font-weight: 700;
      color: #666;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .detail-intro-title .material-icons {
      font-size: 20px;
      color: #1a237e;
    }

    .detail-flow {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 16px;
    }

    .detail-flow-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      background: #f5f7fa;
      color: #555;
    }

    .detail-flow-item .material-icons {
      font-size: 16px;
    }

    .detail-flow-arrow {
      color: #ccc;
      font-size: 16px;
    }

    .detail-steps {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .detail-step {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      font-size: 13px;
      color: #444;
      line-height: 1.5;
    }

    .detail-step-number {
      width: 20px;
      height: 20px;
      background: #1a237e;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* テーマカード */
    .theme-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .theme-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      cursor: pointer;
      transition: all 0.3s;
    }

    .theme-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    }

    .theme-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .theme-card.disabled:hover {
      transform: none;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .theme-card-inner {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
    }

    .theme-number {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: white;
      flex-shrink: 0;
    }

    .theme-info {
      flex: 1;
      min-width: 0;
    }

    .theme-title {
      font-size: 15px;
      font-weight: 700;
      color: #333;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .theme-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 12px;
      font-weight: 600;
    }

    .status-badge .material-icons {
      font-size: 14px;
    }

    .status-badge.not-started {
      background: #f5f5f5;
      color: #9e9e9e;
    }

    .status-badge.in-progress {
      background: #fff3e0;
      color: #e65100;
    }

    .status-badge.quiz-ready {
      background: #e3f2fd;
      color: #1565c0;
    }

    .status-badge.completed {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .status-badge.coming-soon {
      background: #fafafa;
      color: #bdbdbd;
    }

    .theme-arrow {
      color: #ccc;
      font-size: 24px;
    }

    /* ===== テーマ詳細ビュー ===== */
    .detail-view {
      display: none;
    }

    .detail-view.active {
      display: block;
    }

    /* 詳細ヘッダー */
    .detail-header {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .detail-theme-info {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .detail-theme-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }

    /* プログレスステップ */
    .progress-steps {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 0;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #e0e0e0;
      color: #9e9e9e;
      font-size: 20px;
      transition: all 0.3s;
    }

    .step-circle.active {
      background: #1a237e;
      color: white;
    }

    .step-circle.completed {
      background: #4caf50;
      color: white;
    }

    .step-label {
      font-size: 11px;
      font-weight: 600;
      color: #9e9e9e;
    }

    .step-label.active {
      color: #1a237e;
    }

    .step-label.completed {
      color: #4caf50;
    }

    .step-line {
      width: 40px;
      height: 3px;
      background: #e0e0e0;
      margin-bottom: 20px;
    }

    .step-line.completed {
      background: #4caf50;
    }

    /* ===== チェックリストセクション ===== */
    .checklist-section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: #333;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title .material-icons {
      color: #1a237e;
    }

    .checklist-progress {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #f5f7fa;
      border-radius: 10px;
    }

    .progress-bar-container {
      flex: 1;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #1a237e, #3949ab);
      border-radius: 4px;
      transition: width 0.3s;
    }

    .progress-text {
      font-size: 14px;
      font-weight: 700;
      color: #1a237e;
      white-space: nowrap;
    }

    /* セグメントフィルタータブ */
    .segment-filter {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    .segment-tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: #f5f7fa;
      color: #666;
      border: none;
    }

    .segment-tab:hover {
      background: #e8eaf6;
      color: #1a237e;
    }

    .segment-tab.active {
      background: #1a237e;
      color: white;
    }

    /* セグメント */
    .segment-group {
      margin-bottom: 20px;
    }

    .segment-group.hidden {
      display: none;
    }

    .segment-header {
      background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 12px;
    }

    .segment-title {
      font-size: 14px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .segment-title .segment-number {
      background: #1a237e;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .segment-description {
      font-size: 12px;
      color: #5c6bc0;
      line-height: 1.4;
    }

    .checklist-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* チェックリストアイテム */
    .checklist-item {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .checklist-item:hover {
      border-color: #1a237e;
      box-shadow: 0 2px 8px rgba(26, 35, 126, 0.1);
    }

    .checklist-item.checked {
      background: #e8f5e9;
      border-color: #4caf50;
    }

    .item-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      cursor: pointer;
    }

    .check-box {
      width: 24px;
      height: 24px;
      border: 2px solid #ccc;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .checklist-item.checked .check-box {
      background: #4caf50;
      border-color: #4caf50;
      color: white;
    }

    .check-box .material-icons {
      font-size: 18px;
      opacity: 0;
    }

    .checklist-item.checked .check-box .material-icons {
      opacity: 1;
    }

    .item-title {
      flex: 1;
      font-size: 14px;
      color: #333;
      line-height: 1.4;
      font-weight: 500;
    }

    .item-toggle {
      color: #999;
      font-size: 20px;
      transition: transform 0.3s;
    }

    .checklist-item.expanded .item-toggle {
      transform: rotate(180deg);
    }

    /* 詳細コンテンツ */
    .item-detail {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      background: #fafafa;
      border-top: 1px solid #eee;
    }

    .checklist-item.expanded .item-detail {
      max-height: 1000px;
    }

    .item-detail-content {
      padding: 16px;
      font-size: 13px;
      color: #444;
      line-height: 1.8;
    }

    .item-detail-content strong {
      color: #1a237e;
    }

    /* 小テストへボタン */
    .to-quiz-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #1a237e, #3949ab);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
      margin-top: 16px;
    }

    .to-quiz-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(26, 35, 126, 0.4);
    }

    .to-quiz-btn:disabled {
      background: #e0e0e0;
      color: #9e9e9e;
      cursor: not-allowed;
    }

    /* ===== 小テストセクション ===== */
    .quiz-section {
      display: none;
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .quiz-section.active {
      display: block;
    }

    .quiz-info {
      background: #e3f2fd;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 20px;
    }

    .quiz-info p {
      font-size: 14px;
      color: #1565c0;
      line-height: 1.6;
    }

    .quiz-question {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid #eee;
    }

    .quiz-question:last-of-type {
      border-bottom: none;
    }

    .question-number {
      font-size: 12px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 8px;
    }

    .question-text {
      font-size: 15px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      border-color: #1a237e;
      background: #f8f9fc;
    }

    .quiz-option.selected {
      border-color: #1a237e;
      background: #e8eaf6;
    }

    .quiz-option.correct {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    .quiz-option.incorrect {
      border-color: #f44336;
      background: #ffebee;
    }

    .option-marker {
      width: 28px;
      height: 28px;
      border: 2px solid #ccc;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .quiz-option.selected .option-marker {
      background: #1a237e;
      border-color: #1a237e;
      color: white;
    }

    .quiz-option.correct .option-marker {
      background: #4caf50;
      border-color: #4caf50;
      color: white;
    }

    .quiz-option.incorrect .option-marker {
      background: #f44336;
      border-color: #f44336;
      color: white;
    }

    .option-text {
      flex: 1;
      font-size: 14px;
      color: #333;
      line-height: 1.5;
    }

    .explanation {
      display: none;
      margin-top: 12px;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 8px;
      font-size: 13px;
      color: #666;
      line-height: 1.6;
    }

    .explanation.show {
      display: block;
    }

    .submit-quiz-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #e65100, #f57c00);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .submit-quiz-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(230, 81, 0, 0.4);
    }

    .submit-quiz-btn:disabled {
      background: #e0e0e0;
      color: #9e9e9e;
      cursor: not-allowed;
    }

    /* 結果表示 */
    .quiz-result {
      display: none;
      text-align: center;
      padding: 24px;
    }

    .quiz-result.show {
      display: block;
    }

    .result-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }

    .result-icon.pass {
      color: #4caf50;
    }

    .result-icon.fail {
      color: #f44336;
    }

    .result-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .result-title.pass {
      color: #4caf50;
    }

    .result-title.fail {
      color: #f44336;
    }

    .result-score {
      font-size: 18px;
      color: #666;
      margin-bottom: 20px;
    }

    .result-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .result-btn {
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
      text-decoration: none;
    }

    .btn-output {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
    }

    .btn-retry {
      background: #f5f5f5;
      color: #333;
    }

    .btn-back {
      background: transparent;
      color: #666;
      text-decoration: underline;
    }

    /* ===== ローディング ===== */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-spinner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: #1a237e;
    }

    .loading-spinner .material-icons {
      font-size: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* レスポンシブ */
    @media (max-width: 600px) {
      .progress-steps {
        transform: scale(0.9);
      }

      .theme-title {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .header {
        padding: 12px 14px;
        gap: 12px;
      }

      .back-btn {
        width: 36px;
        height: 36px;
      }

      .header-title {
        font-size: 15px;
        letter-spacing: 1px;
      }

      .hamburger-btn {
        width: 36px;
        height: 36px;
      }

      .container {
        padding: 16px 12px;
      }

      .intro-section {
        padding: 18px;
      }

      .intro-title {
        font-size: 15px;
      }

      .three-set-item {
        padding: 12px;
      }
    }

    @media (max-width: 360px) {
      .header {
        padding: 10px 12px;
        gap: 10px;
      }

      .back-btn {
        width: 32px;
        height: 32px;
      }

      .header-title {
        font-size: 14px;
        letter-spacing: 0;
      }

      .hamburger-btn {
        width: 34px;
        height: 34px;
      }
    }
  </style>
</head>

<body>
  <!-- ヘッダー -->
  <div class="header">
    <a href="index.html" class="back-btn" id="backBtn">
      <span class="material-icons">arrow_back</span>
    </a>
    <div class="header-title" id="headerTitle">授業書類</div>
    <button class="hamburger-btn" onclick="openNav()">
      <span class="material-icons">menu</span>
    </button>
  </div>

  <div class="container">
    <!-- ===== テーマ一覧ビュー ===== -->
    <div class="list-view" id="listView">
      <!-- メイン説明 -->
      <div class="intro-section">
        <div class="intro-title">
          <span class="material-icons">school</span>
          この教材について
        </div>

        <div class="intro-description">
          <p>この教材は<strong>「本質を理解してから実践する」</strong>という考え方に基づいて作られています。</p>
          <p>総合型選抜・推薦入試で求められるのは、テクニックではなく<strong>「なぜそうするのか」を理解した上での行動</strong>です。</p>
        </div>

        <!-- 三点セット -->
        <div class="three-set">
          <div class="three-set-title">
            <span class="material-icons">auto_awesome</span>
            必ず「読む・見る・書く」の三点セットで取り組もう
          </div>
          <div class="three-set-items">
            <div class="three-set-item">
              <span class="material-icons">menu_book</span>
              <div class="item-text">
                <strong>読む</strong>
                <span>コラムで考え方を学ぶ</span>
              </div>
            </div>
            <div class="three-set-item">
              <span class="material-icons">play_circle</span>
              <div class="item-text">
                <strong>見る</strong>
                <span>動画で具体例を確認</span>
              </div>
            </div>
            <div class="three-set-item">
              <span class="material-icons">edit</span>
              <div class="item-text">
                <strong>書く</strong>
                <span>実際に手を動かす</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 学習サイクル -->
        <div class="learning-cycle">
          <div class="cycle-title">学習の流れ</div>
          <div class="cycle-flow">
            <div class="cycle-step step-input">
              <span class="material-icons">menu_book</span>
              <div class="cycle-text">
                <strong>インプット</strong>
                <span>理解・習得</span>
              </div>
            </div>
            <span class="material-icons cycle-arrow">arrow_forward</span>
            <div class="cycle-step step-output">
              <span class="material-icons">edit_note</span>
              <div class="cycle-text">
                <strong>アウトプット</strong>
                <span>実践・演習</span>
              </div>
            </div>
            <span class="material-icons cycle-arrow">arrow_forward</span>
            <div class="cycle-step step-redo">
              <span class="material-icons">refresh</span>
              <div class="cycle-text">
                <strong>リドゥ</strong>
                <span>再学習・改善</span>
              </div>
            </div>
          </div>
          <div class="cycle-note">
            <span class="material-icons">lightbulb</span>
            <span>アウトプットで「できない」と感じたら、インプットに戻って復習しよう。この繰り返しが力になる！</span>
          </div>
        </div>
      </div>

      <!-- 詳細説明 -->
      <div class="detail-intro-section">
        <div class="detail-intro-title">
          <span class="material-icons">help_outline</span>
          各テーマの進め方
        </div>

        <div class="detail-flow">
          <div class="detail-flow-item">
            <span class="material-icons">checklist</span>
            チェックリスト
          </div>
          <span class="material-icons detail-flow-arrow">arrow_forward</span>
          <div class="detail-flow-item">
            <span class="material-icons">quiz</span>
            小テスト
          </div>
          <span class="material-icons detail-flow-arrow">arrow_forward</span>
          <div class="detail-flow-item">
            <span class="material-icons">lock_open</span>
            アウトプット解放
          </div>
        </div>

        <div class="detail-steps">
          <div class="detail-step">
            <span class="detail-step-number">1</span>
            <span>テーマを選んで<strong>チェックリスト</strong>の項目を全て確認（コラム・動画をチェック）</span>
          </div>
          <div class="detail-step">
            <span class="detail-step-number">2</span>
            <span><strong>小テスト</strong>（10問）で80%以上正解して理解度を確認</span>
          </div>
          <div class="detail-step">
            <span class="detail-step-number">3</span>
            <span><strong>アウトプット</strong>が解放！実践ワークに取り組もう</span>
          </div>
        </div>
      </div>

      <!-- テーマ一覧 -->
      <div class="theme-grid" id="themeGrid">
        <!-- JavaScriptで生成 -->
      </div>
    </div>

    <!-- ===== テーマ詳細ビュー ===== -->
    <div class="detail-view" id="detailView">
      <!-- 詳細ヘッダー -->
      <div class="detail-header">
        <div class="detail-theme-info">
          <div class="theme-number" id="detailThemeNumber">1</div>
          <div class="detail-theme-title" id="detailThemeTitle">テーマタイトル</div>
        </div>

        <!-- プログレスステップ -->
        <div class="progress-steps">
          <div class="progress-step">
            <div class="step-circle" id="step1Circle">
              <span class="material-icons">checklist</span>
            </div>
            <div class="step-label" id="step1Label">チェック</div>
          </div>
          <div class="step-line" id="stepLine1"></div>
          <div class="progress-step">
            <div class="step-circle" id="step2Circle">
              <span class="material-icons">quiz</span>
            </div>
            <div class="step-label" id="step2Label">小テスト</div>
          </div>
          <div class="step-line" id="stepLine2"></div>
          <div class="progress-step">
            <div class="step-circle" id="step3Circle">
              <span class="material-icons">edit_note</span>
            </div>
            <div class="step-label" id="step3Label">アウトプット</div>
          </div>
        </div>
      </div>

      <!-- チェックリストセクション -->
      <div class="checklist-section" id="checklistSection">
        <div class="section-title">
          <span class="material-icons">checklist</span>
          インプットチェックリスト
        </div>

        <div class="checklist-progress">
          <div class="progress-bar-container">
            <div class="progress-bar-fill" id="checklistProgressBar" style="width: 0%"></div>
          </div>
          <div class="progress-text" id="checklistProgressText">0 / 15</div>
        </div>

        <!-- セグメントフィルター -->
        <div class="segment-filter" id="segmentFilter">
          <!-- JavaScriptで生成 -->
        </div>

        <div id="checklistContent">
          <!-- JavaScriptで生成 -->
        </div>

        <button class="to-quiz-btn" id="toQuizBtn" disabled onclick="showQuizSection()">
          <span class="material-icons">quiz</span>
          小テストに進む
        </button>
      </div>

      <!-- 小テストセクション -->
      <div class="quiz-section" id="quizSection">
        <div class="section-title">
          <span class="material-icons">quiz</span>
          理解度チェックテスト
        </div>

        <div class="quiz-info">
          <p>
            <strong>合格条件：10問中8問以上正解（80%）</strong><br>
            不合格の場合は何度でも再挑戦できます。
          </p>
        </div>

        <div id="quizContent">
          <!-- JavaScriptで生成 -->
        </div>

        <button class="submit-quiz-btn" id="submitQuizBtn" disabled onclick="submitQuiz()">
          <span class="material-icons">send</span>
          回答を提出する
        </button>

        <!-- 結果表示 -->
        <div class="quiz-result" id="quizResult">
          <span class="material-icons result-icon" id="resultIcon">emoji_events</span>
          <div class="result-title" id="resultTitle">合格！</div>
          <div class="result-score" id="resultScore">10問中 8問正解</div>
          <div class="result-actions" id="resultActions">
            <!-- JavaScriptで生成 -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ローディング -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <span class="material-icons">sync</span>
      <span>読み込み中...</span>
    </div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyXdCxzPU6oXAm2Mi9mfMDeNvQAyE0mmTOABA2EOYelvX6J2Rr48VcizS0vMgIS7Qc7/exec';

    let currentUser = null;
    let currentThemeId = null;
    let themeProgressData = {};
    let inputItems = [];
    let checkedItems = [];
    let quizQuestions = [];
    let selectedAnswers = {};

    // テーマ定義（テーマ2を有効化）
    const themes = [
      { id: 1, title: '総合型選抜の本質と基礎原則', outputPage: 'output-01-sougoukosen.html', inputPage: 'input-01-sougoukosen.html', available: false },
      { id: 2, title: '「すき」を見つけ、伸ばし、学問に繋げる', outputPage: 'output-02-suki.html', inputPage: 'input-02-suki.html', available: true },
      { id: 3, title: '併願校／志望校戦略の本質理解', outputPage: null, externalLink: 'exam-schedule.html', available: false },
      { id: 4, title: '志望理由書の本質理解から実践', outputPage: 'output-04-shibouriyuu.html', available: false },
      { id: 5, title: '自己推薦書の本質理解から実践', outputPage: 'output-05-jikosuisen.html', available: false },
      { id: 6, title: 'レポートの本質理解から実践', outputPage: 'output-06-report.html', available: false },
      { id: 7, title: '小論文の本質理解から実践', outputPage: 'output-07-shouronbun.html', available: false },
      { id: 8, title: '面接の本質理解から実践', outputPage: 'output-08-mensetsu.html', available: false },
      { id: 9, title: 'プレゼンテーションの本質理解から実践', outputPage: 'output-09-presen.html', available: false }
    ];

    // ===== 初期化 =====
    document.addEventListener('DOMContentLoaded', async function () {
      const loggedIn = localStorage.getItem('eqao_loggedIn');
      if (!loggedIn) {
        localStorage.setItem('eqao_returnUrl', location.href);
        window.location.href = 'login.html';
        return;
      }

      currentUser = {
        studentId: localStorage.getItem('eqao_studentId'),
        studentName: localStorage.getItem('eqao_studentName')
      };

      // 全テーマの進捗を取得
      await loadAllProgress();

      // テーマ一覧を描画
      renderThemeList();

      document.getElementById('loadingOverlay').style.display = 'none';
    });

    // ===== 全テーマ進捗取得 =====
    async function loadAllProgress() {
      for (const theme of themes) {
        if (!theme.available) continue;

        try {
          const res = await fetch(`${API_URL}?action=getThemeProgress&studentId=${currentUser.studentId}&themeId=${theme.id}`);
          const result = await res.json();
          if (result.success) {
            themeProgressData[theme.id] = result;
          }
        } catch (error) {
          console.error(`テーマ${theme.id}の進捗取得エラー:`, error);
        }
      }
    }

    // ===== テーマ一覧描画 =====
    function renderThemeList() {
      const container = document.getElementById('themeGrid');

      container.innerHTML = themes.map(theme => {
        const progress = themeProgressData[theme.id] || {};
        let statusBadge = '';
        let statusClass = '';

        if (!theme.available) {
          statusBadge = '<span class="status-badge coming-soon"><span class="material-icons">schedule</span>準備中</span>';
          statusClass = 'disabled';
        } else if (progress.status === 'quiz_passed') {
          statusBadge = '<span class="status-badge completed"><span class="material-icons">check_circle</span>完了</span>';
        } else if (progress.status === 'input_completed' || progress.status === 'quiz_failed') {
          statusBadge = '<span class="status-badge quiz-ready"><span class="material-icons">quiz</span>小テストへ</span>';
        } else if (progress.status === 'input_in_progress') {
          const checked = progress.inputProgress?.checkedCount || progress.inputProgress?.checkedItems?.length || 0;
          const total = progress.inputProgress?.totalItems || 15;
          statusBadge = `<span class="status-badge in-progress"><span class="material-icons">pending</span>学習中 (${checked}/${total})</span>`;
        } else {
          statusBadge = '<span class="status-badge not-started"><span class="material-icons">radio_button_unchecked</span>未着手</span>';
        }

        return `
          <div class="theme-card ${statusClass}" data-theme-id="${theme.id}" onclick="${theme.available ? `openTheme(${theme.id})` : ''}">
            <div class="theme-card-inner">
              <div class="theme-number">${theme.id}</div>
              <div class="theme-info">
                <div class="theme-title">${theme.title}</div>
                <div class="theme-status">${statusBadge}</div>
              </div>
              <span class="material-icons theme-arrow">${theme.available ? 'chevron_right' : ''}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // ===== テーマを開く =====
    async function openTheme(themeId) {
      const theme = themes.find(t => t.id === themeId);

      // inputPageが設定されている場合は直接遷移
      if (theme.inputPage) {
        window.location.href = theme.inputPage;
        return;
      }

      // 従来の詳細ビュー表示（テーマ1など）
      currentThemeId = themeId;

      document.getElementById('loadingOverlay').style.display = 'flex';

      // ヘッダー更新
      document.getElementById('headerTitle').textContent = `テーマ ${themeId}`;
      document.getElementById('backBtn').onclick = (e) => { e.preventDefault(); closeTheme(); };

      // 詳細情報設定
      document.getElementById('detailThemeNumber').textContent = themeId;
      document.getElementById('detailThemeTitle').textContent = theme.title;

      // データ取得
      await loadThemeData(themeId);

      // ビュー切り替え
      document.getElementById('listView').classList.add('hidden');
      document.getElementById('detailView').classList.add('active');

      document.getElementById('loadingOverlay').style.display = 'none';
    }

    // ===== テーマを閉じる =====
    function closeTheme() {
      currentThemeId = null;

      document.getElementById('headerTitle').textContent = '授業書類';
      document.getElementById('backBtn').href = 'index.html';
      document.getElementById('backBtn').onclick = null;

      document.getElementById('listView').classList.remove('hidden');
      document.getElementById('detailView').classList.remove('active');

      // 小テストセクションをリセット
      document.getElementById('quizSection').classList.remove('active');
      document.getElementById('quizResult').classList.remove('show');
      document.getElementById('quizContent').style.display = 'block';
      document.getElementById('submitQuizBtn').style.display = 'flex';

      // 進捗を再取得して一覧更新
      loadAllProgress().then(() => renderThemeList());
    }

    // ===== テーマデータ取得 =====
    async function loadThemeData(themeId) {
      try {
        // 進捗取得
        const progressRes = await fetch(`${API_URL}?action=getThemeProgress&studentId=${currentUser.studentId}&themeId=${themeId}`);
        const progressResult = await progressRes.json();

        if (progressResult.success) {
          themeProgressData[themeId] = progressResult;
          checkedItems = progressResult.inputProgress?.checkedItems || [];
        }

        // インプット項目取得
        const itemsRes = await fetch(`${API_URL}?action=getInputItems&themeId=${themeId}`);
        const itemsResult = await itemsRes.json();

        if (itemsResult.success) {
          inputItems = itemsResult.items;
        }

        // チェックリスト描画
        renderChecklist();
        updateProgressSteps();

        // 小テスト合格済みならアウトプット画面を表示
        if (progressResult.status === 'quiz_passed') {
          showCompletedState();
        }

      } catch (error) {
        console.error('データ取得エラー:', error);
        alert('データの取得に失敗しました');
      }
    }

    // ===== セグメントフィルター用の状態 =====
    let currentSegmentFilter = 'ALL';

    // ===== チェックリスト描画 =====
    function renderChecklist() {
      const container = document.getElementById('checklistContent');
      const filterContainer = document.getElementById('segmentFilter');

      // セグメントでグループ化（順序を保持）
      const segmentOrder = [];
      const segments = {};
      const segmentDescriptions = {};

      inputItems.forEach(item => {
        if (!segments[item.segment]) {
          segments[item.segment] = [];
          segmentOrder.push(item.segment);
          segmentDescriptions[item.segment] = item.segmentDescription || '';
        }
        segments[item.segment].push(item);
      });

      // セグメントフィルタータブを生成
      let filterHtml = `<button class="segment-tab ${currentSegmentFilter === 'ALL' ? 'active' : ''}" onclick="filterSegment('ALL')">すべて</button>`;
      segmentOrder.forEach(segment => {
        filterHtml += `<button class="segment-tab ${currentSegmentFilter === segment ? 'active' : ''}" onclick="filterSegment('${segment}')">${segment}</button>`;
      });
      filterContainer.innerHTML = filterHtml;

      // チェックリストを生成
      let html = '';
      segmentOrder.forEach(segment => {
        const items = segments[segment];
        const description = segmentDescriptions[segment];
        const isHidden = currentSegmentFilter !== 'ALL' && currentSegmentFilter !== segment;

        html += `
          <div class="segment-group ${isHidden ? 'hidden' : ''}" data-segment="${segment}">
            <div class="segment-header">
              <div class="segment-title">
                <span class="segment-number">${segment}</span>
                ${description}
              </div>
            </div>
            <div class="checklist-items">
              ${items.map(item => {
          const isChecked = checkedItems.includes(item.itemId);
          const hasDetail = item.detail && item.detail.trim() !== '';
          return `
                  <div class="checklist-item ${isChecked ? 'checked' : ''}" data-item-id="${item.itemId}">
                    <div class="item-header">
                      <div class="check-box" onclick="event.stopPropagation(); toggleCheckItem(${item.itemId})">
                        <span class="material-icons">check</span>
                      </div>
                      <div class="item-title" onclick="toggleItemDetail(${item.itemId})">${item.title}</div>
                      ${hasDetail ? `<span class="material-icons item-toggle" onclick="toggleItemDetail(${item.itemId})">expand_more</span>` : ''}
                    </div>
                    ${hasDetail ? `
                      <div class="item-detail">
                        <div class="item-detail-content">${formatDetailText(item.detail)}</div>
                      </div>
                    ` : ''}
                  </div>
                `;
        }).join('')}
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
      updateChecklistProgress();
    }

    // ===== 詳細テキストのフォーマット =====
    function formatDetailText(text) {
      if (!text) return '';
      return text
        .replace(/■/g, '<br><strong>■')
        .replace(/（(\d)）/g, '</strong><br>（$1）')
        .replace(/\n/g, '<br>');
    }

    // ===== セグメントフィルター =====
    function filterSegment(segment) {
      currentSegmentFilter = segment;

      document.querySelectorAll('.segment-tab').forEach(tab => {
        tab.classList.remove('active');
        if ((segment === 'ALL' && tab.textContent === 'すべて') || tab.textContent === segment) {
          tab.classList.add('active');
        }
      });

      document.querySelectorAll('.segment-group').forEach(group => {
        if (segment === 'ALL' || group.dataset.segment === segment) {
          group.classList.remove('hidden');
        } else {
          group.classList.add('hidden');
        }
      });
    }

    // ===== 詳細のアコーディオン切り替え =====
    function toggleItemDetail(itemId) {
      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      if (item) {
        item.classList.toggle('expanded');
      }
    }

    // ===== チェック切り替え =====
    async function toggleCheckItem(itemId) {
      const index = checkedItems.indexOf(itemId);
      if (index > -1) {
        checkedItems.splice(index, 1);
      } else {
        checkedItems.push(itemId);
      }

      const item = document.querySelector(`[data-item-id="${itemId}"]`);
      if (item) {
        item.classList.toggle('checked');
      }
      updateChecklistProgress();

      try {
        const url = new URL(API_URL);
        url.searchParams.set('action', 'saveInputProgress');
        url.searchParams.set('studentId', currentUser.studentId);
        url.searchParams.set('themeId', currentThemeId);
        url.searchParams.set('checkedItems', JSON.stringify(checkedItems));

        const res = await fetch(url.toString());
        const result = await res.json();

        if (result.allCompleted) {
          updateProgressSteps();
        }
      } catch (error) {
        console.error('保存エラー:', error);
      }
    }

    // ===== チェックリスト進捗更新 =====
    function updateChecklistProgress() {
      const total = inputItems.length;
      const checked = checkedItems.length;
      const percent = total > 0 ? Math.round((checked / total) * 100) : 0;

      document.getElementById('checklistProgressBar').style.width = `${percent}%`;
      document.getElementById('checklistProgressText').textContent = `${checked} / ${total}`;

      const toQuizBtn = document.getElementById('toQuizBtn');
      if (checked >= total && total > 0) {
        toQuizBtn.disabled = false;
      } else {
        toQuizBtn.disabled = true;
      }
    }

    // ===== プログレスステップ更新 =====
    function updateProgressSteps() {
      const progress = themeProgressData[currentThemeId] || {};
      const status = progress.status || 'not_started';

      const step1 = document.getElementById('step1Circle');
      const step2 = document.getElementById('step2Circle');
      const step3 = document.getElementById('step3Circle');
      const line1 = document.getElementById('stepLine1');
      const line2 = document.getElementById('stepLine2');
      const label1 = document.getElementById('step1Label');
      const label2 = document.getElementById('step2Label');
      const label3 = document.getElementById('step3Label');

      [step1, step2, step3].forEach(el => el.classList.remove('active', 'completed'));
      [line1, line2].forEach(el => el.classList.remove('completed'));
      [label1, label2, label3].forEach(el => el.classList.remove('active', 'completed'));

      if (status === 'quiz_passed') {
        step1.classList.add('completed');
        step2.classList.add('completed');
        step3.classList.add('completed');
        line1.classList.add('completed');
        line2.classList.add('completed');
        label1.classList.add('completed');
        label2.classList.add('completed');
        label3.classList.add('completed');
      } else if (status === 'input_completed' || status === 'quiz_failed') {
        step1.classList.add('completed');
        step2.classList.add('active');
        line1.classList.add('completed');
        label1.classList.add('completed');
        label2.classList.add('active');
      } else if (status === 'input_in_progress') {
        step1.classList.add('active');
        label1.classList.add('active');
      } else {
        step1.classList.add('active');
        label1.classList.add('active');
      }
    }

    // ===== 小テストセクション表示 =====
    async function showQuizSection() {
      document.getElementById('loadingOverlay').style.display = 'flex';

      try {
        const res = await fetch(`${API_URL}?action=getQuizQuestions&themeId=${currentThemeId}`);
        const result = await res.json();

        if (result.success) {
          quizQuestions = result.questions;
          selectedAnswers = {};
          renderQuiz();

          document.getElementById('quizSection').classList.add('active');
          document.getElementById('quizSection').scrollIntoView({ behavior: 'smooth' });
        }
      } catch (error) {
        console.error('小テスト取得エラー:', error);
        alert('小テストの取得に失敗しました');
      }

      document.getElementById('loadingOverlay').style.display = 'none';
    }

    // ===== 小テスト描画 =====
    function renderQuiz() {
      const container = document.getElementById('quizContent');
      const optionLabels = ['A', 'B', 'C', 'D'];

      container.innerHTML = quizQuestions.map((q, qIndex) => `
        <div class="quiz-question" data-question-id="${q.questionId}">
          <div class="question-number">問題 ${qIndex + 1}</div>
          <div class="question-text">${q.question}</div>
          <div class="quiz-options">
            ${q.options.map((opt, oIndex) => `
              <div class="quiz-option" data-question-id="${q.questionId}" data-option-index="${oIndex}" onclick="selectOption(${q.questionId}, ${oIndex})">
                <div class="option-marker">${optionLabels[oIndex]}</div>
                <div class="option-text">${opt}</div>
              </div>
            `).join('')}
          </div>
          <div class="explanation" id="explanation-${q.questionId}"></div>
        </div>
      `).join('');

      document.getElementById('submitQuizBtn').disabled = true;
      document.getElementById('quizResult').classList.remove('show');
      document.getElementById('quizContent').style.display = 'block';
      document.getElementById('submitQuizBtn').style.display = 'flex';
    }

    // ===== 選択肢選択 =====
    function selectOption(questionId, optionIndex) {
      if (document.getElementById('quizResult').classList.contains('show')) return;

      selectedAnswers[questionId] = optionIndex;

      const options = document.querySelectorAll(`[data-question-id="${questionId}"].quiz-option`);
      options.forEach(opt => {
        opt.classList.remove('selected');
        if (parseInt(opt.dataset.optionIndex) === optionIndex) {
          opt.classList.add('selected');
        }
      });

      const answeredCount = Object.keys(selectedAnswers).length;
      document.getElementById('submitQuizBtn').disabled = answeredCount < quizQuestions.length;
    }

    // ===== 小テスト提出 =====
    async function submitQuiz() {
      document.getElementById('loadingOverlay').style.display = 'flex';

      try {
        const answers = Object.entries(selectedAnswers).map(([questionId, selectedIndex]) => ({
          questionId: parseInt(questionId),
          selectedIndex: selectedIndex
        }));

        const url = new URL(API_URL);
        url.searchParams.set('action', 'submitQuizAnswer');
        url.searchParams.set('studentId', currentUser.studentId);
        url.searchParams.set('themeId', currentThemeId);
        url.searchParams.set('answers', JSON.stringify(answers));

        const res = await fetch(url.toString());
        const result = await res.json();

        if (result.success) {
          showQuizResult(result);
        }
      } catch (error) {
        console.error('提出エラー:', error);
        alert('提出に失敗しました');
      }

      document.getElementById('loadingOverlay').style.display = 'none';
    }

    // ===== 結果表示 =====
    function showQuizResult(result) {
      const theme = themes.find(t => t.id === currentThemeId);

      result.results.forEach(r => {
        const options = document.querySelectorAll(`[data-question-id="${r.questionId}"].quiz-option`);
        options.forEach(opt => {
          const idx = parseInt(opt.dataset.optionIndex);
          opt.classList.remove('selected');
          if (idx === r.correctIndex) {
            opt.classList.add('correct');
          } else if (idx === r.selectedIndex && !r.isCorrect) {
            opt.classList.add('incorrect');
          }
        });

        const explanation = document.getElementById(`explanation-${r.questionId}`);
        if (explanation && r.explanation) {
          explanation.textContent = r.explanation;
          explanation.classList.add('show');
        }
      });

      const resultIcon = document.getElementById('resultIcon');
      const resultTitle = document.getElementById('resultTitle');
      const resultScore = document.getElementById('resultScore');
      const resultActions = document.getElementById('resultActions');

      resultIcon.textContent = result.passed ? 'emoji_events' : 'sentiment_dissatisfied';
      resultIcon.className = `material-icons result-icon ${result.passed ? 'pass' : 'fail'}`;
      resultTitle.textContent = result.passed ? '合格！' : '不合格...';
      resultTitle.className = `result-title ${result.passed ? 'pass' : 'fail'}`;
      resultScore.textContent = `${result.totalQuestions}問中 ${result.score}問正解`;

      if (result.passed) {
        resultActions.innerHTML = `
          ${theme.outputPage ? `
            <a href="${theme.outputPage}" class="result-btn btn-output">
              <span class="material-icons">edit_note</span>
              アウトプットへ進む
            </a>
          ` : ''}
          <button class="result-btn btn-back" onclick="closeTheme()">
            テーマ一覧に戻る
          </button>
        `;

        themeProgressData[currentThemeId] = { status: 'quiz_passed' };
        updateProgressSteps();
      } else {
        resultActions.innerHTML = `
          <button class="result-btn btn-retry" onclick="retryQuiz()">
            <span class="material-icons">refresh</span>
            もう一度挑戦する
          </button>
          <button class="result-btn btn-back" onclick="closeTheme()">
            テーマ一覧に戻る
          </button>
        `;
      }

      document.getElementById('submitQuizBtn').style.display = 'none';
      document.getElementById('quizResult').classList.add('show');
      document.getElementById('quizResult').scrollIntoView({ behavior: 'smooth' });
    }

    // ===== 再挑戦 =====
    function retryQuiz() {
      selectedAnswers = {};
      document.getElementById('quizResult').classList.remove('show');
      document.getElementById('submitQuizBtn').style.display = 'flex';
      showQuizSection();
    }

    // ===== 完了状態表示 =====
    function showCompletedState() {
      const theme = themes.find(t => t.id === currentThemeId);

      inputItems.forEach(item => {
        if (!checkedItems.includes(item.itemId)) {
          checkedItems.push(item.itemId);
        }
      });
      renderChecklist();

      document.getElementById('quizSection').classList.add('active');
      document.getElementById('quizContent').style.display = 'none';
      document.getElementById('submitQuizBtn').style.display = 'none';

      const resultIcon = document.getElementById('resultIcon');
      const resultTitle = document.getElementById('resultTitle');
      const resultScore = document.getElementById('resultScore');
      const resultActions = document.getElementById('resultActions');

      resultIcon.textContent = 'check_circle';
      resultIcon.className = 'material-icons result-icon pass';
      resultTitle.textContent = '学習完了！';
      resultTitle.className = 'result-title pass';
      resultScore.textContent = '小テスト合格済み';

      resultActions.innerHTML = `
        ${theme.outputPage ? `
          <a href="${theme.outputPage}" class="result-btn btn-output">
            <span class="material-icons">edit_note</span>
            アウトプットへ進む
          </a>
        ` : ''}
        <button class="result-btn btn-back" onclick="closeTheme()">
          テーマ一覧に戻る
        </button>
      `;

      document.getElementById('quizResult').classList.add('show');
    }
  </script>
  <script src="js/nav-menu.js"></script>
</body>

</html>