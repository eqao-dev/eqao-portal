<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>受験スケジュール - EQAO PORTAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f8f9fc 0%, #e8ecf4 100%);
      min-height: 100vh;
      padding-bottom: 24px;
    }

    .header {
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 20px rgba(0, 105, 92, 0.4);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }

    .back-btn .material-icons {
      font-size: 20px;
    }

    .back-btn:hover { background: rgba(255,255,255,0.25); }

    .header-title { font-size: 16px; font-weight: 700; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 12px;
    }

    /* セクション */
    .section {
      background: white;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .section-header {
      background: linear-gradient(135deg, #B2DFDB 0%, #80CBC4 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px solid #00695C;
    }

    .section-header .material-icons {
      color: #00695C;
      font-size: 20px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 700;
      color: #004D40;
    }

    .section-content {
      padding: 16px;
    }

    /* 学年選択ボタン */
    .grade-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .grade-btn {
      flex: 1;
      max-width: 100px;
      padding: 8px 12px;
      border: 2px solid #E05555;
      background: white;
      color: #E05555;
      font-size: 13px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .grade-btn.active {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      border-color: #E05555;
      box-shadow: 0 3px 10px rgba(224, 85, 85, 0.4);
    }

    .grade-btn:hover:not(.active) {
      background: #FFEBEE;
    }

    /* ガントチャート */
    .gantt-wrapper {
      overflow-x: auto;
      margin: 0 -16px;
      padding: 0 16px 8px;
    }

    .gantt-chart {
      min-width: 700px;
    }

    /* ガントヘッダー（月） */
    .gantt-header {
      display: flex;
      margin-bottom: 4px;
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }

    .gantt-label-header {
      width: 130px;
      flex-shrink: 0;
      padding: 6px 8px;
      font-size: 10px;
      font-weight: 700;
      color: #004D40;
      position: sticky;
      left: 0;
      background: white;
      z-index: 15;
      box-shadow: 2px 0 4px rgba(0,0,0,0.08);
    }

    .gantt-months {
      display: flex;
      flex: 1;
      z-index: 1;
    }

    .gantt-month {
      flex: 1;
      min-width: 50px;
      text-align: center;
      padding: 6px 4px;
      font-size: 11px;
      font-weight: 600;
      color: #004D40;
      background: #B2DFDB;
      border-left: 1px solid #80CBC4;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .gantt-month:hover {
      background: #80CBC4;
      color: #004D40;
    }

    .gantt-month.selected {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(224, 85, 85, 0.4);
    }

    .gantt-month.current {
      background: #FFE0B2;
      color: #E65100;
      font-weight: 700;
      position: relative;
    }

    .gantt-month.current::after {
      content: '';
      width: 4px;
      height: 4px;
      background: #E65100;
      border-radius: 50%;
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .gantt-month.current:hover {
      background: #FFCC80;
    }

    .gantt-month.current.selected {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
    }

    .gantt-month.current.selected::after {
      background: white;
    }

    /* ガント行 */
    .gantt-row {
      display: flex;
      margin-bottom: 2px;
      align-items: center;
      position: relative;
    }

    .gantt-category {
      width: 130px;
      flex-shrink: 0;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 600;
      color: #004D40;
      display: flex;
      align-items: center;
      gap: 6px;
      position: sticky;
      left: 0;
      background: white;
      z-index: 10;
      box-shadow: 2px 0 4px rgba(0,0,0,0.08);
    }

    .category-color {
      width: 10px;
      height: 10px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .gantt-bars {
      display: flex;
      flex: 1;
      position: relative;
      height: 18px;
      overflow: hidden;
      z-index: 1;
    }

    .gantt-cell {
      flex: 1;
      min-width: 50px;
      height: 100%;
      border-left: 1px solid #B2DFDB;
      position: relative;
    }

    .gantt-bar {
      position: absolute;
      height: 14px;
      top: 2px;
      border-radius: 7px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    /* カテゴリ色 - ポップ配色（濃いめ） */
    .color-blue { background: linear-gradient(135deg, #3F51B5 0%, #5C6BC0 100%); }
    .color-green { background: linear-gradient(135deg, #00897B 0%, #26A69A 100%); }
    .color-yellow { background: linear-gradient(135deg, #FFA000 0%, #FFB300 100%); }
    .color-orange { background: linear-gradient(135deg, #F4511E 0%, #FF7043 100%); }
    .color-purple { background: linear-gradient(135deg, #8E24AA 0%, #AB47BC 100%); }
    .color-cyan { background: linear-gradient(135deg, #00ACC1 0%, #26C6DA 100%); }
    .color-red { background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%); }
    .color-gray { background: linear-gradient(135deg, #546E7A 0%, #78909C 100%); }

    .bg-blue { background: #3F51B5; }
    .bg-green { background: #00897B; }
    .bg-yellow { background: #FFA000; }
    .bg-orange { background: #F4511E; }
    .bg-purple { background: #8E24AA; }
    .bg-cyan { background: #00ACC1; }
    .bg-red { background: #E05555; }
    .bg-gray { background: #546E7A; }

    /* ヒント */
    .chart-hint {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      font-size: 11px;
      color: #00897B;
      margin-top: 8px;
    }

    .chart-hint .material-icons {
      font-size: 16px;
    }

    /* 月詳細カード */
    .month-detail {
      background: linear-gradient(135deg, #B2DFDB 0%, #80CBC4 100%);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      display: none;
    }

    .month-detail.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .month-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .month-badge {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.4);
      display: flex;
      align-items: center;
      gap: 2px;
      white-space: nowrap;
    }

    .badge-divider {
      opacity: 0.6;
      margin: 0 4px;
    }

    .month-title {
      font-size: 15px;
      font-weight: 700;
      color: #004D40;
    }

    .month-description {
      font-size: 13px;
      color: #333;
      line-height: 1.7;
      margin-bottom: 14px;
      padding: 12px 14px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #00695C;
    }

    /* タスクトグル */
    .tasks-toggle {
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .tasks-toggle-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tasks-toggle-header:hover {
      background: #E0F2F1;
    }

    .tasks-toggle-title {
      font-size: 13px;
      font-weight: 700;
      color: #00695C;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tasks-toggle-icon {
      color: #00897B;
      transition: transform 0.3s;
    }

    .tasks-toggle.open .tasks-toggle-icon {
      transform: rotate(180deg);
    }

    .tasks-toggle-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .tasks-toggle.open .tasks-toggle-content {
      max-height: 1000px;
    }

    .month-tasks {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 12px 14px 14px;
    }

    .month-task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      background: #E0F2F1;
      border-radius: 8px;
      font-size: 13px;
      color: #333;
      line-height: 1.5;
    }

    .month-task-item .material-icons {
      color: #00897B;
      font-size: 18px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* 私のスケジュール - 2カラムレイアウト */
    .my-schedule-selector {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .mini-grade-selector {
      display: flex;
      gap: 6px;
    }

    .mini-grade-btn {
      padding: 6px 14px;
      border: 2px solid #E05555;
      background: white;
      color: #E05555;
      font-size: 12px;
      font-weight: 700;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mini-grade-btn.active {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.3);
    }

    .mini-grade-btn:hover:not(.active) {
      background: #FFEBEE;
    }

    .month-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #00695C;
    }

    .month-selector .material-icons {
      font-size: 20px;
    }

    .month-select {
      padding: 8px 32px 8px 12px;
      border: 2px solid #00897B;
      border-radius: 8px;
      background: white;
      color: #00695C;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300695C' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }

    .month-select:focus {
      outline: none;
      border-color: #004D40;
      box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.2);
    }

    .my-schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .selected-month-label {
      font-size: 16px;
      color: #00695C;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .my-schedule-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 768px) {
      .my-schedule-split {
        grid-template-columns: 1fr;
      }
    }

    .my-schedule-panel {
      background: #E0F2F1;
      border-radius: 12px;
      overflow: hidden;
    }

    .panel-header {
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 700;
    }

    .panel-title .material-icons {
      font-size: 20px;
    }

    .panel-actions {
      display: flex;
      gap: 8px;
    }

    .panel-subtitle {
      font-size: 10px;
      opacity: 0.8;
      margin-left: 28px;
      margin-top: -4px;
    }

    .panel-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.2s;
    }

    .panel-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    .panel-btn .material-icons {
      font-size: 16px;
    }

    .panel-content {
      padding: 16px;
      min-height: 200px;
    }

    /* 左側: 今月やること */
    .monthly-goals {
      font-size: 14px;
      color: #333;
      line-height: 1.8;
      white-space: pre-wrap;
    }

    .monthly-goals-empty {
      color: #80CBC4;
      text-align: center;
      padding: 40px 20px;
    }

    .monthly-goals-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    .goals-textarea {
      width: 100%;
      min-height: 180px;
      padding: 12px;
      border: 2px solid #80CBC4;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.8;
      resize: vertical;
      background: white;
    }

    .goals-textarea:focus {
      outline: none;
      border-color: #00897B;
    }

    .edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }

    .btn-save {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .btn-save:hover {
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.4);
    }

    .btn-cancel {
      background: #B2DFDB;
      color: #00695C;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-cancel:hover {
      background: #80CBC4;
    }

    /* 右側: ToDo */
    .todo-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .todo-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .todo-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .todo-item.completed {
      opacity: 0.6;
    }

    .todo-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #E05555;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .todo-content {
      flex: 1;
      min-width: 0;
    }

    .todo-text {
      font-size: 13px;
      color: #333;
      line-height: 1.4;
    }

    .todo-text.done {
      text-decoration: line-through;
      color: #888;
    }

    .todo-deadline {
      font-size: 11px;
      color: #E05555;
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .todo-deadline .material-icons {
      font-size: 14px;
    }

    .todo-deadline.overdue {
      color: #C62828;
      font-weight: 600;
    }

    .todo-deadline.soon {
      color: #F57C00;
    }

    .todo-actions {
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .todo-item:hover .todo-actions {
      opacity: 1;
    }

    .todo-action-btn {
      background: none;
      border: none;
      color: #80CBC4;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
    }

    .todo-action-btn:hover {
      background: #E0F2F1;
      color: #00695C;
    }

    .todo-action-btn .material-icons {
      font-size: 18px;
    }

    .todo-empty {
      text-align: center;
      padding: 40px 20px;
      color: #80CBC4;
      font-size: 13px;
    }

    .todo-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    /* ToDo追加フォーム */
    .todo-add-form {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      border: 2px dashed #80CBC4;
    }

    .todo-add-form.hidden {
      display: none;
    }

    .todo-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .todo-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #B2DFDB;
      border-radius: 6px;
      font-size: 13px;
    }

    .todo-input:focus {
      outline: none;
      border-color: #00897B;
    }

    .todo-date-input {
      width: 140px;
      padding: 8px 12px;
      border: 1px solid #B2DFDB;
      border-radius: 6px;
      font-size: 13px;
    }

    .todo-date-input:focus {
      outline: none;
      border-color: #00897B;
    }

    /* 講師からの指示 */
    .instructor-notes {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .instructor-note-item {
      background: white;
      border-radius: 8px;
      padding: 12px 14px;
      border-left: 4px solid #9C27B0;
    }

    .instructor-note-text {
      font-size: 13px;
      color: #333;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .instructor-note-date {
      font-size: 11px;
      color: #9C27B0;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .instructor-note-date .material-icons {
      font-size: 14px;
    }

    .instructor-empty {
      text-align: center;
      padding: 40px 20px;
      color: #CE93D8;
      font-size: 13px;
    }

    .instructor-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    /* マイガントチャート */
    .my-gantt-section {
      background: #E8F5E9;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .my-gantt-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .my-gantt-title {
      font-size: 14px;
      font-weight: 700;
      color: #2E7D32;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .add-plan-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      background: linear-gradient(135deg, #43A047 0%, #66BB6A 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .add-plan-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(67, 160, 71, 0.4);
    }

    .add-plan-btn .material-icons {
      font-size: 16px;
    }

    .my-gantt-chart {
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .my-gantt-header-row {
      display: flex;
      background: #E8F5E9;
      border-bottom: 2px solid #C8E6C9;
    }

    .my-gantt-label-header {
      width: 100px;
      padding: 6px 12px;
      flex-shrink: 0;
    }

    .my-gantt-months {
      flex: 1;
      display: flex;
    }

    .my-gantt-month {
      flex: 1;
      text-align: center;
      font-size: 10px;
      font-weight: 600;
      color: #2E7D32;
      padding: 6px 2px;
      border-left: 1px solid #C8E6C9;
    }

    .my-gantt-month:first-child {
      border-left: none;
    }

    .my-gantt-empty-row {
      display: flex;
      align-items: center;
      min-height: 50px;
    }

    .my-gantt-placeholder {
      flex: 1;
      text-align: center;
      color: #A5D6A7;
      font-size: 12px;
      padding: 16px;
    }

    .my-gantt-empty {
      text-align: center;
      padding: 30px 20px;
      color: #81C784;
    }

    .my-gantt-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    .my-gantt-empty p {
      font-size: 13px;
    }

    .my-gantt-empty .sub {
      font-size: 11px;
      margin-top: 4px;
      opacity: 0.8;
    }

    .my-gantt-row {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #E8F5E9;
      min-height: 36px;
    }

    .my-gantt-row:last-child {
      border-bottom: none;
    }

    .my-gantt-label {
      width: 100px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      color: #333;
      flex-shrink: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .my-gantt-bar-container {
      flex: 1;
      display: flex;
      padding: 4px 8px;
    }

    .my-gantt-bar {
      height: 24px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .my-gantt-bar:hover {
      transform: scaleY(1.1);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* ピンポイントイベント用マーカー */
    .my-gantt-marker {
      width: 28px;
      height: 28px;
      border-radius: 50% 50% 50% 0;
      transform: rotate(-45deg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .my-gantt-marker .material-icons {
      font-size: 14px;
      color: white;
      transform: rotate(45deg);
    }

    .my-gantt-marker:hover {
      transform: rotate(-45deg) scale(1.15);
      box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    }

    /* モーダル内の学年セレクト */
    .plan-grade-selector {
      display: flex;
      gap: 8px;
    }

    .plan-grade-btn {
      flex: 1;
      padding: 8px 12px;
      border: 2px solid #43A047;
      background: white;
      color: #43A047;
      font-size: 13px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .plan-grade-btn.active {
      background: linear-gradient(135deg, #43A047 0%, #66BB6A 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(67, 160, 71, 0.3);
    }

    .plan-grade-btn:hover:not(.active) {
      background: #E8F5E9;
    }

    /* カラーピッカー */
    .color-picker {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .color-option {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: #333;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* 削除ボタン */
    .modal-btn.delete {
      background: linear-gradient(135deg, #E53935 0%, #EF5350 100%);
      color: white;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .modal-btn.delete .material-icons {
      font-size: 16px;
    }

    /* 進捗バー */
    .progress-section {
      background: #B2DFDB;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      color: #004D40;
    }

    .progress-bar-bg {
      height: 12px;
      background: #80CBC4;
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #E05555, #FF6B6B);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    /* スクロールヒント */
    .scroll-hint {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 6px;
      background: #B2DFDB;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 11px;
      color: #004D40;
    }

    .scroll-hint .material-icons {
      font-size: 16px;
    }

    @media (max-width: 768px) {
      .scroll-hint {
        display: flex;
      }
    }

    /* ハンバーガーメニュー */
    .hamburger-btn {
      position: fixed;
      top: 10px;
      right: 12px;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    .hamburger-btn .material-icons {
      font-size: 22px;
    }

    .nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .nav-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100%;
      background: white;
      z-index: 201;
      transition: right 0.3s ease;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
      overflow-y: auto;
    }

    .nav-menu.open { right: 0; }

    .nav-header {
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      color: white;
      padding: 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-header-title {
      font-size: 16px;
      font-weight: 700;
    }

    .nav-close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    .nav-user-section {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
    }

    .nav-user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
    }

    .nav-user-info .material-icons {
      font-size: 24px;
      color: rgba(255,255,255,0.7);
    }

    .nav-user-name { font-size: 14px; font-weight: 500; }

    .nav-logout-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 8px;
      color: rgba(255,255,255,0.9);
      font-size: 12px;
      cursor: pointer;
      font-family: inherit;
    }

    .nav-logout-btn .material-icons { font-size: 16px; }

    .nav-category {
      font-size: 11px;
      font-weight: 700;
      color: #999;
      padding: 16px 16px 8px;
      letter-spacing: 1px;
    }

    .nav-section {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: #333;
      text-decoration: none;
      transition: background 0.2s;
    }

    .nav-item:hover { background: #f5f5f5; }

    .nav-item .material-icons {
      font-size: 22px;
      color: #00695C;
    }

    .nav-item span {
      font-size: 14px;
      font-weight: 500;
    }

    .nav-badge {
      background: #ff5722;
      color: white;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: auto;
    }

    /* ローディング */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #80CBC4;
      border-top-color: #00695C;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
       進捗状況セクション
       ============================================ */
    .progress-summary {
      padding: 0 0 16px 0;
    }

    .progress-bar-container {
      background: #E0E0E0;
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 10px;
      background: linear-gradient(90deg, #00897B 0%, #4DB6AC 100%);
      transition: width 0.5s ease;
    }

    .progress-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      font-size: 13px;
      color: #666;
    }

    .progress-percent {
      font-size: 24px;
      font-weight: 700;
      color: #00695C;
    }

    .progress-detail {
      display: flex;
      gap: 20px;
    }

    .progress-grade-stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .progress-grade-label {
      font-weight: 600;
      color: #333;
    }

    .progress-grade-count {
      color: #00897B;
      font-weight: 600;
    }

    .checklist-container {
      padding: 0;
    }

    .checklist-grade-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .checklist-grade-tab {
      padding: 8px 16px;
      border: 2px solid #00897B;
      border-radius: 20px;
      background: white;
      color: #00897B;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checklist-grade-tab:hover {
      background: #E0F2F1;
    }

    .checklist-grade-tab.active {
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
      border-color: #00897B;
    }

    .checklist-items {
      max-height: 400px;
      overflow-y: auto;
    }

    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      transition: background 0.2s;
      cursor: pointer;
    }

    .checklist-item:hover {
      background: #F5F5F5;
    }

    .checklist-item.checked {
      background: #E8F5E9;
    }

    .checklist-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #BDBDBD;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 2px;
      transition: all 0.2s;
    }

    .checklist-item.checked .checklist-checkbox {
      background: #00897B;
      border-color: #00897B;
    }

    .checklist-checkbox .material-icons {
      font-size: 16px;
      color: white;
      opacity: 0;
    }

    .checklist-item.checked .checklist-checkbox .material-icons {
      opacity: 1;
    }

    .checklist-text {
      font-size: 14px;
      color: #333;
      line-height: 1.5;
    }

    .checklist-item.checked .checklist-text {
      color: #666;
    }

    .checklist-number {
      font-weight: 600;
      color: #00897B;
      margin-right: 4px;
    }

    .checklist-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      cursor: pointer;
      color: #00897B;
      font-weight: 600;
      font-size: 14px;
      gap: 4px;
      margin-top: 8px;
      background: #E8F5E9;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .checklist-toggle:hover {
      background: #C8E6C9;
    }

    .checklist-toggle .material-icons {
      transition: transform 0.3s;
    }

    .checklist-toggle.open .material-icons {
      transform: rotate(180deg);
    }

    .checklist-wrapper {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      margin-top: 12px;
    }

    .checklist-wrapper.open {
      max-height: 2000px;
    }

    /* ============================================
       志望校／併願校セクション
       ============================================ */
    .school-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .school-tab {
      flex: 1;
      min-width: 80px;
      max-width: 120px;
      padding: 10px 8px;
      border: 2px solid #E0E0E0;
      border-radius: 12px;
      background: white;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .school-tab:hover {
      border-color: #00897B;
      background: #E0F2F1;
    }

    .school-tab.active {
      border-color: #00897B;
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
    }

    .school-tab.add-tab {
      border-style: dashed;
      border-color: #BDBDBD;
      color: #757575;
    }

    .school-tab.add-tab:hover {
      border-color: #00897B;
      color: #00897B;
      background: #E0F2F1;
    }

    .school-tab-rank {
      font-size: 11px;
      font-weight: 600;
      opacity: 0.8;
    }

    .school-tab.active .school-tab-rank {
      opacity: 1;
    }

    .school-tab-name {
      font-size: 13px;
      font-weight: 700;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .school-tab-faculty {
      font-size: 10px;
      opacity: 0.7;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .school-tab .material-icons {
      font-size: 24px;
    }

    .school-detail-card {
      background: #FAFAFA;
      border-radius: 12px;
      padding: 20px;
      display: none;
    }

    .school-detail-card.show {
      display: block;
    }

    .school-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .school-detail-title {
      flex: 1;
    }

    .school-detail-name {
      font-size: 18px;
      font-weight: 700;
      color: #00695C;
    }

    .school-detail-faculty {
      font-size: 14px;
      color: #666;
      margin-top: 4px;
    }

    .school-detail-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .school-action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }

    .school-action-btn .material-icons {
      font-size: 16px;
    }

    .school-rank-select {
      padding: 8px 12px;
      border: 2px solid #00897B;
      border-radius: 8px;
      background: white;
      color: #00897B;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .school-rank-select:hover {
      background: #E0F2F1;
    }

    .school-rank-select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0,137,123,0.2);
    }

    .school-action-btn.edit-btn {
      background: #E3F2FD;
      color: #1976D2;
    }

    .school-action-btn.edit-btn:hover {
      background: #BBDEFB;
    }

    .school-action-btn.delete-btn {
      background: #FFEBEE;
      color: #D32F2F;
    }

    .school-action-btn.delete-btn:hover {
      background: #FFCDD2;
    }

    .school-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .school-info-section {
      background: white;
      border-radius: 8px;
      padding: 14px;
    }

    .school-info-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #00897B;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .school-info-section-title .material-icons {
      font-size: 16px;
    }

    .school-info-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #F0F0F0;
      font-size: 13px;
    }

    .school-info-row:last-child {
      border-bottom: none;
    }

    .school-info-label {
      color: #666;
    }

    .school-info-value {
      font-weight: 600;
      color: #333;
    }

    .school-info-value.yes {
      color: #2E7D32;
    }

    .school-info-value.no {
      color: #9E9E9E;
    }

    .school-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 12px;
    }

    .school-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .school-badge.type-sengan {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .school-badge.type-heigan {
      background: #FFF3E0;
      color: #E65100;
    }

    .school-empty {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .school-empty .material-icons {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .school-empty p {
      font-size: 14px;
    }

    /* モーダル */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: rgba(255,255,255,0.3);
    }

    .modal-body {
      padding: 20px;
    }

    .form-section {
      margin-bottom: 20px;
    }

    .form-section-title {
      font-size: 13px;
      font-weight: 700;
      color: #00897B;
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 2px solid #E0F2F1;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    .form-label {
      font-size: 12px;
      font-weight: 600;
      color: #666;
    }

    .form-label .required {
      color: #E53935;
      font-size: 11px;
    }

    .form-label .optional {
      color: #9E9E9E;
      font-size: 10px;
      font-weight: 400;
    }

    .form-hint {
      font-size: 11px;
      color: #9E9E9E;
      margin-top: 8px;
      margin-bottom: 12px;
    }

    .form-input, .form-select, .form-textarea {
      padding: 10px 12px;
      border: 1px solid #E0E0E0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #00897B;
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-toggle-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .form-toggle {
      padding: 6px 12px;
      border: 1px solid #E0E0E0;
      border-radius: 16px;
      background: white;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .form-toggle:hover {
      border-color: #00897B;
    }

    .form-toggle.active {
      background: #00897B;
      color: white;
      border-color: #00897B;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid #E0E0E0;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .modal-btn {
      padding: 10px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.cancel {
      background: #E0E0E0;
      color: #666;
    }

    .modal-btn.cancel:hover {
      background: #BDBDBD;
    }

    .modal-btn.save {
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
    }

    .modal-btn.save:hover {
      opacity: 0.9;
    }

    @media (max-width: 480px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
      .form-group.full-width {
        grid-column: span 1;
      }
      .school-tabs {
        justify-content: center;
      }
      .school-tab {
        min-width: 70px;
      }
    }

    /* ============================================
       宿題・授業履歴セクション
       ============================================ */
    .lesson-list-wrapper {
      margin-bottom: 16px;
    }

    .lesson-list {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }

    .lesson-list::-webkit-scrollbar {
      height: 6px;
    }

    .lesson-list::-webkit-scrollbar-track {
      background: #F0F0F0;
      border-radius: 3px;
    }

    .lesson-list::-webkit-scrollbar-thumb {
      background: #BDBDBD;
      border-radius: 3px;
    }

    .lesson-item {
      flex-shrink: 0;
      min-width: 100px;
      padding: 12px 14px;
      background: white;
      border: 2px solid #E0E0E0;
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }

    .lesson-item:hover {
      border-color: #00897B;
      background: #E0F2F1;
    }

    .lesson-item.active {
      border-color: #00897B;
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
    }

    .lesson-item-date {
      font-size: 14px;
      font-weight: 700;
    }

    .lesson-item-type {
      font-size: 11px;
      font-weight: 600;
      margin-top: 4px;
      padding: 2px 8px;
      border-radius: 10px;
      display: inline-block;
    }

    .lesson-item:not(.active) .lesson-item-type.type-english {
      background: rgba(136, 14, 79, 0.15);
      color: #880e4f;
    }

    .lesson-item:not(.active) .lesson-item-type.type-essay {
      background: rgba(230, 81, 0, 0.15);
      color: #e65100;
    }

    .lesson-item:not(.active) .lesson-item-type.type-interview {
      background: rgba(27, 94, 32, 0.15);
      color: #1b5e20;
    }

    .lesson-item:not(.active) .lesson-item-type.type-normal {
      background: rgba(26, 35, 126, 0.15);
      color: #1a237e;
    }

    .lesson-item.active .lesson-item-type {
      background: rgba(255, 255, 255, 0.25);
      color: white;
    }

    .lesson-item-teacher {
      font-size: 11px;
      margin-top: 4px;
      opacity: 0.8;
    }

    .lesson-detail-card {
      background: #FAFAFA;
      border-radius: 12px;
      padding: 20px;
      display: none;
    }

    .lesson-detail-card.show {
      display: block;
    }

    .lesson-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .lesson-detail-date {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }

    .lesson-detail-badge {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 12px;
      border-radius: 12px;
      color: white;
    }

    .lesson-detail-badge.type-english {
      background: linear-gradient(135deg, #880e4f 0%, #ad1457 100%);
    }

    .lesson-detail-badge.type-essay {
      background: linear-gradient(135deg, #e65100 0%, #f57c00 100%);
    }

    .lesson-detail-badge.type-interview {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
    }

    .lesson-detail-badge.type-normal {
      background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
    }

    .lesson-detail-teacher {
      font-size: 14px;
      color: #666;
    }

    .lesson-detail-section {
      background: white;
      border-radius: 8px;
      padding: 14px;
      margin-top: 12px;
    }

    .lesson-detail-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #00897B;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .lesson-detail-section-title .material-icons {
      font-size: 16px;
    }

    .lesson-detail-section-content {
      font-size: 14px;
      color: #444;
      line-height: 1.7;
      padding-left: 22px;
    }

    .homework-empty {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .homework-empty .material-icons {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .homework-empty p {
      font-size: 14px;
    }

    /* ==============================
       大科目・小科目の表示スタイル（追加）
       ============================== */
    
    /* 大科目バッジ */
    .major-subject-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      color: white;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
    }

    .major-subject-number {
      background: rgba(255,255,255,0.25);
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* 小科目チップ */
    .minor-subjects-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .minor-subject-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #E0F2F1;
      color: #00695C;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid #B2DFDB;
    }

    .minor-subject-chip .material-icons {
      font-size: 16px;
      color: #00897B;
    }

    /* カリキュラムセクション */
    .curriculum-section {
      background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
      border-radius: 8px;
      padding: 14px;
      margin-top: 12px;
      border: 1px solid #A5D6A7;
    }

    .curriculum-section-title {
      font-size: 12px;
      font-weight: 700;
      color: #2E7D32;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .curriculum-section-title .material-icons {
      font-size: 18px;
    }

    @media (max-width: 600px) {
      .major-subject-badge {
        font-size: 13px;
        padding: 8px 14px;
      }

      .major-subject-number {
        width: 22px;
        height: 22px;
        font-size: 11px;
      }

      .minor-subject-chip {
        font-size: 12px;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="back-btn">
      <span class="material-icons">arrow_back</span>
    </a>
    <h1 class="header-title">受験スケジュール</h1>
  </header>

  <button class="hamburger-btn" onclick="openNav()">
    <span class="material-icons">menu</span>
  </button>

  <div id="navOverlay" class="nav-overlay" onclick="closeNav()"></div>
  <div id="navMenu" class="nav-menu">
    <div class="nav-header">
      <span class="nav-header-title">メニュー</span>
      <button class="nav-close" onclick="closeNav()">
        <span class="material-icons">close</span>
      </button>
    </div>
    <div class="nav-user-section">
      <div class="nav-user-info">
        <span class="material-icons">person</span>
        <span id="navUserName" class="nav-user-name"></span>
      </div>
      <button class="nav-logout-btn" onclick="doLogout()">
        <span class="material-icons">logout</span>
        <span>ログアウト</span>
      </button>
    </div>
    <div class="nav-section">
      <a href="index.html" class="nav-item">
        <span class="material-icons">home</span>
        <span>ホーム</span>
      </a>
    </div>
    <div class="nav-category">スケジュール</div>
    <div class="nav-section">
      <a href="yearly-schedule.html" class="nav-item">
        <span class="material-icons">calendar_month</span>
        <span>年間スケジュール</span>
      </a>
      <a href="exam-schedule.html" class="nav-item">
        <span class="material-icons">school</span>
        <span>受験スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
      <a href="schedule.html" class="nav-item">
        <span class="material-icons">event_note</span>
        <span>授業スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">学習管理</div>
    <div class="nav-section">
      <a href="checklist.html" class="nav-item">
        <span class="material-icons">checklist</span>
        <span>チェックリスト教材</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">コンテンツ</div>
    <div class="nav-section">
      <a href="videos.html" class="nav-item">
        <span class="material-icons">video_library</span>
        <span>過去の集団授業動画</span>
      </a>
      <a href="column.html" class="nav-item">
        <span class="material-icons">article</span>
        <span>コラム一覧</span>
      </a>
    </div>
    <div class="nav-category">面談申し込み</div>
    <div class="nav-section">
      <a href="meeting-principal.html" class="nav-item">
        <span class="material-icons">person</span>
        <span>塾長面談</span>
      </a>
      <a href="meeting-sansya.html" class="nav-item">
        <span class="material-icons">groups</span>
        <span>三者面談</span>
      </a>
      <a href="meeting-tantou.html" class="nav-item">
        <span class="material-icons">support_agent</span>
        <span>担任面談</span>
      </a>
    </div>
    <div class="nav-category">各種申し込み</div>
    <div class="nav-section">
      <a href="forms.html" class="nav-item">
        <span class="material-icons">list_alt</span>
        <span>各種申し込みフォーム一覧</span>
      </a>
    </div>
    <div class="nav-category">カリキュラム</div>
    <div class="nav-section">
      <a href="zoom-links.html" class="nav-item">
        <span class="material-icons">videocam</span>
        <span>Zoomリンク一覧</span>
      </a>
    </div>
  </div>

  <div class="container">
    <!-- 理想スケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">timeline</span>
        <span class="section-title">理想スケジュール</span>
      </div>
      <div class="section-content">
        <!-- 学年選択 -->
        <div class="grade-selector">
          <button class="grade-btn" data-grade="高1" onclick="selectGrade('高1')">高1</button>
          <button class="grade-btn active" data-grade="高2" onclick="selectGrade('高2')">高2</button>
          <button class="grade-btn" data-grade="高3" onclick="selectGrade('高3')">高3</button>
        </div>

        <!-- スクロールヒント -->
        <div class="scroll-hint">
          <span class="material-icons">swipe</span>
          <span>左右にスクロールできます</span>
        </div>

        <!-- ガントチャート -->
        <div class="gantt-wrapper">
          <div class="gantt-chart" id="ganttChart"></div>
        </div>

        <!-- ヒント -->
        <div class="chart-hint">
          <span class="material-icons">touch_app</span>
          <span>月をタップで詳細表示</span>
        </div>

        <!-- 月詳細カード -->
        <div class="month-detail" id="monthDetail"></div>
      </div>
    </div>

    <!-- 私のスケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">checklist</span>
        <span class="section-title">私のスケジュール</span>
      </div>
      <div class="section-content">
        <!-- 学年・月セレクター -->
        <div class="my-schedule-selector">
          <div class="mini-grade-selector">
            <button class="mini-grade-btn active" data-grade="高1" onclick="selectGradeFromMySchedule('高1')">高1</button>
            <button class="mini-grade-btn" data-grade="高2" onclick="selectGradeFromMySchedule('高2')">高2</button>
            <button class="mini-grade-btn" data-grade="高3" onclick="selectGradeFromMySchedule('高3')">高3</button>
          </div>
          <div class="month-selector">
            <span class="material-icons">event</span>
            <select id="monthSelect" class="month-select" onchange="selectMonthFromMySchedule(this.value)">
              <!-- JSで動的に生成 -->
            </select>
          </div>
        </div>

        <!-- マイガントチャート -->
        <div class="my-gantt-section">
          <div class="my-gantt-header">
            <span class="my-gantt-title">予定</span>
            <button class="add-plan-btn" onclick="openPlanModal()">
              <span class="material-icons">add</span>
              予定を追加
            </button>
          </div>
          <div class="my-gantt-chart" id="myGanttChart">
            <div class="my-gantt-empty">
              <span class="material-icons">event_note</span>
              <p>予定がありません</p>
              <p class="sub">「予定を追加」から登録してください</p>
            </div>
          </div>
        </div>

        <!-- 2カラムレイアウト -->
        <div class="my-schedule-split">
          <!-- 左側: 今月やること -->
          <div class="my-schedule-panel">
            <div class="panel-header">
              <div class="panel-title">
                <span class="material-icons">edit_note</span>
                <span id="goalsPanelTitle">12月にやること</span>
              </div>
              <div class="panel-subtitle">自分で記入</div>
              <div class="panel-actions">
                <button class="panel-btn" onclick="toggleGoalsEdit()" id="goalsEditBtn">
                  <span class="material-icons">edit</span>
                  編集
                </button>
              </div>
            </div>
            <div class="panel-content">
              <!-- 表示モード -->
              <div id="goalsDisplay">
                <div class="monthly-goals" id="monthlyGoalsText">
                  <div class="monthly-goals-empty">
                    <span class="material-icons">edit_note</span>
                    <p>読み込み中...</p>
                  </div>
                </div>
              </div>
              <!-- 編集モード -->
              <div id="goalsEdit" style="display: none;">
                <textarea class="goals-textarea" id="goalsTextarea" placeholder="この月にやることを入力...&#10;&#10;例:&#10;・英検の勉強を毎日30分&#10;・志望理由書の下書き&#10;・ボランティア活動"></textarea>
                <div class="edit-actions">
                  <button class="btn-cancel" onclick="cancelGoalsEdit()">キャンセル</button>
                  <button class="btn-save" onclick="saveGoals()">
                    <span class="material-icons">save</span>
                    保存
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 右側: 講師からの指示 -->
          <div class="my-schedule-panel">
            <div class="panel-header" style="background: linear-gradient(135deg, #7B1FA2 0%, #9C27B0 100%);">
              <div class="panel-title">
                <span class="material-icons">assignment</span>
                <span id="instructorPanelTitle">12月の指示</span>
              </div>
              <div class="panel-subtitle">講師が記入</div>
            </div>
            <div class="panel-content">
              <!-- 講師指示リスト -->
              <div class="instructor-notes" id="instructorNotes">
                <div class="instructor-empty">
                  <span class="material-icons">assignment</span>
                  <p>読み込み中...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 進捗状況セクション -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">analytics</span>
        <span class="section-title">総合進捗状況</span>
      </div>
      <div class="section-content">
        <div class="progress-summary">
          <div class="progress-bar-container">
            <div class="progress-bar-fill" id="totalProgressBar" style="width: 0%"></div>
          </div>
          <div class="progress-stats">
            <div>
              <span class="progress-percent" id="totalProgressPercent">0%</span>
              <span>達成</span>
            </div>
            <div class="progress-detail">
              <div class="progress-grade-stat">
                <span class="progress-grade-label">高1:</span>
                <span class="progress-grade-count" id="progress1Count">0/30</span>
              </div>
              <div class="progress-grade-stat">
                <span class="progress-grade-label">高2:</span>
                <span class="progress-grade-count" id="progress2Count">0/29</span>
              </div>
              <div class="progress-grade-stat">
                <span class="progress-grade-label">高3:</span>
                <span class="progress-grade-count" id="progress3Count">0/50</span>
              </div>
            </div>
          </div>
        </div>

        <div class="checklist-toggle" id="checklistToggle" onclick="toggleChecklist()">
          <span>チェックリストを表示</span>
          <span class="material-icons">expand_more</span>
        </div>

        <div class="checklist-wrapper" id="checklistWrapper">
          <div class="checklist-container">
            <div class="checklist-grade-tabs">
              <button class="checklist-grade-tab active" data-grade="高1" onclick="selectChecklistGrade('高1')">高1（30項目）</button>
              <button class="checklist-grade-tab" data-grade="高2" onclick="selectChecklistGrade('高2')">高2（29項目）</button>
              <button class="checklist-grade-tab" data-grade="高3" onclick="selectChecklistGrade('高3')">高3（50項目）</button>
            </div>
            <div class="checklist-items" id="checklistItems">
              <!-- JSで描画 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 志望校／併願校セクション -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">school</span>
        <span class="section-title">志望校／併願校戦略</span>
      </div>
      <div class="section-content">
        <!-- タブ（志望校一覧） -->
        <div class="school-tabs" id="schoolTabs">
          <!-- JSで描画 -->
        </div>

        <!-- 詳細表示エリア -->
        <div class="school-detail-card" id="schoolDetail">
          <!-- JSで描画 -->
        </div>

        <!-- 空状態 -->
        <div class="school-empty" id="schoolEmpty">
          <span class="material-icons">add_circle_outline</span>
          <p>志望校を追加してください</p>
        </div>
      </div>
    </div>

    <!-- 宿題・授業履歴セクション -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">assignment</span>
        <span class="section-title">宿題・授業履歴</span>
      </div>
      <div class="section-content">
        <!-- 授業リスト（横スクロール） -->
        <div class="lesson-list-wrapper">
          <div class="lesson-list" id="lessonList">
            <!-- JSで描画 -->
          </div>
        </div>

        <!-- 詳細表示エリア -->
        <div class="lesson-detail-card" id="lessonDetail">
          <!-- JSで描画 -->
        </div>

        <!-- 空状態（データがない場合） -->
        <div class="homework-empty" id="homeworkEmpty" style="display:none;">
          <span class="material-icons">inbox</span>
          <p>授業履歴がありません</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 志望校登録モーダル -->
  <div class="modal-overlay" id="schoolModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <span class="material-icons">school</span>
          <span id="modalTitle">志望校を追加</span>
        </div>
        <button class="modal-close" onclick="closeSchoolModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="schoolForm">
          <input type="hidden" id="schoolId">
          
          <!-- 基本情報 -->
          <div class="form-section">
            <div class="form-section-title">基本情報</div>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">大学名 *</label>
                <input type="text" class="form-input" id="universityName" required>
              </div>
              <div class="form-group">
                <label class="form-label">学部 *</label>
                <input type="text" class="form-input" id="faculty" required>
              </div>
              <div class="form-group">
                <label class="form-label">学科</label>
                <input type="text" class="form-input" id="department">
              </div>
              <div class="form-group">
                <label class="form-label">地域</label>
                <input type="text" class="form-input" id="region">
              </div>
              <div class="form-group">
                <label class="form-label">専願/併願</label>
                <select class="form-select" id="applicationTypeSelect">
                  <option value="">選択してください</option>
                  <option value="専願">専願</option>
                  <option value="併願">併願</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">試験方式</label>
                <input type="text" class="form-input" id="examType" placeholder="例: 総合型選抜">
              </div>
            </div>
          </div>

          <!-- 出願要件 -->
          <div class="form-section">
            <div class="form-section-title">出願要件</div>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">英語資格の要件</label>
                <input type="text" class="form-input" id="englishReq" placeholder="例: IELTS 5.5以上">
              </div>
              <div class="form-group">
                <label class="form-label">評定条件</label>
                <input type="text" class="form-input" id="gpaReq" placeholder="例: 4.0以上">
              </div>
              <div class="form-group full-width">
                <label class="form-label">出願書類</label>
                <input type="text" class="form-input" id="documents" placeholder="例: 志望理由書、活動報告書">
              </div>
              <div class="form-group">
                <label class="form-label">推薦状</label>
                <select class="form-select" id="recommendationSelect">
                  <option value="">選択</option>
                  <option value="必要">必要</option>
                  <option value="不要">不要</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">英語証明形式</label>
                <select class="form-select" id="englishCertSelect">
                  <option value="">選択</option>
                  <option value="原本">原本</option>
                  <option value="コピー可">コピー可</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">賞状等提出</label>
                <select class="form-select" id="awardsSelect">
                  <option value="">選択</option>
                  <option value="可">可</option>
                  <option value="不可">不可</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">締切扱い</label>
                <select class="form-select" id="deadlineTypeSelect">
                  <option value="">選択</option>
                  <option value="必着">必着</option>
                  <option value="消印有効">消印有効</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 試験内容 -->
          <div class="form-section">
            <div class="form-section-title">試験内容</div>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">小論文</label>
                <select class="form-select" id="essaySelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">面接</label>
                <select class="form-select" id="interviewSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">口頭試問</label>
                <select class="form-select" id="oralSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">グループディスカッション</label>
                <select class="form-select" id="groupDiscussionSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">実施形式</label>
                <select class="form-select" id="formatSelect">
                  <option value="">選択</option>
                  <option value="講義型">講義型</option>
                  <option value="レポート型">レポート型</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">英語面接</label>
                <select class="form-select" id="englishInterviewSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">英語プレゼン</label>
                <select class="form-select" id="englishPresentSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">プレゼン発表</label>
                <select class="form-select" id="presentSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">二次科目試験</label>
                <select class="form-select" id="secondExamSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">資料作成</label>
                <select class="form-select" id="materialSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">動画資料</label>
                <select class="form-select" id="videoSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">二次有無</label>
                <select class="form-select" id="hasSecondSelect">
                  <option value="">選択</option>
                  <option value="有">有</option>
                  <option value="無">無</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 日程・データ -->
          <div class="form-section">
            <div class="form-section-title">日程・データ</div>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">入試日程</label>
                <input type="date" class="form-input" id="examDate">
              </div>
              <div class="form-group">
                <label class="form-label">一次合格発表</label>
                <input type="date" class="form-input" id="firstResultDate">
              </div>
              <div class="form-group">
                <label class="form-label">二次出願期間</label>
                <input type="text" class="form-input" id="secondApplicationPeriod" placeholder="例: 10/1〜10/15">
              </div>
              <div class="form-group">
                <label class="form-label">偏差値</label>
                <input type="text" class="form-input" id="deviation" placeholder="例: 65">
              </div>
              <div class="form-group">
                <label class="form-label">倍率</label>
                <input type="text" class="form-input" id="ratio" placeholder="例: 3.5">
              </div>
              <div class="form-group">
                <label class="form-label">志願者数</label>
                <input type="text" class="form-input" id="applicants" placeholder="例: 500">
              </div>
              <div class="form-group full-width">
                <label class="form-label">備考</label>
                <textarea class="form-textarea" id="notes" placeholder="その他メモ"></textarea>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="modal-btn cancel" onclick="closeSchoolModal()">キャンセル</button>
        <button type="button" class="modal-btn save" onclick="saveSchool()">保存</button>
      </div>
    </div>
  </div>

  <!-- マイ予定追加/編集モーダル -->
  <div class="modal-overlay" id="planModal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h2 class="modal-title" id="planModalTitle">予定を追加</h2>
        <button class="modal-close" onclick="closePlanModal()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="planForm">
          <div class="form-group">
            <label class="form-label">学年 <span class="required">*</span></label>
            <div class="plan-grade-selector">
              <button type="button" class="plan-grade-btn active" data-grade="高1">高1</button>
              <button type="button" class="plan-grade-btn" data-grade="高2">高2</button>
              <button type="button" class="plan-grade-btn" data-grade="高3">高3</button>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">予定名 <span class="required">*</span></label>
            <input type="text" class="form-input" id="planName" placeholder="例: ○○大学 出願期間、英検試験日">
          </div>
          <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="form-group">
              <label class="form-label">開始日 <span class="required">*</span></label>
              <input type="date" class="form-input" id="planStartDate">
            </div>
            <div class="form-group">
              <label class="form-label">終了日 <span class="optional">任意</span></label>
              <input type="date" class="form-input" id="planEndDate">
            </div>
          </div>
          <p class="form-hint">※ 試験日など1日だけの場合は開始日のみでOK</p>
          <div class="form-group">
            <label class="form-label">色</label>
            <div class="color-picker" id="colorPicker">
              <div class="color-option selected" data-color="blue" style="background: #2196F3;"></div>
              <div class="color-option" data-color="green" style="background: #4CAF50;"></div>
              <div class="color-option" data-color="yellow" style="background: #FFC107;"></div>
              <div class="color-option" data-color="orange" style="background: #FF9800;"></div>
              <div class="color-option" data-color="purple" style="background: #9C27B0;"></div>
              <div class="color-option" data-color="cyan" style="background: #00BCD4;"></div>
              <div class="color-option" data-color="red" style="background: #F44336;"></div>
              <div class="color-option" data-color="gray" style="background: #9E9E9E;"></div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="modal-btn delete" id="deletePlanBtn" onclick="deletePlan()" style="display: none;">
          <span class="material-icons">delete</span>
          削除
        </button>
        <div style="flex: 1;"></div>
        <button type="button" class="modal-btn cancel" onclick="closePlanModal()">キャンセル</button>
        <button type="button" class="modal-btn save" onclick="savePlan()">保存</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // 大科目データ（追加）
    // ============================================
    const majorSubjects = {
      1: "全体像理解・進路理解",
      2: "自己分析・現状把握・原材料抽出",
      3: "研究テーマ・志望校マッチング",
      4: "研究実践",
      5: "小論文準備",
      6: "書類作成（志望理由書と自己推薦書）",
      7: "課題レポート",
      8: "プレゼン",
      9: "面接",
      10: "最終確認・調整"
    };

    // ============================================
    // 理想スケジュールデータ
    // ============================================
    const idealScheduleData = {
      "高1": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3"],
        categories: [
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "3" },
          { id: "club", name: "部活/委員会", color: "blue", start: "4", end: "3" },
          { id: "study", name: "留学/語学学習", color: "cyan", start: "7", end: "8" },
          { id: "info", name: "総合型選抜情報収集", color: "green", start: "6", end: "6" },
          { id: "activity", name: "課外活動/ボランティア", color: "orange", start: "8", end: "2" },
          { id: "career", name: "志望校・進路検討", color: "purple", start: "9", end: "1" },
          { id: "self", name: "自己分析", color: "red", start: "10", end: "11" },
          { id: "research", name: "研究テーマ模索", color: "gray", start: "12", end: "3" }
        ],
        monthDetails: {
          "4": {
            title: "高校生活のスタート",
            subtitle: "目標設定と基盤づくり",
            description: "高校1年生の始まり。受験を見据えた長期的な目標を設定し、学業と課外活動の両立を目指す大切な時期。",
            tasks: [
              "評定平均の目標を設定する（最終目標4.0）",
              "英語資格の目標を設定する（最終目標英検準一級相当スコア）",
              "部活/委員会活動に励む"
            ]
          },
          "5": {
            title: "学習習慣の確立",
            subtitle: "継続と定着",
            description: "4月に立てた目標に向けて、日々の学習習慣を確立していく時期。",
            tasks: [
              "部活/委員会の継続",
              "評定/英語資格の学習継続"
            ]
          },
          "6": {
            title: "情報収集の開始",
            subtitle: "総合型選抜を知る",
            description: "総合型選抜という入試方式について情報を集め始める。早めの情報収集が将来の選択肢を広げる。",
            tasks: [
              "部活/委員会の継続",
              "評定/英語資格の学習継続",
              "総合型選抜の情報を収集する"
            ]
          },
          "7": {
            title: "夏の挑戦",
            subtitle: "新しい経験を積む",
            description: "夏休みを活用して、留学やスタディツアーなど新しい経験に挑戦するチャンス。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続"
            ]
          },
          "8": {
            title: "活動の幅を広げる",
            subtitle: "課外活動・ボランティアの開始",
            description: "夏休み後半は、課外活動やボランティアを始める絶好の機会。継続できる活動を見つけよう。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "ボランティア活動を始めてみる（継続する前提）"
            ]
          },
          "9": {
            title: "将来を考え始める",
            subtitle: "志望校・進路の検討開始",
            description: "2学期のスタート。自分の将来や志望校について考え始める時期。",
            tasks: [
              "志望校/入試方式/進路について考え始める",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "10": {
            title: "自己分析の開始",
            subtitle: "自分を知る",
            description: "自分の強み・弱み、興味・関心を整理し始める。総合型選抜に向けた自己理解の第一歩。",
            tasks: [
              "自己分析を開始する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "11": {
            title: "自己分析の継続",
            subtitle: "深掘りと言語化",
            description: "10月に始めた自己分析をさらに深め、自分の価値観や将来像を言語化していく。",
            tasks: [
              "自己分析を継続する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "12": {
            title: "研究テーマの模索開始",
            subtitle: "興味から研究へ",
            description: "自分の興味・関心から、将来の研究テーマにつながりそうな分野を探り始める。",
            tasks: [
              "自分の興味、個性から研究テーマを模索する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "1": {
            title: "志望校情報の収集",
            subtitle: "募集要項を確認",
            description: "研究テーマの模索を続けながら、志望校の募集要項にも目を通し始める。",
            tasks: [
              "自分の興味、個性から研究テーマを模索する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "志望校や併願校の募集要項に目を通してみる"
            ]
          },
          "2": {
            title: "1年間の総まとめ",
            subtitle: "振り返りと準備",
            description: "高1の学習成果を振り返り、高2に向けた準備を進める。",
            tasks: [
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "自分の興味、個性から研究テーマを模索の継続"
            ]
          },
          "3": {
            title: "高2への準備",
            subtitle: "予備受験生としてのスタート",
            description: "高1で培った基盤をもとに、高2では本格的な受験準備が始まる。研究テーマの方向性を定めよう。",
            tasks: [
              "評定/英語資格の学習継続（高校1年で4後半獲得している）",
              "部活/委員会の継続",
              "自分の興味、個性から研究テーマを模索の継続 ー ある程度方向性が定まる",
              "高校2年生（予備受験生）の受験準備"
            ]
          }
        }
      },
      "高2": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3"],
        categories: [
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "3" },
          { id: "club", name: "部活/委員会", color: "blue", start: "4", end: "8" },
          { id: "self", name: "自己分析・研究テーマ", color: "red", start: "4", end: "4" },
          { id: "research", name: "研究活動", color: "green", start: "5", end: "3" },
          { id: "activity", name: "課外活動", color: "orange", start: "7", end: "3" },
          { id: "study", name: "留学/語学学習", color: "cyan", start: "8", end: "8" },
          { id: "volunteer", name: "ボランティア", color: "purple", start: "8", end: "3" },
          { id: "school", name: "志望校・併願校決定", color: "gray", start: "10", end: "3" },
          { id: "docs", name: "書類準備", color: "red", start: "12", end: "3" },
          { id: "essay", name: "小論文対策", color: "blue", start: "2", end: "3" }
        ],
        monthDetails: {
          "4": {
            title: "高2スタート",
            subtitle: "継続と発展",
            description: "高2の始まり。高1で積み上げた基盤をもとに、各活動をさらに発展させていく。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "自己分析と研究テーマの模索継続"
            ]
          },
          "5": {
            title: "研究活動の本格化",
            subtitle: "受験を見据えた研究開始",
            description: "総合型選抜を見据え、本格的な研究活動を開始する重要な時期。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "6": {
            title: "研究の深化",
            subtitle: "テーマを掘り下げる",
            description: "研究活動を継続し、テーマをより深く掘り下げていく。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "7": {
            title: "部活引退と新たな挑戦",
            subtitle: "時間の使い方が変わる",
            description: "部活を引退し、受験準備により多くの時間を使えるようになる転換期。課外活動も積極的に。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の引退",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "8": {
            title: "夏の集中期間",
            subtitle: "多角的な活動を展開",
            description: "夏休みを最大限活用。留学や語学学習、ボランティアなど、多方面での経験を積む。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "ボランティア活動を始めてみる（継続する前提）",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "9": {
            title: "研究テーマの方向性決定",
            subtitle: "焦点を絞る",
            description: "これまでの研究活動をもとに、研究テーマの方向性を仮決定する重要な月。",
            tasks: [
              "研究テーマの方向性の仮決定",
              "評定平均/英語資格の継続",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "10": {
            title: "志望校の検討開始",
            subtitle: "出願先を絞り込む",
            description: "研究テーマと自分の興味をもとに、志望校・併願校を具体的に検討し始める。",
            tasks: [
              "評定平均/英語資格の継続",
              "志望校/併願校の仮決定",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "11": {
            title: "志望校の仮決定",
            subtitle: "出願戦略を立てる",
            description: "志望校・併願校を仮決定し、それぞれの入試に向けた準備計画を立てる。",
            tasks: [
              "評定平均/英語資格の継続",
              "志望校/併願校の仮決定",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "12": {
            title: "インプットと自己分析の開始",
            subtitle: "出願条件の理解と達成準備",
            description: "この段階では、受験というより『自分を知る・制度を知る』ことが中心。まだ焦る必要はなく、総合型選抜・推薦入試がどんな試験かを正しく理解し、長期的に準備を進める土台を作る時期。",
            tasks: [
              "総合型選抜・学校推薦型選抜の制度や流れを学ぶ（基礎理解）",
              "各大学・学部の選抜方式や違いを調べる",
              "志望校や併願校の候補を複数挙げておく",
              "「やるべきこと」「やらないべきこと」を整理し、優先順位を決める",
              "総合型選抜全体のスケジュールを年間で把握",
              "自己分析を開始（価値観・性格・経験・将来像の言語化）",
              "評定平均を上げる努力（4.0以上が目標）",
              "英語資格取得（英検2級レベル）に向けた学習",
              "ボランティア・地域貢献・文化活動などの参加を開始（継続的に）"
            ]
          },
          "1": {
            title: "自己分析の深化と方向性の形成",
            subtitle: "",
            description: "12月に始めた自己分析をより深め、自分の軸や価値観を明確にする時期。同時に、出願条件（評定・資格）を確実に満たす努力を続ける。",
            tasks: [
              "総合型選抜・推薦入試の学習継続（出願条件の確認）",
              "志望校候補を広く調べ、併願可能な大学を比較検討",
              "自己分析を文章化し、自分史・ビジョン・強みを整理",
              "出願書類の書き方や種類を知る（志望理由書・活動報告書など）",
              "評定平均を上げる（主要科目の提出点を意識）",
              "英検・TOEFL・IELTSなど資格試験に向けて対策開始",
              "体験的活動を増やす（ボランティア・講演参加・地域活動など）",
              "長期的に続けられる社会活動・プロジェクトを決めておく"
            ]
          },
          "2": {
            title: "志望方向の具体化と書類準備の開始",
            subtitle: "",
            description: "大学や学部をある程度絞り、出願書類の下書きを開始。ここで「書く・調べる・比べる」を並行しながら、土台を固める。",
            tasks: [
              "志望校・併願校を仮決定（学部・学科レベルまで考える）",
              "自己分析をもとに初期の志望理由文を作成",
              "小論文の基礎問題を学び始める",
              "提出書類（自己PR・活動報告など）の作成を開始",
              "評定・資格の基準値を確実に満たす",
              "過去問請求・出願条件の問い合わせ（大学HP・資料請求）",
              "継続的な社会活動を維持し、体験を記録（報告書に活かす）"
            ]
          },
          "3": {
            title: "志望校仮決定と学習習慣の確立",
            subtitle: "",
            description: "春休みを活かして、学びと行動の両方をバランスよく整える。海外プログラムや新しい経験を積む良いタイミング。",
            tasks: [
              "志望校・学部・学科の仮決定（複数案を用意）",
              "英検などの資格試験を受験し、出願基準を満たす",
              "小論文の基礎問題を継続演習",
              "第一志望の提出書類の下書き完成",
              "短期留学・プログラム・ボランティアへの参加",
              "書類で使える活動実績や体験を蓄積"
            ]
          }
        }
      },
      "高3": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2"],
        categories: [
          { id: "research", name: "志望校リサーチ", color: "green", start: "4", end: "7" },
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "8" },
          { id: "docs", name: "書類準備", color: "orange", start: "4", end: "9" },
          { id: "essay", name: "小論文対策", color: "purple", start: "4", end: "11" },
          { id: "study", name: "研究活動", color: "cyan", start: "4", end: "9" },
          { id: "interview", name: "面接対策", color: "red", start: "9", end: "11" },
          { id: "apply", name: "出願作業", color: "gray", start: "8", end: "12" }
        ],
        monthDetails: {
          "4": {
            title: "受験スケジュールの確立と研究テーマ決定",
            subtitle: "",
            description: "ここから本格的に受験モードへ。研究テーマを決め、学びを学術的に深化させる。進捗管理を始め、全体を見える化する。",
            tasks: [
              "EQAO進捗管理シートで年間スケジュールを立案",
              "集団授業・交流会・保護者会に参加し意識を高める",
              "志望校・学部・学科を正式決定",
              "オープンキャンパスの予約・参加準備",
              "評定平均・英語資格を再確認（不足があれば補強）",
              "小論文の基礎演習継続",
              "志望理由書の初稿作成開始",
              "研究テーマを決定（興味分野×社会課題×学問領域）",
              "文献・論文・データ分析など調査を開始",
              "ボランティア・地域活動を継続",
              "専願・併願条件の確認・交渉（高校・大学に確認）"
            ]
          },
          "5": {
            title: "研究・書類作成の本格化",
            subtitle: "",
            description: "研究・分析・文献読解など、『自分の研究テーマ』を深める月。出願書類と研究テーマの整合性を取っていく。",
            tasks: [
              "文献・書籍・学術データを用いたリサーチ開始",
              "研究ノート・読書記録をまとめる",
              "小論文の演習を継続（要約・意見・構成練習）",
              "志望理由書を第2稿に更新（根拠を補強）",
              "活動報告書・自己PR文の精度を上げる",
              "評定平均・英語資格の追い込み（最終測定へ）",
              "研究やボランティア活動を習慣化"
            ]
          },
          "6": {
            title: "研究深化と推薦状準備の開始",
            subtitle: "",
            description: "推薦状の依頼を正式に始めるタイミング。研究活動・課外活動・小論文の応用力を強化。",
            tasks: [
              "研究テーマに基づくフィールドワーク・アンケート等を実施",
              "調査報告書・仮レポートを作成",
              "小論文の応用問題演習に移行",
              "出願書類（第一志望）の内容を精査・加筆修正",
              "高校教員に推薦状作成依頼を正式に申し出る",
              "研究成果をまとめ、面接・書類両方で活かせる形に整える"
            ]
          },
          "7": {
            title: "学校連携・書類整理の最終段階",
            subtitle: "",
            description: "いよいよ校内手続きが動き出す。調査書・推薦状・証明書など、出願に必要な全書類を整える重要な月。",
            tasks: [
              "部活動引退・受験専念",
              "志望校・併願校リストを学校に正式提示",
              "調査書記載内容を相談・確認",
              "新年度の大学募集要項を最新版に更新",
              "小論文の応用演習を継続（記述＋口頭説明）",
              "推薦状依頼を完了・内容確認",
              "各種賞状・検定証・活動証明書を整理・コピー",
              "調査書発行願いを提出（大学ごとに申請）",
              "出願日程と学校行事を照合し、重複を回避"
            ]
          },
          "8": {
            title: "夏休み：活動・資格・書類の総仕上げ",
            subtitle: "",
            description: "最も重要な集中特訓期間。EQAOイベントや模試・合宿を活用し、実践力を磨く。",
            tasks: [
              "部活動完全引退・受験一本化",
              "志望理由書以外の書類（活動報告書・課題レポート等）を仕上げる",
              "調査書・証明書の発行・照合作業を完了",
              "英語資格原本照合（高校・大学両方で確認）",
              "指定校推薦の出願判断を確定",
              "研究活動・ボランティア・プログラム参加を集中実施",
              "EQAO CAMP／STUDY TOURなど合宿・研修参加",
              "小論文の過去問演習を開始",
              "提出書類（第一志望）を完成・最終確認",
              "Web出願登録開始（不備チェック）"
            ]
          },
          "9": {
            title: "出願本番と一次審査突破期",
            subtitle: "",
            description: "ついに出願開始。書類提出・一次審査・模試・面接対策が同時進行。焦らず確実に、期限管理が命。",
            tasks: [
              "出願Web登録・郵送作業を本格化",
              "指定校推薦結果発表（一次審査）",
              "小論文の過去問演習を本格化",
              "面接対策を開始（書類からの想定質問100問）",
              "レポート課題 着手開始",
              "課外活動・ボランティアの最終整理",
              "大学から受験番号発行",
              "EQAO出願サポートを受ける",
              "EQAO模試を受験（本番シミュレーション）"
            ]
          },
          "10": {
            title: "総合型選抜ピーク期／二次試験対策本格化",
            subtitle: "",
            description: "最も緊張感の高い月。面接・小論文の最終仕上げ。EQAO模試と面接練習を最大限活用する。",
            tasks: [
              "出願継続（残り大学対応）",
              "EQAO模試本格化／結果分析フィードバック",
              "小論文過去問・応用問題演習",
              "二次試験（面接・小論文）本格練習",
              "EQAO出願サポート・書類最終添削",
              "一次審査結果の確認と再出願準備",
              "面接100問＋書類質問100問の想定練習",
              "大学から受験番号通知"
            ]
          },
          "11": {
            title: "学校推薦型選抜出願・結果ラッシュ期",
            subtitle: "",
            description: "公募推薦と総合型選抜の結果・試験が重なる時期。「合格確定者」と「最終試験者」に分かれ動く。",
            tasks: [
              "公募推薦の出願開始（高校との調整）",
              "二次試験（小論文・面接）本格化",
              "総合型選抜の結果発表開始（順次）",
              "入学手続き関連（合格者向け）を進行",
              "EQAO模試最終実施／最終対策",
              "出願サポート継続（最後の大学まで）",
              "面接練習継続／自己表現力の最終確認",
              "卒塾手続き開始（合格者より順次）"
            ]
          },
          "12": {
            title: "結果発表・卒塾・次のステージへ",
            subtitle: "",
            description: "結果が出揃い始める。受験の総仕上げと次への準備を同時に行う。「合格＝ゴール」ではなく「スタート」として捉える。",
            tasks: [
              "総合型・公募推薦の最終結果発表",
              "第二期募集・追加出願対応者の書類準備",
              "入学手続き・入学金納入・必要書類提出",
              "EQAO PARTY FOR NEXT STAGE（卒塾式）開催",
              "後輩向けメッセージ・インタビュー協力"
            ]
          },
          "1": {
            title: "次への選択と切り替え",
            subtitle: "",
            description: "合格者は入学準備、不合格者は一般・海外・再挑戦を決定する。精神面・方向性を整える重要な時期。",
            tasks: [
              "一般入試への切り替え・対策開始",
              "併願校の入試対策実施",
              "海外大学進学の検討",
              "浪人・再挑戦の判断",
              "大学側から課される入学前課題の対応",
              "各種手続き・書類最終確認"
            ]
          },
          "2": {
            title: "共通テスト利用・後期募集対応",
            subtitle: "",
            description: "最終追い込み。国公立や私立の後期型、共通テスト利用型の対策。最後まで学び続ける姿勢を保つ。",
            tasks: [
              "共通テスト利用の国公立型選抜対策",
              "総合型選抜の2期・3期募集出願",
              "一般入試・後期入試の準備",
              "EQAO講師・メンターとの面談で進路確定"
            ]
          }
        }
      }
    };

    // カテゴリの色と名前のマッピング
    const categoryInfo = {
      self: { name: "自己分析・自己理解", color: "blue" },
      research: { name: "志望校リサーチ", color: "green" },
      grade: { name: "評定・英語資格", color: "yellow" },
      docs: { name: "書類準備", color: "orange" },
      essay: { name: "小論文対策", color: "purple" },
      activity: { name: "課外活動・ボランティア", color: "cyan" },
      study: { name: "研究活動", color: "cyan" },
      interview: { name: "面接対策", color: "red" },
      apply: { name: "出願作業", color: "gray" }
    };

    // 状態
    let selectedGrade = "高2";
    let selectedMonth = null;

    // ============================================
    // API設定
    // ============================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbyEZYtWGd0JzLGrw2sysVktA88fk-ohHOnkAPS-8K8ezmCnRyNxMiuE2O4AsMfMqcE/exec';
    
    // 生徒IDを取得
    function getStudentId() {
      return localStorage.getItem('eqao_studentId') || 'GUEST';
    }

    // ============================================
    // 進捗チェックリストデータ
    // ============================================
    const checklistData = {
      "高1": [
        "評定平均に力を入れ、4.0を目指す",
        "部活動に力を入れ、継続力や忍耐力をつける",
        "欠席や遅刻をしないよう心がけ、内申点を高得点に保つ",
        "多様なプログラムに積極的に参加し、視野を広げ、コミュニケーション能力を鍛える",
        "なぜ？を意識しながら行動し、思考力を鍛え研究テーマとなるきっかけを探る",
        "本や映画を積極的に視聴し視野を広げる",
        "基礎学力をおろそかにせず、特に英語、国語、数学、歴史には注力する",
        "英語資格（英検とIELTS）に力を入れて、２級獲得を目指す",
        "総合型選抜とは何かを理解する",
        "総合型選抜でやるべきことやスケジュールを理解する",
        "過去の人生を振り返り自分だからこその魅力や人間性、強み、経歴を客観視し、自分の武器を理解する",
        "現時点で将来つきたい職業、やりたいこと、目標を言語化する",
        "保護者や友人、メンターとディスカッションを重ね、自分の性格を知る",
        "チェックリストから志望理由書の基礎をインプットする",
        "チェックリストから自己推薦書の基礎をインプットする",
        "チェックリストから提出書類の基礎をインプットする",
        "チェックリストから出願資格の基礎をインプットする",
        "チェックリストから志望校/併願校決めの基礎をインプットする",
        "チェックリストから小論文の基礎をインプットする",
        "チェックリストからレポートの基礎をインプットする",
        "チェックリストから面接の基礎をインプットする",
        "チェックリストからプレゼンテーションの基礎をインプットする",
        "集団授業に全て参加し、過去の授業も視聴する",
        "チェックリストから考え方の基礎をインプットする",
        "EQAO生が読むべき本を購入し朗読を開始する",
        "すき見つけるテクニックをインプットする",
        "すきを伸ばすためのテクニックをインプットする",
        "EQAOのステップアップ動画教材を20%は視聴完了させる",
        "EQAO配信のコラムとYouTube動画を視聴して基礎を固める",
        "高校2年からの計画表、スケジュールを作成する"
      ],
      "高2": [
        "第一志望校を確定させる",
        "評定平均と英語資格など全ての条件を満たした時の併願校一覧を決める",
        "評定平均のみ満たした場合の併願校一覧を決める",
        "英語資格のみ満たした場合の併願校一覧を決める",
        "何も満たせなかった場合の併願校一覧を決める",
        "志望校や併願校を調べ、比較し、それぞれの特徴や特色、違いを踏まえる",
        "研究テーマをさらに深掘り、本質的かつ発展的なテーマにする",
        "志望校、併願校の教授の素性や経歴、専門分野などを指定ツールを使用して把握する",
        "土台となる第一志望校の志望理由書や自己推薦書を量を気にすることなく具体的に書き始める",
        "志望校の最も気になる教授の書籍や論文を読み始める",
        "評定平均と英語資格を継続的に取り組む",
        "志望校/併願校の過去問を請求する",
        "継続的に研究テーマに関連する支援活動を行う",
        "多様なプログラムや大会に参加し視野を広げ、経験を積む",
        "継続してEQAOのステップアップ動画教材を視聴して60%は視聴完了させる",
        "継続してEQAOのコラムとYouTube配信に目を通す",
        "志望校の志望理由書以外の書類にも着手する",
        "研究テーマの仮説検証行動に着手する",
        "時事問題をキャッチアップし始める",
        "関連するテーマの書籍や教授の書籍を視聴する",
        "志望する学部の関連テーマの小論文に着手する",
        "志望校の過去問に一度触れて小論文の癖や特徴を理解する",
        "志望校/併願校の過去問回収を行う",
        "オープンキャンパスや模擬講義に参加する",
        "留学や短期留学、スタディーツアーに参加する",
        "一般入試にも備えて基礎学力も上げておく",
        "英検準一級/IELTS5.5を狙う（EQAOではIELTSを推奨）",
        "継続して集団授業を受講する/過去の配信も全て閲覧する",
        "高校3年からの計画表、スケジュールを作成する"
      ],
      "高3": [
        "志望校／併願校ともに確定させる",
        "各志望校に向けた書類の転用と調整を行う",
        "新しく発行された募集要項を確認する",
        "最新版の過去問請求を行う",
        "評定平均／英語資格の基準を満たす",
        "英検準一級／IELTS5.5／評定平均4.0獲得",
        "課題レポート（書類）に着手する",
        "小論文の専門分野の演習を継続する",
        "過去問分析と過去問演習を行う",
        "時事問題のキャッチアップを継続する",
        "倍率の分析を行う",
        "出願サポートを受ける",
        "面接100問基礎は徹底する",
        "書類からの質問を100問想定する",
        "大学や社会・時事問題に関して50問を想定する",
        "研究テーマに関する仮説検証行動を行う",
        "研究テーマに関連する研究発表・プレゼン大会・課題解決系イベントに参加する",
        "要約問題のチェックリストを埋める",
        "出願2ヶ月前には推薦状を高校に依頼する",
        "調査書に書いてもらいたい内容・提出書類を担任の先生に共有し、リンクをおすすめる",
        "担任の先生とのコミュニケーションを増やす",
        "指定校推薦を出してもよいが妥協はしない",
        "英語資格の原本照合用コピーを複数作成しておく",
        "英語資格を複数回受験し、異なる種類も取得しておく",
        "賞状などはクリアファイルで徹底管理し、提出しやすくする",
        "オープンキャンパスに行く",
        "研究テーマ以外の本を一冊読む",
        "研究テーマ以外の映画を見る",
        "漢字の基礎を徹底する",
        "志望理由書を複数パターン作成し、最適なものを選んで提出する",
        "志願票のためのプロフィールを整理しておく",
        "活動報告書のためのプロフィールを整理しておく（学校内外問わず）",
        "研究テーマ以外の活動にも積極的に参加する",
        "スタディツアーに参加する",
        "専願か併願かを確認する",
        "Web出願・登録の有無を確認する",
        "併願スケジュールを学校に提出し、調査書発行願いを早めに出す",
        "分からないことがあれば大学に直接確認する",
        "集団授業に参加する",
        "小論文の練習のために口頭試問にも触れる",
        "小論文ネタ・事例ノートを作成する",
        "グラフ問題が出題される場合の対策を行う",
        "関連する他大学の同分野過去問にも触れる",
        "「しないことリスト」を作成する",
        "自分の弱点・癖・懸念を認知し、段階的に払拭していく",
        "保護者への伝達を怠らない",
        "進捗管理・スケジュール管理を徹底する",
        "三者面談・塾長面談を受けて方向性を確認する",
        "EQAO模試を受験する",
        "授業外学習を徹底すること"
      ]
    };

    // チェック状態（後でAPIから取得）
    let checkedItems = {
      "高1": [],
      "高2": [],
      "高3": []
    };

    let selectedChecklistGrade = "高1";

    // チェックリスト表示切り替え
    function toggleChecklist() {
      const wrapper = document.getElementById('checklistWrapper');
      const toggle = document.getElementById('checklistToggle');
      
      wrapper.classList.toggle('open');
      toggle.classList.toggle('open');
      
      if (wrapper.classList.contains('open')) {
        toggle.querySelector('span:first-child').textContent = 'チェックリストを閉じる';
        renderChecklist();
      } else {
        toggle.querySelector('span:first-child').textContent = 'チェックリストを表示';
      }
    }

    // チェックリスト学年選択
    function selectChecklistGrade(grade) {
      selectedChecklistGrade = grade;
      
      document.querySelectorAll('.checklist-grade-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.grade === grade);
      });
      
      renderChecklist();
    }

    // チェックリスト描画
    function renderChecklist() {
      const container = document.getElementById('checklistItems');
      const items = checklistData[selectedChecklistGrade];
      const checked = checkedItems[selectedChecklistGrade] || [];
      
      let html = '';
      items.forEach((item, index) => {
        const isChecked = checked.includes(index);
        html += `
          <div class="checklist-item ${isChecked ? 'checked' : ''}" onclick="toggleChecklistItem('${selectedChecklistGrade}', ${index})">
            <div class="checklist-checkbox">
              <span class="material-icons">check</span>
            </div>
            <div class="checklist-text">
              <span class="checklist-number">${index + 1}.</span>
              ${escapeHtml(item)}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // チェックリスト項目トグル
    async function toggleChecklistItem(grade, index) {
      const checked = checkedItems[grade] || [];
      const idx = checked.indexOf(index);
      
      if (idx === -1) {
        checked.push(index);
      } else {
        checked.splice(idx, 1);
      }
      
      checkedItems[grade] = checked;
      renderChecklist();
      updateProgressDisplay();
      
      // APIに保存
      const studentId = getStudentId();
      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'saveChecklist',
            studentId: studentId,
            grade: grade,
            checkedItems: checked
          }),
          mode: 'no-cors'
        });
        console.log('Checklist saved');
      } catch (error) {
        console.error('API error:', error);
      }
    }

    // 進捗表示更新
    function updateProgressDisplay() {
      const total = 109; // 高1:30 + 高2:29 + 高3:50
      const count1 = (checkedItems["高1"] || []).length;
      const count2 = (checkedItems["高2"] || []).length;
      const count3 = (checkedItems["高3"] || []).length;
      const totalChecked = count1 + count2 + count3;
      const percent = Math.round((totalChecked / total) * 100);
      
      document.getElementById('totalProgressBar').style.width = percent + '%';
      document.getElementById('totalProgressPercent').textContent = percent + '%';
      document.getElementById('progress1Count').textContent = count1 + '/30';
      document.getElementById('progress2Count').textContent = count2 + '/29';
      document.getElementById('progress3Count').textContent = count3 + '/50';
    }

    // チェックリストをAPIから読み込み
    async function loadChecklist() {
      const studentId = getStudentId();
      try {
        const url = `${API_URL}?action=getChecklist&studentId=${studentId}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data) {
          if (data["高1"]) checkedItems["高1"] = data["高1"];
          if (data["高2"]) checkedItems["高2"] = data["高2"];
          if (data["高3"]) checkedItems["高3"] = data["高3"];
        }
        
        updateProgressDisplay();
      } catch (error) {
        console.error('API error:', error);
        updateProgressDisplay();
      }
    }

    // ============================================
    // 志望校／併願校関連
    // ============================================
    
    let schools = [];
    let selectedSchoolIndex = -1;
    let editingSchoolId = null;

    // 志望校タブ描画
    function renderSchoolTabs() {
      const container = document.getElementById('schoolTabs');
      const emptyState = document.getElementById('schoolEmpty');
      const detailCard = document.getElementById('schoolDetail');
      
      let html = '';
      
      schools.forEach((school, index) => {
        const isActive = index === selectedSchoolIndex;
        html += `
          <div class="school-tab ${isActive ? 'active' : ''}" onclick="selectSchool(${index})">
            <div class="school-tab-rank">第${index + 1}志望</div>
            <div class="school-tab-name">${escapeHtml(school.universityName)}</div>
            <div class="school-tab-faculty">${escapeHtml(school.faculty)}</div>
          </div>
        `;
      });
      
      // 追加ボタン（6校未満の場合）
      if (schools.length < 6) {
        html += `
          <div class="school-tab add-tab" onclick="openSchoolModal()">
            <span class="material-icons">add</span>
            <div class="school-tab-name">追加</div>
          </div>
        `;
      }
      
      container.innerHTML = html;
      
      // 空状態の表示切り替え
      if (schools.length === 0) {
        emptyState.style.display = 'block';
        detailCard.classList.remove('show');
      } else {
        emptyState.style.display = 'none';
        renderSchoolDetail();
      }
    }

    // 志望校選択
    function selectSchool(index) {
      // 同じものをクリックしたら閉じる（トグル）
      if (selectedSchoolIndex === index) {
        selectedSchoolIndex = -1;
      } else {
        selectedSchoolIndex = index;
      }
      renderSchoolTabs();
    }

    // 志望校詳細描画
    function renderSchoolDetail() {
      const container = document.getElementById('schoolDetail');
      const school = schools[selectedSchoolIndex];
      
      if (!school) {
        container.classList.remove('show');
        return;
      }
      
      // 順位ドロップダウンのオプションを生成
      let rankOptions = '';
      for (let i = 0; i < schools.length; i++) {
        const selected = i === selectedSchoolIndex ? 'selected' : '';
        rankOptions += `<option value="${i}" ${selected}>第${i + 1}志望</option>`;
      }
      
      let html = `
        <div class="school-detail-header">
          <div class="school-detail-title">
            <div class="school-detail-name">${escapeHtml(school.universityName)}</div>
            <div class="school-detail-faculty">${escapeHtml(school.faculty)}${school.department ? ' ' + escapeHtml(school.department) : ''}</div>
            <div class="school-badges">
              ${school.applicationType ? `<span class="school-badge type-${school.applicationType === '専願' ? 'sengan' : 'heigan'}">${escapeHtml(school.applicationType)}</span>` : ''}
              ${school.examType ? `<span class="school-badge" style="background:#E3F2FD;color:#1565C0;">${escapeHtml(school.examType)}</span>` : ''}
              ${school.region ? `<span class="school-badge" style="background:#F3E5F5;color:#7B1FA2;">${escapeHtml(school.region)}</span>` : ''}
            </div>
          </div>
          <div class="school-detail-actions">
            <select class="school-rank-select" onchange="changeSchoolRank(${selectedSchoolIndex}, this.value)">
              ${rankOptions}
            </select>
            <button class="school-action-btn edit-btn" onclick="editSchool(${selectedSchoolIndex})">
              <span class="material-icons">edit</span>
              編集
            </button>
            <button class="school-action-btn delete-btn" onclick="deleteSchool(${selectedSchoolIndex})">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
        
        <div class="school-info-grid">
          <!-- 出願要件 -->
          <div class="school-info-section">
            <div class="school-info-section-title">
              <span class="material-icons">description</span>
              出願要件
            </div>
            ${renderInfoRow('英語資格', school.englishReq)}
            ${renderInfoRow('評定条件', school.gpaReq)}
            ${renderInfoRow('推薦状', school.recommendation)}
            ${renderInfoRow('英語証明', school.englishCert)}
            ${renderInfoRow('賞状提出', school.awards)}
            ${renderInfoRow('締切扱い', school.deadlineType)}
            ${school.documents ? renderInfoRow('出願書類', school.documents) : ''}
          </div>
          
          <!-- 試験内容 -->
          <div class="school-info-section">
            <div class="school-info-section-title">
              <span class="material-icons">quiz</span>
              試験内容
            </div>
            ${renderYesNo('小論文', school.essay)}
            ${renderYesNo('面接', school.interview)}
            ${renderYesNo('口頭試問', school.oral)}
            ${renderYesNo('GD', school.groupDiscussion)}
            ${renderYesNo('プレゼン', school.present)}
            ${renderYesNo('英語面接', school.englishInterview)}
            ${renderYesNo('英語プレゼン', school.englishPresent)}
            ${school.format ? renderInfoRow('実施形式', school.format) : ''}
          </div>
          
          <!-- その他試験 -->
          <div class="school-info-section">
            <div class="school-info-section-title">
              <span class="material-icons">assignment</span>
              その他
            </div>
            ${renderYesNo('二次科目', school.secondExam)}
            ${renderYesNo('資料作成', school.material)}
            ${renderYesNo('動画資料', school.video)}
            ${renderYesNo('二次有無', school.hasSecond)}
            ${school.secondApplicationPeriod ? renderInfoRow('二次出願', school.secondApplicationPeriod) : ''}
          </div>
          
          <!-- 日程・データ -->
          <div class="school-info-section">
            <div class="school-info-section-title">
              <span class="material-icons">event</span>
              日程・データ
            </div>
            ${school.examDate ? renderInfoRow('入試日程', formatDisplayDate(school.examDate)) : ''}
            ${school.firstResultDate ? renderInfoRow('一次発表', formatDisplayDate(school.firstResultDate)) : ''}
            ${school.deviation ? renderInfoRow('偏差値', school.deviation) : ''}
            ${school.ratio ? renderInfoRow('倍率', school.ratio + '倍') : ''}
            ${school.applicants ? renderInfoRow('志願者数', school.applicants + '人') : ''}
          </div>
        </div>
        
        ${school.notes ? `
          <div class="school-info-section" style="margin-top:16px;">
            <div class="school-info-section-title">
              <span class="material-icons">notes</span>
              備考
            </div>
            <p style="font-size:13px;color:#666;margin:0;white-space:pre-wrap;">${escapeHtml(school.notes)}</p>
          </div>
        ` : ''}
      `;
      
      container.innerHTML = html;
      container.classList.add('show');
    }

    // 情報行を描画
    function renderInfoRow(label, value) {
      if (!value) return '';
      return `
        <div class="school-info-row">
          <span class="school-info-label">${label}</span>
          <span class="school-info-value">${escapeHtml(value)}</span>
        </div>
      `;
    }

    // 有無を描画
    function renderYesNo(label, value) {
      if (!value) return '';
      const isYes = value === '有';
      return `
        <div class="school-info-row">
          <span class="school-info-label">${label}</span>
          <span class="school-info-value ${isYes ? 'yes' : 'no'}">${isYes ? '✓' : '−'}</span>
        </div>
      `;
    }

    // 日付フォーマット
    function formatDisplayDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
    }

    // 志望校を上下に移動
    // 志望順位を変更
    async function changeSchoolRank(fromIndex, toIndex) {
      toIndex = parseInt(toIndex);
      if (fromIndex === toIndex) return;
      
      // 配列から要素を取り出して新しい位置に挿入
      const school = schools.splice(fromIndex, 1)[0];
      schools.splice(toIndex, 0, school);
      
      selectedSchoolIndex = toIndex;
      renderSchoolTabs();
      
      // APIに保存
      await saveSchoolsToAPI();
    }

    // モーダルを開く
    function openSchoolModal(schoolIndex = null) {
      const modal = document.getElementById('schoolModal');
      const title = document.getElementById('modalTitle');
      const form = document.getElementById('schoolForm');
      
      form.reset();
      editingSchoolId = null;
      
      if (schoolIndex !== null && schools[schoolIndex]) {
        // 編集モード
        title.textContent = '志望校を編集';
        editingSchoolId = schoolIndex;
        const school = schools[schoolIndex];
        
        // フォームに値をセット
        document.getElementById('universityName').value = school.universityName || '';
        document.getElementById('faculty').value = school.faculty || '';
        document.getElementById('department').value = school.department || '';
        document.getElementById('region').value = school.region || '';
        document.getElementById('applicationTypeSelect').value = school.applicationType || '';
        document.getElementById('examType').value = school.examType || '';
        document.getElementById('englishReq').value = school.englishReq || '';
        document.getElementById('gpaReq').value = school.gpaReq || '';
        document.getElementById('documents').value = school.documents || '';
        document.getElementById('recommendationSelect').value = school.recommendation || '';
        document.getElementById('englishCertSelect').value = school.englishCert || '';
        document.getElementById('awardsSelect').value = school.awards || '';
        document.getElementById('deadlineTypeSelect').value = school.deadlineType || '';
        document.getElementById('essaySelect').value = school.essay || '';
        document.getElementById('interviewSelect').value = school.interview || '';
        document.getElementById('oralSelect').value = school.oral || '';
        document.getElementById('groupDiscussionSelect').value = school.groupDiscussion || '';
        document.getElementById('formatSelect').value = school.format || '';
        document.getElementById('englishInterviewSelect').value = school.englishInterview || '';
        document.getElementById('englishPresentSelect').value = school.englishPresent || '';
        document.getElementById('presentSelect').value = school.present || '';
        document.getElementById('secondExamSelect').value = school.secondExam || '';
        document.getElementById('materialSelect').value = school.material || '';
        document.getElementById('videoSelect').value = school.video || '';
        document.getElementById('hasSecondSelect').value = school.hasSecond || '';
        document.getElementById('examDate').value = school.examDate || '';
        document.getElementById('firstResultDate').value = school.firstResultDate || '';
        document.getElementById('secondApplicationPeriod').value = school.secondApplicationPeriod || '';
        document.getElementById('deviation').value = school.deviation || '';
        document.getElementById('ratio').value = school.ratio || '';
        document.getElementById('applicants').value = school.applicants || '';
        document.getElementById('notes').value = school.notes || '';
      } else {
        title.textContent = '志望校を追加';
      }
      
      modal.classList.add('show');
    }

    // モーダルを閉じる
    function closeSchoolModal() {
      document.getElementById('schoolModal').classList.remove('show');
      editingSchoolId = null;
    }

    // 編集ボタン
    function editSchool(index) {
      openSchoolModal(index);
    }

    // 保存
    async function saveSchool() {
      const universityName = document.getElementById('universityName').value.trim();
      const faculty = document.getElementById('faculty').value.trim();
      
      if (!universityName || !faculty) {
        alert('大学名と学部は必須です');
        return;
      }
      
      const schoolData = {
        universityName,
        faculty,
        department: document.getElementById('department').value.trim(),
        region: document.getElementById('region').value.trim(),
        applicationType: document.getElementById('applicationTypeSelect').value,
        examType: document.getElementById('examType').value.trim(),
        englishReq: document.getElementById('englishReq').value.trim(),
        gpaReq: document.getElementById('gpaReq').value.trim(),
        documents: document.getElementById('documents').value.trim(),
        recommendation: document.getElementById('recommendationSelect').value,
        englishCert: document.getElementById('englishCertSelect').value,
        awards: document.getElementById('awardsSelect').value,
        deadlineType: document.getElementById('deadlineTypeSelect').value,
        essay: document.getElementById('essaySelect').value,
        interview: document.getElementById('interviewSelect').value,
        oral: document.getElementById('oralSelect').value,
        groupDiscussion: document.getElementById('groupDiscussionSelect').value,
        format: document.getElementById('formatSelect').value,
        englishInterview: document.getElementById('englishInterviewSelect').value,
        englishPresent: document.getElementById('englishPresentSelect').value,
        present: document.getElementById('presentSelect').value,
        secondExam: document.getElementById('secondExamSelect').value,
        material: document.getElementById('materialSelect').value,
        video: document.getElementById('videoSelect').value,
        hasSecond: document.getElementById('hasSecondSelect').value,
        examDate: document.getElementById('examDate').value,
        firstResultDate: document.getElementById('firstResultDate').value,
        secondApplicationPeriod: document.getElementById('secondApplicationPeriod').value.trim(),
        deviation: document.getElementById('deviation').value.trim(),
        ratio: document.getElementById('ratio').value.trim(),
        applicants: document.getElementById('applicants').value.trim(),
        notes: document.getElementById('notes').value.trim()
      };
      
      if (editingSchoolId !== null) {
        // 編集
        schools[editingSchoolId] = schoolData;
      } else {
        // 新規追加
        schools.push(schoolData);
        selectedSchoolIndex = schools.length - 1;
      }
      
      closeSchoolModal();
      renderSchoolTabs();
      
      // APIに保存
      await saveSchoolsToAPI();
    }

    // 削除
    async function deleteSchool(index) {
      const school = schools[index];
      if (!confirm(`「${school.universityName} ${school.faculty}」を削除しますか？`)) {
        return;
      }
      
      schools.splice(index, 1);
      if (selectedSchoolIndex >= schools.length) {
        selectedSchoolIndex = Math.max(0, schools.length - 1);
      }
      
      renderSchoolTabs();
      
      // APIに保存
      await saveSchoolsToAPI();
    }

    // APIに保存
    async function saveSchoolsToAPI() {
      const studentId = getStudentId();
      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'saveSchools',
            studentId: studentId,
            schools: schools
          }),
          mode: 'no-cors'
        });
        console.log('Schools saved');
      } catch (error) {
        console.error('API error:', error);
      }
    }

    // APIから読み込み
    async function loadSchools() {
      const studentId = getStudentId();
      try {
        const url = `${API_URL}?action=getSchools&studentId=${studentId}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data && Array.isArray(data)) {
          schools = data;
        }
        
        renderSchoolTabs();
      } catch (error) {
        console.error('API error:', error);
        renderSchoolTabs();
      }
    }

    // ============================================
    // 宿題・授業履歴関連
    // ============================================

    // アコーディオントグル
    // ============================================
    // 宿題・授業履歴関連
    // ============================================

    // サンプルデータ（将来的にAPIから取得）
    const lessonData = [
      {
        date: '12/10（火）',
        type: '通常授業',
        teacher: '山田先生',
        majorSubjectId: 6,
        minorSubjects: ['志望理由書テクニック（構成・段落）', '志望理由書実践と修正'],
        content: '・志望理由書の黄金構成を解説<br>・きっかけ→課題意識→試行錯誤→学びの必要性→マッチング→学習計画<br>・第1段落を添削',
        homework: '・志望理由書の第2〜3段落を書いてくる<br>・教授の研究テーマを3つ調べてメモする'
      },
      {
        date: '12/8（日）',
        type: '小論文',
        teacher: '佐藤先生',
        majorSubjectId: 5,
        minorSubjects: ['小論文過去問演習'],
        content: '・志望校の過去問演習（2023年度）<br>・論理構成の見直し',
        homework: '・過去問をもう1年分解く<br>・時事ニュース5本を要約'
      },
      {
        date: '12/5（木）',
        type: '面接対策',
        teacher: '鈴木先生',
        majorSubjectId: 9,
        minorSubjects: ['面接基礎100問の言語化', '発声・表情・視線のコントロール'],
        content: '・模擬面接の実施<br>・志望動機の深掘り練習<br>・非言語コミュニケーションの確認',
        homework: '・想定質問50問への回答を用意<br>・自己PRの1分バージョンを暗記<br>・鏡の前で練習'
      },
      {
        date: '12/3（火）',
        type: '通常授業',
        teacher: '山田先生',
        majorSubjectId: 3,
        minorSubjects: ['仮説検証とテーマ深掘り', '研究ツールの使い方（論文検索・ResearchMap等）'],
        content: '・CiNiiとGoogle Scholarを使った論文検索の実践<br>・先行研究を3本読み、リサーチクエスチョンを再設定',
        homework: '・見つけた論文を1本読んで要約（300字）<br>・自分の研究テーマとの関連性をメモ'
      },
      {
        date: '12/1（日）',
        type: '通常授業',
        teacher: '佐藤先生',
        majorSubjectId: 2,
        minorSubjects: ['過去の振り返り（ライフライン分析）', '現在の自己理解と価値観整理', '研究テーマに繋がる素材抽出'],
        content: '・ライフラインチャートを作成<br>・感情の山谷を整理<br>・高校2年の文化祭実行委員の経験から「リーダーシップ」と「地域貢献」を抽出',
        homework: '・3案の研究テーマについて「なぜ興味があるか」を200字で書く<br>・関連しそうな大学・学部を3つずつリストアップ'
      },
      {
        date: '11/28（木）',
        type: '面接対策',
        teacher: '鈴木先生',
        majorSubjectId: 9,
        minorSubjects: ['圧迫面接・深掘り/口頭試問対策'],
        content: '・圧迫質問への対応練習<br>・矛盾を指摘された時の切り返し方<br>・「研究テーマに戻る」技術の習得',
        homework: '・想定される反論を10個書き出す<br>・それぞれへの回答を用意'
      },
      {
        date: '11/26（火）',
        type: '通常授業',
        teacher: '山田先生',
        majorSubjectId: 4,
        minorSubjects: ['研究テーマの実践', '先行研究・論文・書籍の読み込み'],
        content: '・フィールドワークの計画立案<br>・アンケート設計の基礎<br>・先行研究のまとめ方',
        homework: '・アンケート質問項目を10問作成<br>・関連書籍を1冊読み始める'
      },
      {
        date: '11/24（日）',
        type: '小論文',
        teacher: '佐藤先生',
        majorSubjectId: 5,
        minorSubjects: ['小論文テクニック（段落構成・型理解）', '小論文基礎演習'],
        content: '・結論→理由→具体例→反論→結論の構成練習<br>・要約問題の解き方',
        homework: '・新聞社説を3本要約（各200字）<br>・小論文基礎問題を2問解く'
      }
    ];

    let selectedLessonIndex = 0;

    // 授業種類に応じたCSSクラスを取得
    function getLessonTypeClass(type) {
      if (!type) return 'type-normal';
      if (type.includes('英語')) return 'type-english';
      if (type.includes('小論文')) return 'type-essay';
      if (type.includes('面接')) return 'type-interview';
      return 'type-normal';
    }

    // 授業リストを描画
    function renderLessonList() {
      const container = document.getElementById('lessonList');
      const emptyState = document.getElementById('homeworkEmpty');
      
      if (lessonData.length === 0) {
        container.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      let html = '';
      lessonData.forEach((lesson, index) => {
        const typeClass = getLessonTypeClass(lesson.type);
        const activeClass = index === selectedLessonIndex ? 'active' : '';
        html += `
          <div class="lesson-item ${activeClass}" onclick="selectLesson(${index})">
            <div class="lesson-item-date">${escapeHtml(lesson.date)}</div>
            <div class="lesson-item-type ${typeClass}">${escapeHtml(lesson.type)}</div>
            <div class="lesson-item-teacher">${escapeHtml(lesson.teacher)}</div>
          </div>
        `;
      });
      
      container.innerHTML = html;
      renderLessonDetail();
    }

    // 授業を選択
    function selectLesson(index) {
      selectedLessonIndex = index;
      
      // アクティブ状態を更新
      document.querySelectorAll('.lesson-item').forEach((item, i) => {
        if (i === index) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
      
      renderLessonDetail();
    }

    // 授業詳細を描画
    function renderLessonDetail() {
      const container = document.getElementById('lessonDetail');
      const lesson = lessonData[selectedLessonIndex];
      
      if (!lesson) {
        container.classList.remove('show');
        return;
      }
      
      const typeClass = getLessonTypeClass(lesson.type);
      
      // 大科目の情報
      const majorSubjectId = lesson.majorSubjectId;
      const majorSubjectName = majorSubjects[majorSubjectId] || '未設定';
      
      // 小科目のチップを生成
      let minorSubjectsHtml = '';
      if (lesson.minorSubjects && lesson.minorSubjects.length > 0) {
        minorSubjectsHtml = '<div class="minor-subjects-list">';
        lesson.minorSubjects.forEach(subject => {
          minorSubjectsHtml += `
            <span class="minor-subject-chip">
              <span class="material-icons">check_circle</span>
              ${escapeHtml(subject)}
            </span>
          `;
        });
        minorSubjectsHtml += '</div>';
      }
      
      container.innerHTML = `
        <div class="lesson-detail-header">
          <div class="lesson-detail-date">${escapeHtml(lesson.date)}</div>
          <div class="lesson-detail-badge ${typeClass}">${escapeHtml(lesson.type)}</div>
          <div class="lesson-detail-teacher">${escapeHtml(lesson.teacher)}</div>
        </div>
        
        <!-- カリキュラムセクション（大科目・小科目） -->
        <div class="curriculum-section">
          <div class="curriculum-section-title">
            <span class="material-icons">school</span>
            カリキュラム
          </div>
          <div class="major-subject-badge">
            <span class="major-subject-number">${majorSubjectId}</span>
            ${escapeHtml(majorSubjectName)}
          </div>
          ${minorSubjectsHtml}
        </div>
        
        <div class="lesson-detail-section">
          <div class="lesson-detail-section-title">
            <span class="material-icons">menu_book</span>
            授業内容
          </div>
          <div class="lesson-detail-section-content">${lesson.content}</div>
        </div>
        
        <div class="lesson-detail-section">
          <div class="lesson-detail-section-title">
            <span class="material-icons">edit_note</span>
            宿題／課題
          </div>
          <div class="lesson-detail-section-content">${lesson.homework}</div>
        </div>
      `;
      
      container.classList.add('show');
    }

    // ============================================
    // 私のスケジュール関連
    // ============================================
    
    // データ（APIから取得）
    let monthlyGoals = {};
    let instructorNotes = [];
    let myPlans = [];
    let editingPlanId = null;
    let selectedColor = 'blue';
    let isLoading = false;

    // カラーマップ
    const colorMap = {
      blue: '#2196F3',
      green: '#4CAF50',
      yellow: '#FFC107',
      orange: '#FF9800',
      purple: '#9C27B0',
      cyan: '#00BCD4',
      red: '#F44336',
      gray: '#9E9E9E'
    };

    // ============================================
    // マイガントチャート関連
    // ============================================

    // マイガントチャート描画
    function renderMyGanttChart() {
      const container = document.getElementById('myGanttChart');
      const grade = selectedGrade;
      const gradePlans = myPlans.filter(p => p.grade === grade);

      const data = idealScheduleData[grade];
      const months = data ? data.months : [];
      const monthCount = months.length;

      if (monthCount === 0) {
        container.innerHTML = '<div class="my-gantt-empty"><p>データがありません</p></div>';
        return;
      }

      // 日付を表示用にフォーマット
      function formatDateShort(dateStr) {
        if (!dateStr) return '';
        const d = new Date(dateStr);
        return `${d.getMonth() + 1}/${d.getDate()}`;
      }

      // 日付から月インデックスを取得（小数点付き）
      function getMonthPosition(dateStr) {
        if (!dateStr) return -1;
        const d = new Date(dateStr);
        const month = String(d.getMonth() + 1);
        const day = d.getDate();
        const daysInMonth = new Date(d.getFullYear(), d.getMonth() + 1, 0).getDate();
        const monthIdx = months.indexOf(month);
        if (monthIdx === -1) return -1;
        // 月内の位置を小数で追加
        return monthIdx + (day - 1) / daysInMonth;
      }

      // 月ヘッダーを生成
      let html = '<div class="my-gantt-header-row">';
      html += '<div class="my-gantt-label-header"></div>';
      html += '<div class="my-gantt-months">';
      months.forEach(m => {
        html += `<div class="my-gantt-month">${m}月</div>`;
      });
      html += '</div></div>';

      if (gradePlans.length === 0) {
        // 予定がない場合は空の行を表示
        html += `
          <div class="my-gantt-empty-row">
            <div class="my-gantt-label"></div>
            <div class="my-gantt-bar-container">
              <div class="my-gantt-placeholder">予定を追加してください</div>
            </div>
          </div>
        `;
        container.innerHTML = html;
        return;
      }
      
      // 日付順にソート
      gradePlans.sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
      
      gradePlans.forEach(plan => {
        const startPos = getMonthPosition(plan.startDate);
        if (startPos === -1) return;

        const bgColor = colorMap[plan.color] || colorMap.blue;
        const isPointEvent = !plan.endDate; // 終了日がない = ピンポイント

        if (isPointEvent) {
          // ピンポイントイベント（マーカー表示）
          const leftPercent = (startPos / monthCount) * 100;
          html += `
            <div class="my-gantt-row">
              <div class="my-gantt-label" title="${escapeHtml(plan.name)}">${escapeHtml(plan.name)}</div>
              <div class="my-gantt-bar-container">
                <div class="my-gantt-marker" 
                     style="margin-left: ${leftPercent}%; background: ${bgColor};"
                     onclick="openPlanModal(${plan.id})"
                     title="${formatDateShort(plan.startDate)}&#10;クリックで編集">
                  <span class="material-icons">place</span>
                </div>
              </div>
            </div>
          `;
        } else {
          // 期間イベント（バー表示）
          const endPos = getMonthPosition(plan.endDate);
          if (endPos === -1) return;
          
          const leftPercent = (startPos / monthCount) * 100;
          const widthPercent = ((endPos - startPos + 0.1) / monthCount) * 100; // 最低幅を確保
          const displayWidth = Math.max(widthPercent, 3); // 最低3%

          html += `
            <div class="my-gantt-row">
              <div class="my-gantt-label" title="${escapeHtml(plan.name)}">${escapeHtml(plan.name)}</div>
              <div class="my-gantt-bar-container">
                <div class="my-gantt-bar" 
                     style="margin-left: ${leftPercent}%; width: ${displayWidth}%; background: ${bgColor};"
                     onclick="openPlanModal(${plan.id})"
                     title="${formatDateShort(plan.startDate)}〜${formatDateShort(plan.endDate)}&#10;クリックで編集">
                  ${formatDateShort(plan.startDate)}〜${formatDateShort(plan.endDate)}
                </div>
              </div>
            </div>
          `;
        }
      });

      container.innerHTML = html;
    }

    // 予定モーダルを開く
    function openPlanModal(planId = null) {
      const modal = document.getElementById('planModal');
      const title = document.getElementById('planModalTitle');
      const deleteBtn = document.getElementById('deletePlanBtn');
      
      const startInput = document.getElementById('planStartDate');
      const endInput = document.getElementById('planEndDate');
      
      // 学年セレクト初期化
      document.querySelectorAll('.plan-grade-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.onclick = () => selectPlanGrade(btn.dataset.grade);
      });
      
      // カラーピッカー初期化
      document.querySelectorAll('.color-option').forEach(opt => {
        opt.classList.remove('selected');
        opt.onclick = () => selectColor(opt.dataset.color);
      });
      document.querySelector('.color-option[data-color="blue"]').classList.add('selected');
      selectedColor = 'blue';

      if (planId !== null) {
        // 編集モード
        const plan = myPlans.find(p => p.id === planId);
        if (plan) {
          title.textContent = '予定を編集';
          editingPlanId = planId;
          document.getElementById('planName').value = plan.name;
          startInput.value = plan.startDate || '';
          endInput.value = plan.endDate || '';
          selectedColor = plan.color || 'blue';
          // 学年セレクト
          document.querySelectorAll('.plan-grade-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.grade === plan.grade);
          });
          document.querySelectorAll('.color-option').forEach(opt => {
            opt.classList.toggle('selected', opt.dataset.color === selectedColor);
          });
          deleteBtn.style.display = 'flex';
        }
      } else {
        // 新規モード
        title.textContent = '予定を追加';
        editingPlanId = null;
        document.getElementById('planName').value = '';
        startInput.value = '';
        endInput.value = '';
        deleteBtn.style.display = 'none';
        // デフォルトで現在選択中の学年を選択
        document.querySelectorAll('.plan-grade-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.grade === selectedGrade);
        });
      }

      modal.classList.add('show');
    }

    // モーダル内の学年を選択
    function selectPlanGrade(grade) {
      document.querySelectorAll('.plan-grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
    }

    // モーダルを閉じる
    function closePlanModal() {
      document.getElementById('planModal').classList.remove('show');
      editingPlanId = null;
    }

    // 色を選択
    function selectColor(color) {
      selectedColor = color;
      document.querySelectorAll('.color-option').forEach(opt => {
        opt.classList.toggle('selected', opt.dataset.color === color);
      });
    }

    // 予定を保存
    async function savePlan() {
      const name = document.getElementById('planName').value.trim();
      const startDate = document.getElementById('planStartDate').value;
      const endDate = document.getElementById('planEndDate').value;
      
      // 選択された学年を取得
      const activeGradeBtn = document.querySelector('.plan-grade-btn.active');
      const planGrade = activeGradeBtn ? activeGradeBtn.dataset.grade : selectedGrade;
      
      if (!name) {
        alert('予定名を入力してください');
        return;
      }
      if (!startDate) {
        alert('開始日を入力してください');
        return;
      }

      // 終了日がある場合、開始日以降かチェック
      if (endDate && new Date(endDate) < new Date(startDate)) {
        alert('終了日は開始日以降を選択してください');
        return;
      }

      if (editingPlanId !== null) {
        // 編集
        const plan = myPlans.find(p => p.id === editingPlanId);
        if (plan) {
          plan.grade = planGrade;
          plan.name = name;
          plan.startDate = startDate;
          plan.endDate = endDate || null;
          plan.color = selectedColor;
        }
      } else {
        // 新規追加
        const newPlan = {
          id: Date.now(),
          grade: planGrade,
          name: name,
          startDate: startDate,
          endDate: endDate || null,
          color: selectedColor
        };
        myPlans.push(newPlan);
      }

      closePlanModal();
      renderMyGanttChart();
      await saveMyPlansToAPI();
    }

    // 予定を削除
    async function deletePlan() {
      if (!editingPlanId) return;
      
      if (confirm('この予定を削除しますか？')) {
        myPlans = myPlans.filter(p => p.id !== editingPlanId);
        closePlanModal();
        renderMyGanttChart();
        await saveMyPlansToAPI();
      }
    }

    // APIに保存
    async function saveMyPlansToAPI() {
      const studentId = getStudentId();
      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'saveMyPlans',
            studentId: studentId,
            plans: myPlans
          }),
          mode: 'no-cors'
        });
        console.log('My plans saved');
      } catch (error) {
        console.error('API error:', error);
      }
    }

    // APIから読み込み
    async function loadMyPlans() {
      const studentId = getStudentId();
      try {
        const url = `${API_URL}?action=getMyPlans&studentId=${studentId}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data && Array.isArray(data)) {
          myPlans = data;
        }
        renderMyGanttChart();
      } catch (error) {
        console.error('API error:', error);
        renderMyGanttChart();
      }
    }

    // 今月やること: 編集モード切り替え
    function toggleGoalsEdit() {
      const display = document.getElementById('goalsDisplay');
      const edit = document.getElementById('goalsEdit');
      const btn = document.getElementById('goalsEditBtn');
      const textarea = document.getElementById('goalsTextarea');
      const goalsText = document.getElementById('monthlyGoalsText');

      if (display.style.display !== 'none') {
        // 編集モードに切り替え
        textarea.value = goalsText.textContent.trim();
        display.style.display = 'none';
        edit.style.display = 'block';
        btn.innerHTML = '<span class="material-icons">close</span>閉じる';
        textarea.focus();
      } else {
        // 表示モードに戻す
        display.style.display = 'block';
        edit.style.display = 'none';
        btn.innerHTML = '<span class="material-icons">edit</span>編集';
      }
    }

    // 今月やること: 保存
    async function saveGoals() {
      const textarea = document.getElementById('goalsTextarea');
      const goalsText = document.getElementById('monthlyGoalsText');
      const grade = selectedGrade;
      const month = selectedMonth || '12';
      const studentId = getStudentId();

      const newGoals = textarea.value.trim();
      
      // ローカルに保存
      const key = `${grade}_${month}`;
      monthlyGoals[key] = newGoals;
      
      if (newGoals) {
        goalsText.textContent = newGoals;
      } else {
        goalsText.textContent = '';
      }

      // 編集モードを閉じる
      toggleGoalsEdit();

      // APIに保存
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'saveGoals',
            studentId: studentId,
            grade: grade,
            month: month,
            content: newGoals
          }),
          mode: 'no-cors'
        });
        console.log('Goals saved to API');
      } catch (error) {
        console.error('API error:', error);
      }
    }

    // 今月やること: キャンセル
    function cancelGoalsEdit() {
      toggleGoalsEdit();
    }

    // 講師指示: 描画
    function renderInstructorNotes() {
      const container = document.getElementById('instructorNotes');
      
      if (!container) return;

      if (instructorNotes.length === 0) {
        container.innerHTML = `
          <div class="instructor-empty">
            <span class="material-icons">assignment</span>
            <p>この月の指示はありません</p>
          </div>
        `;
        return;
      }

      let html = '';
      instructorNotes.forEach(note => {
        html += `
          <div class="instructor-note-item">
            <div class="instructor-note-text">${escapeHtml(note.text || '')}</div>
            ${note.date ? `<div class="instructor-note-date"><span class="material-icons">event</span>${note.date}</div>` : ''}
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // HTMLエスケープ
    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/[&<>"']/g, function(match) {
        const escape = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        };
        return escape[match];
      });
    }

    // 月の目標を読み込み
    async function loadMonthlyGoals(month) {
      const goalsText = document.getElementById('monthlyGoalsText');
      const grade = selectedGrade;
      const key = `${grade}_${month}`;
      
      // ローカルキャッシュを確認
      if (monthlyGoals[key]) {
        goalsText.textContent = monthlyGoals[key];
        return;
      }

      // APIから取得
      const studentId = getStudentId();
      try {
        const url = `${API_URL}?action=getGoals&studentId=${studentId}&grade=${grade}&month=${month}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data && data.content) {
          monthlyGoals[key] = data.content;
          goalsText.textContent = data.content;
        } else {
          goalsText.textContent = '';
        }
      } catch (error) {
        console.error('API error:', error);
        goalsText.textContent = '';
      }
    }

    // ToDoを読み込み
    async function loadInstructorNotes(grade, month) {
      const studentId = getStudentId();
      try {
        const url = `${API_URL}?action=getInstructorNotes&studentId=${studentId}&grade=${grade}&month=${month}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data && Array.isArray(data)) {
          instructorNotes = data;
          renderInstructorNotes();
        } else {
          instructorNotes = [];
          renderInstructorNotes();
        }
      } catch (error) {
        console.error('API error:', error);
        instructorNotes = [];
        renderInstructorNotes();
      }
    }

    // 私のスケジュールから学年選択
    function selectGradeFromMySchedule(grade) {
      // 上の学年ボタンも更新
      selectGrade(grade);
      
      // 下の学年ボタンも更新
      updateMiniGradeButtons(grade);
      
      // 月のドロップダウンを更新
      updateMonthSelect(grade);
    }

    // 私のスケジュールから月選択
    function selectMonthFromMySchedule(month) {
      selectMonth(month);
    }

    // 下の学年ボタンを更新
    function updateMiniGradeButtons(grade) {
      document.querySelectorAll('.mini-grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
    }

    // 月のドロップダウンを更新
    function updateMonthSelect(grade) {
      const select = document.getElementById('monthSelect');
      const data = idealScheduleData[grade];
      
      if (!data || !data.months) {
        select.innerHTML = '<option value="">-</option>';
        return;
      }

      let html = '';
      data.months.forEach(m => {
        const selected = m === selectedMonth ? 'selected' : '';
        html += `<option value="${m}" ${selected}>${m}月</option>`;
      });
      select.innerHTML = html;
    }

    // 月選択ドロップダウンの値を更新（上から選択された時用）
    function updateMonthSelectValue(month) {
      const select = document.getElementById('monthSelect');
      if (select) {
        select.value = month;
      }
    }

    // 初期化
    document.addEventListener('DOMContentLoaded', function() {
      try {
        setNavUserName();
        
        // localStorageから前回の学年・月を復元
        const savedGrade = localStorage.getItem('eqao_schedule_grade');
        const savedMonth = localStorage.getItem('eqao_schedule_month');
        
        if (savedGrade && idealScheduleData[savedGrade]) {
          selectedGrade = savedGrade;
        }
        
        // 上の学年ボタンを更新
        document.querySelectorAll('.grade-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.grade === selectedGrade);
        });
        
        // 下の学年ボタンを初期化
        updateMiniGradeButtons(selectedGrade);
        
        // 月のドロップダウンを初期化
        updateMonthSelect(selectedGrade);
        
        renderGanttChart();
        
        // 月を選択（保存された月 or 現在の月 or 最初の月）
        const data = idealScheduleData[selectedGrade];
        if (savedMonth && data && data.months && data.months.includes(savedMonth)) {
          selectMonth(savedMonth);
        } else {
          const now = new Date();
          const currentMonth = String(now.getMonth() + 1);
          if (data && data.months && data.months.includes(currentMonth)) {
            selectMonth(currentMonth);
          } else if (data && data.months && data.months.length > 0) {
            selectMonth(data.months[0]);
          }
        }
        
        // チェックリストを読み込み
        loadChecklist();
        
        // 志望校を読み込み
        loadSchools();
        
        // 授業履歴を描画
        renderLessonList();
        
        // マイガントチャートを読み込み
        loadMyPlans();
        
      } catch (e) {
        console.error('Initialization error:', e);
      }
    });

    // 学年選択
    function selectGrade(grade) {
      selectedGrade = grade;
      
      // localStorageに保存
      localStorage.setItem('eqao_schedule_grade', grade);
      
      document.querySelectorAll('.grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
      
      // 下の学年ボタンも更新
      updateMiniGradeButtons(grade);
      
      // 月のドロップダウンを更新
      updateMonthSelect(grade);
      
      // ガントチャート再描画
      renderGanttChart();
      
      // マイガントチャート再描画
      renderMyGanttChart();
      
      // 最初の月を選択
      const data = idealScheduleData[grade];
      if (data.months.length > 0) {
        selectMonth(data.months[0]);
      } else {
        document.getElementById('monthDetail').classList.remove('show');
      }
    }

    // ガントチャート描画
    function renderGanttChart() {
      const data = idealScheduleData[selectedGrade];
      const container = document.getElementById('ganttChart');

      if (!data || !data.months || data.months.length === 0) {
        container.innerHTML = '<div class="todo-empty"><span class="material-icons">construction</span><p>準備中です</p></div>';
        return;
      }

      const months = data.months;
      const categories = data.categories || [];

      // 現在の月を取得
      const now = new Date();
      const currentMonth = String(now.getMonth() + 1);

      // ヘッダー（月）
      let html = '<div class="gantt-header">';
      html += '<div class="gantt-label-header">カテゴリ</div>';
      html += '<div class="gantt-months">';
      months.forEach(m => {
        const monthLabel = m + '月';
        const isCurrent = m === currentMonth;
        const isSelected = m === selectedMonth;
        let classes = 'gantt-month';
        if (isCurrent) classes += ' current';
        if (isSelected) classes += ' selected';
        html += `<div class="${classes}" onclick="selectMonth('${m}')">${monthLabel}</div>`;
      });
      html += '</div></div>';

      // 各カテゴリ行
      categories.forEach(cat => {
        const startIdx = months.indexOf(cat.start);
        const endIdx = months.indexOf(cat.end);
        
        // バーの位置と幅を計算（パーセント）
        const barLeft = (startIdx / months.length) * 100;
        const barWidth = ((endIdx - startIdx + 1) / months.length) * 100;
        
        html += '<div class="gantt-row">';
        html += `<div class="gantt-category"><div class="category-color bg-${cat.color}"></div>${cat.name}</div>`;
        html += '<div class="gantt-bars">';
        
        // セル（グリッド線用）
        months.forEach(m => {
          html += '<div class="gantt-cell"></div>';
        });
        
        // バー（連続した1本）
        if (startIdx !== -1 && endIdx !== -1) {
          html += `<div class="gantt-bar color-${cat.color}" style="left: ${barLeft}%; width: ${barWidth}%;"></div>`;
        }
        
        html += '</div></div>';
      });

      container.innerHTML = html;
    }

    // 月が範囲内かチェック
    function isMonthInRange(month, start, end, monthOrder) {
      const monthIdx = monthOrder.indexOf(month);
      const startIdx = monthOrder.indexOf(start);
      const endIdx = monthOrder.indexOf(end);
      
      if (monthIdx === -1 || startIdx === -1 || endIdx === -1) return false;
      return monthIdx >= startIdx && monthIdx <= endIdx;
    }

    // 月選択
    function selectMonth(month) {
      selectedMonth = month;
      
      // localStorageに保存
      localStorage.setItem('eqao_schedule_month', month);
      
      // ガントチャートのヘッダー更新
      document.querySelectorAll('.gantt-month').forEach(el => {
        const m = el.textContent.replace('月', '');
        el.classList.toggle('selected', m === month);
      });

      // 詳細カード表示
      renderMonthDetail(month);
      
      // 私のスケジュール: パネルヘッダー更新
      updatePanelTitles();
      
      // 私のスケジュール: 月ドロップダウン更新
      updateMonthSelectValue(month);
      
      // 私のスケジュール: 目標と講師指示を読み込み
      loadMonthlyGoals(month);
      loadInstructorNotes(selectedGrade, month);

      // 編集モードを閉じる
      const display = document.getElementById('goalsDisplay');
      const edit = document.getElementById('goalsEdit');
      const btn = document.getElementById('goalsEditBtn');
      if (edit && edit.style.display !== 'none') {
        display.style.display = 'block';
        edit.style.display = 'none';
        btn.innerHTML = '<span class="material-icons">edit</span>編集';
      }
    }
    
    // パネルヘッダーのタイトルを更新
    function updatePanelTitles() {
      const grade = selectedGrade;
      const month = selectedMonth || '12';
      
      document.getElementById('goalsPanelTitle').textContent = `${month}月にやること`;
      document.getElementById('instructorPanelTitle').textContent = `${month}月の指示`;
    }

    // 月詳細カード描画
    function renderMonthDetail(month) {
      const data = idealScheduleData[selectedGrade];
      const detail = data.monthDetails[month];
      const container = document.getElementById('monthDetail');

      if (!detail) {
        container.classList.remove('show');
        return;
      }

      let html = '<div class="month-detail-header">';
      html += `<div class="month-badge">${selectedGrade}<span class="badge-divider">｜</span>${month}月</div>`;
      html += `<div class="month-title">${detail.title}</div>`;
      html += '</div>';

      if (detail.description) {
        html += `<div class="month-description">${detail.description}</div>`;
      }

      if (detail.tasks && detail.tasks.length > 0) {
        html += '<div class="tasks-toggle" id="tasksToggle">';
        html += '<div class="tasks-toggle-header" onclick="toggleTasks()">';
        html += '<div class="tasks-toggle-title"><span class="material-icons">check_circle</span>具体的な行動（' + detail.tasks.length + '件）</div>';
        html += '<span class="material-icons tasks-toggle-icon">expand_more</span>';
        html += '</div>';
        html += '<div class="tasks-toggle-content">';
        html += '<div class="month-tasks">';
        detail.tasks.forEach(task => {
          html += `<div class="month-task-item"><span class="material-icons">check</span><span>${task}</span></div>`;
        });
        html += '</div>';
        html += '</div>';
        html += '</div>';
      }

      container.innerHTML = html;
      container.classList.add('show');
    }

    // タスクトグル
    function toggleTasks() {
      const toggle = document.getElementById('tasksToggle');
      if (toggle) {
        toggle.classList.toggle('open');
      }
    }

    // Todoリスト描画（仮実装）
    // ナビゲーション
    function openNav() {
      document.getElementById('navMenu').classList.add('open');
      document.getElementById('navOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeNav() {
      document.getElementById('navMenu').classList.remove('open');
      document.getElementById('navOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    function doLogout() {
      localStorage.removeItem('eqao_loggedIn');
      localStorage.removeItem('eqao_studentId');
      localStorage.removeItem('eqao_studentName');
      localStorage.removeItem('eqao_password');
      window.location.href = 'index.html';
    }

    function setNavUserName() {
      const studentName = localStorage.getItem('eqao_studentName');
      const navUserName = document.getElementById('navUserName');
      if (navUserName) {
        navUserName.textContent = studentName || '';
      }
    }
  </script>
</body>
</html>
