<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>受験スケジュール - EQAO PORTAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f8f9fc 0%, #e8ecf4 100%);
      min-height: 100vh;
      padding-bottom: 40px;
    }

    .header {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 4px 20px rgba(26, 35, 126, 0.3);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }

    .back-btn:hover { background: rgba(255,255,255,0.25); }

    .header-title { font-size: 18px; font-weight: 700; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px;
    }

    /* セクション */
    .section {
      background: white;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .section-header {
      background: linear-gradient(135deg, #e8eaf6 0%, #c5cae9 100%);
      padding: 14px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 2px solid #1a237e;
    }

    .section-header .material-icons {
      color: #1a237e;
      font-size: 22px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: #1a237e;
    }

    .section-content {
      padding: 20px;
    }

    /* 学年選択ボタン */
    .grade-selector {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .grade-btn {
      flex: 1;
      max-width: 120px;
      padding: 12px 16px;
      border: 2px solid #1a237e;
      background: white;
      color: #1a237e;
      font-size: 14px;
      font-weight: 700;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .grade-btn.active {
      background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
    }

    .grade-btn:hover:not(.active) {
      background: #e8eaf6;
    }

    /* ガントチャート */
    .gantt-wrapper {
      overflow-x: auto;
      margin: 0 -20px;
      padding: 0 20px 16px;
    }

    .gantt-chart {
      min-width: 700px;
    }

    /* ガントヘッダー（月） */
    .gantt-header {
      display: flex;
      margin-bottom: 8px;
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }

    .gantt-label-header {
      width: 140px;
      flex-shrink: 0;
      padding: 10px 8px;
      font-size: 11px;
      font-weight: 700;
      color: #666;
    }

    .gantt-months {
      display: flex;
      flex: 1;
    }

    .gantt-month {
      flex: 1;
      min-width: 50px;
      text-align: center;
      padding: 10px 4px;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      border-left: 1px solid #e0e0e0;
      cursor: pointer;
      transition: all 0.2s;
    }

    .gantt-month:hover {
      background: #e8eaf6;
    }

    .gantt-month.selected {
      background: #1a237e;
      color: white;
    }

    .gantt-month.current {
      background: #fff3e0;
      color: #e65100;
      font-weight: 700;
    }

    .gantt-month.current.selected {
      background: #1a237e;
      color: white;
    }

    /* ガント行 */
    .gantt-row {
      display: flex;
      margin-bottom: 4px;
      align-items: center;
    }

    .gantt-category {
      width: 140px;
      flex-shrink: 0;
      padding: 8px;
      font-size: 12px;
      font-weight: 600;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .category-color {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .gantt-bars {
      display: flex;
      flex: 1;
      position: relative;
      height: 28px;
    }

    .gantt-cell {
      flex: 1;
      min-width: 50px;
      height: 100%;
      border-left: 1px solid #f0f0f0;
      position: relative;
    }

    .gantt-bar {
      position: absolute;
      height: 20px;
      top: 4px;
      border-radius: 4px;
      left: 4px;
      right: 4px;
    }

    /* カテゴリ色 */
    .color-blue { background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); }
    .color-green { background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%); }
    .color-yellow { background: linear-gradient(135deg, #FFC107 0%, #FFA000 100%); }
    .color-orange { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); }
    .color-purple { background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%); }
    .color-cyan { background: linear-gradient(135deg, #00BCD4 0%, #0097A7 100%); }
    .color-red { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); }
    .color-gray { background: linear-gradient(135deg, #607D8B 0%, #455A64 100%); }

    .bg-blue { background: #2196F3; }
    .bg-green { background: #4CAF50; }
    .bg-yellow { background: #FFC107; }
    .bg-orange { background: #FF9800; }
    .bg-purple { background: #9C27B0; }
    .bg-cyan { background: #00BCD4; }
    .bg-red { background: #f44336; }
    .bg-gray { background: #607D8B; }

    /* 凡例 */
    .gantt-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #666;
    }

    .legend-color {
      width: 16px;
      height: 10px;
      border-radius: 2px;
    }

    /* 月詳細カード */
    .month-detail {
      background: linear-gradient(135deg, #f8f9fc 0%, #e8eaf6 100%);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }

    .month-detail.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .month-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .month-badge {
      background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
    }

    .month-title {
      font-size: 16px;
      font-weight: 700;
      color: #333;
    }

    .month-description {
      font-size: 13px;
      color: #666;
      line-height: 1.7;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #1a237e;
    }

    .month-tasks-title {
      font-size: 13px;
      font-weight: 700;
      color: #1a237e;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .month-tasks {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .month-task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      background: white;
      border-radius: 8px;
      font-size: 13px;
      color: #333;
      line-height: 1.5;
    }

    .month-task-item .material-icons {
      color: #4CAF50;
      font-size: 18px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* 私のスケジュール */
    .my-schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .selected-month-label {
      font-size: 14px;
      color: #1a237e;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .todo-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .todo-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #f8f9fc;
      border-radius: 10px;
      transition: background 0.2s;
    }

    .todo-item:hover {
      background: #e8eaf6;
    }

    .todo-checkbox {
      width: 22px;
      height: 22px;
      cursor: pointer;
      accent-color: #1a237e;
    }

    .todo-text {
      flex: 1;
      font-size: 14px;
      color: #333;
    }

    .todo-text.completed {
      text-decoration: line-through;
      color: #999;
    }

    .todo-empty {
      text-align: center;
      padding: 30px 20px;
      color: #999;
      font-size: 14px;
    }

    .todo-empty .material-icons {
      font-size: 40px;
      margin-bottom: 10px;
      opacity: 0.5;
    }

    /* 進捗バー */
    .progress-section {
      background: #f8f9fc;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      color: #666;
    }

    .progress-bar-bg {
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #1a237e, #3949ab);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    /* スクロールヒント */
    .scroll-hint {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px;
      background: #fff3e0;
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 12px;
      color: #e65100;
    }

    @media (max-width: 768px) {
      .scroll-hint {
        display: flex;
      }
    }

    /* ハンバーガーメニュー */
    .hamburger-btn {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .nav-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100%;
      background: white;
      z-index: 201;
      transition: right 0.3s ease;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
      overflow-y: auto;
    }

    .nav-menu.open { right: 0; }

    .nav-header {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      color: white;
      padding: 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-header-title {
      font-size: 16px;
      font-weight: 700;
    }

    .nav-close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    .nav-user-section {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #283593 0%, #3949ab 100%);
    }

    .nav-user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
    }

    .nav-user-info .material-icons {
      font-size: 24px;
      color: rgba(255,255,255,0.7);
    }

    .nav-user-name { font-size: 14px; font-weight: 500; }

    .nav-logout-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 8px;
      color: rgba(255,255,255,0.9);
      font-size: 12px;
      cursor: pointer;
      font-family: inherit;
    }

    .nav-logout-btn .material-icons { font-size: 16px; }

    .nav-category {
      font-size: 11px;
      font-weight: 700;
      color: #999;
      padding: 16px 16px 8px;
      letter-spacing: 1px;
    }

    .nav-section {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: #333;
      text-decoration: none;
      transition: background 0.2s;
    }

    .nav-item:hover { background: #f5f5f5; }

    .nav-item .material-icons {
      font-size: 22px;
      color: #1a237e;
    }

    .nav-item span {
      font-size: 14px;
      font-weight: 500;
    }

    .nav-badge {
      background: #ff5722;
      color: white;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: auto;
    }

    /* ローディング */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e0e0e0;
      border-top-color: #1a237e;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="back-btn">
      <span class="material-icons">arrow_back</span>
    </a>
    <h1 class="header-title">受験スケジュール</h1>
  </header>

  <button class="hamburger-btn" onclick="openNav()">
    <span class="material-icons">menu</span>
  </button>

  <div id="navOverlay" class="nav-overlay" onclick="closeNav()"></div>
  <div id="navMenu" class="nav-menu">
    <div class="nav-header">
      <span class="nav-header-title">メニュー</span>
      <button class="nav-close" onclick="closeNav()">
        <span class="material-icons">close</span>
      </button>
    </div>
    <div class="nav-user-section">
      <div class="nav-user-info">
        <span class="material-icons">person</span>
        <span id="navUserName" class="nav-user-name"></span>
      </div>
      <button class="nav-logout-btn" onclick="doLogout()">
        <span class="material-icons">logout</span>
        <span>ログアウト</span>
      </button>
    </div>
    <div class="nav-section">
      <a href="index.html" class="nav-item">
        <span class="material-icons">home</span>
        <span>ホーム</span>
      </a>
    </div>
    <div class="nav-category">スケジュール</div>
    <div class="nav-section">
      <a href="yearly-schedule.html" class="nav-item">
        <span class="material-icons">calendar_month</span>
        <span>年間スケジュール</span>
      </a>
      <a href="exam-schedule.html" class="nav-item">
        <span class="material-icons">school</span>
        <span>受験スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
      <a href="schedule.html" class="nav-item">
        <span class="material-icons">event_note</span>
        <span>授業スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">学習管理</div>
    <div class="nav-section">
      <a href="checklist.html" class="nav-item">
        <span class="material-icons">checklist</span>
        <span>チェックリスト教材</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">コンテンツ</div>
    <div class="nav-section">
      <a href="videos.html" class="nav-item">
        <span class="material-icons">video_library</span>
        <span>過去の集団授業動画</span>
      </a>
      <a href="column.html" class="nav-item">
        <span class="material-icons">article</span>
        <span>コラム一覧</span>
      </a>
    </div>
    <div class="nav-category">面談申し込み</div>
    <div class="nav-section">
      <a href="meeting-principal.html" class="nav-item">
        <span class="material-icons">person</span>
        <span>塾長面談</span>
      </a>
      <a href="meeting-sansya.html" class="nav-item">
        <span class="material-icons">groups</span>
        <span>三者面談</span>
      </a>
      <a href="meeting-tantou.html" class="nav-item">
        <span class="material-icons">support_agent</span>
        <span>担任面談</span>
      </a>
    </div>
    <div class="nav-category">各種申し込み</div>
    <div class="nav-section">
      <a href="forms.html" class="nav-item">
        <span class="material-icons">list_alt</span>
        <span>各種申し込みフォーム一覧</span>
      </a>
    </div>
    <div class="nav-category">カリキュラム</div>
    <div class="nav-section">
      <a href="zoom-links.html" class="nav-item">
        <span class="material-icons">videocam</span>
        <span>Zoomリンク一覧</span>
      </a>
    </div>
  </div>

  <div class="container">
    <!-- 理想スケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">timeline</span>
        <span class="section-title">理想スケジュール</span>
      </div>
      <div class="section-content">
        <!-- 学年選択 -->
        <div class="grade-selector">
          <button class="grade-btn" data-grade="高1" onclick="selectGrade('高1')">高1</button>
          <button class="grade-btn active" data-grade="高2" onclick="selectGrade('高2')">高2</button>
          <button class="grade-btn" data-grade="高3" onclick="selectGrade('高3')">高3</button>
        </div>

        <!-- スクロールヒント -->
        <div class="scroll-hint">
          <span class="material-icons">swipe</span>
          <span>左右にスクロールできます</span>
        </div>

        <!-- ガントチャート -->
        <div class="gantt-wrapper">
          <div class="gantt-chart" id="ganttChart"></div>
        </div>

        <!-- 凡例 -->
        <div class="gantt-legend" id="ganttLegend"></div>

        <!-- 月詳細カード -->
        <div class="month-detail" id="monthDetail"></div>
      </div>
    </div>

    <!-- 私のスケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">checklist</span>
        <span class="section-title">私のスケジュール</span>
      </div>
      <div class="section-content">
        <div class="my-schedule-header">
          <div class="selected-month-label">
            <span class="material-icons">event</span>
            <span id="selectedMonthLabel">12月</span>
          </div>
        </div>
        <div class="todo-list" id="todoList">
          <div class="todo-empty">
            <span class="material-icons">event_available</span>
            <p>上のガントチャートから月を選択してください</p>
          </div>
        </div>
        <div class="progress-section">
          <div class="progress-label">
            <span>全体の進捗</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar-bg">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // 理想スケジュールデータ
    // ============================================
    const idealScheduleData = {
      "高1": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3"],
        categories: [],
        monthDetails: {}
      },
      "高2": {
        months: ["12", "1", "2", "3"],
        categories: [
          { id: "self", name: "自己分析・自己理解", color: "blue", start: "12", end: "3" },
          { id: "research", name: "志望校リサーチ", color: "green", start: "12", end: "3" },
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "12", end: "3" },
          { id: "docs", name: "書類準備", color: "orange", start: "2", end: "3" },
          { id: "essay", name: "小論文対策", color: "purple", start: "2", end: "3" },
          { id: "activity", name: "課外活動・ボランティア", color: "cyan", start: "12", end: "3" }
        ],
        monthDetails: {
          "12": {
            title: "インプットと自己分析の開始",
            subtitle: "出願条件の理解と達成準備",
            description: "この段階では、受験というより『自分を知る・制度を知る』ことが中心。まだ焦る必要はなく、総合型選抜・推薦入試がどんな試験かを正しく理解し、長期的に準備を進める土台を作る時期。",
            tasks: [
              "総合型選抜・学校推薦型選抜の制度や流れを学ぶ（基礎理解）",
              "各大学・学部の選抜方式や違いを調べる",
              "志望校や併願校の候補を複数挙げておく",
              "「やるべきこと」「やらないべきこと」を整理し、優先順位を決める",
              "総合型選抜全体のスケジュールを年間で把握",
              "自己分析を開始（価値観・性格・経験・将来像の言語化）",
              "評定平均を上げる努力（4.0以上が目標）",
              "英語資格取得（英検2級レベル）に向けた学習",
              "ボランティア・地域貢献・文化活動などの参加を開始（継続的に）"
            ]
          },
          "1": {
            title: "自己分析の深化と方向性の形成",
            subtitle: "",
            description: "12月に始めた自己分析をより深め、自分の軸や価値観を明確にする時期。同時に、出願条件（評定・資格）を確実に満たす努力を続ける。",
            tasks: [
              "総合型選抜・推薦入試の学習継続（出願条件の確認）",
              "志望校候補を広く調べ、併願可能な大学を比較検討",
              "自己分析を文章化し、自分史・ビジョン・強みを整理",
              "出願書類の書き方や種類を知る（志望理由書・活動報告書など）",
              "評定平均を上げる（主要科目の提出点を意識）",
              "英検・TOEFL・IELTSなど資格試験に向けて対策開始",
              "体験的活動を増やす（ボランティア・講演参加・地域活動など）",
              "長期的に続けられる社会活動・プロジェクトを決めておく"
            ]
          },
          "2": {
            title: "志望方向の具体化と書類準備の開始",
            subtitle: "",
            description: "大学や学部をある程度絞り、出願書類の下書きを開始。ここで「書く・調べる・比べる」を並行しながら、土台を固める。",
            tasks: [
              "志望校・併願校を仮決定（学部・学科レベルまで考える）",
              "自己分析をもとに初期の志望理由文を作成",
              "小論文の基礎問題を学び始める",
              "提出書類（自己PR・活動報告など）の作成を開始",
              "評定・資格の基準値を確実に満たす",
              "過去問請求・出願条件の問い合わせ（大学HP・資料請求）",
              "継続的な社会活動を維持し、体験を記録（報告書に活かす）"
            ]
          },
          "3": {
            title: "志望校仮決定と学習習慣の確立",
            subtitle: "",
            description: "春休みを活かして、学びと行動の両方をバランスよく整える。海外プログラムや新しい経験を積む良いタイミング。",
            tasks: [
              "志望校・学部・学科の仮決定（複数案を用意）",
              "英検などの資格試験を受験し、出願基準を満たす",
              "小論文の基礎問題を継続演習",
              "第一志望の提出書類の下書き完成",
              "短期留学・プログラム・ボランティアへの参加",
              "書類で使える活動実績や体験を蓄積"
            ]
          }
        }
      },
      "高3": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2"],
        categories: [
          { id: "research", name: "志望校リサーチ", color: "green", start: "4", end: "7" },
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "8" },
          { id: "docs", name: "書類準備", color: "orange", start: "4", end: "9" },
          { id: "essay", name: "小論文対策", color: "purple", start: "4", end: "11" },
          { id: "study", name: "研究活動", color: "cyan", start: "4", end: "9" },
          { id: "interview", name: "面接対策", color: "red", start: "9", end: "11" },
          { id: "apply", name: "出願作業", color: "gray", start: "8", end: "12" }
        ],
        monthDetails: {
          "4": {
            title: "受験スケジュールの確立と研究テーマ決定",
            subtitle: "",
            description: "ここから本格的に受験モードへ。研究テーマを決め、学びを学術的に深化させる。進捗管理を始め、全体を見える化する。",
            tasks: [
              "EQAO進捗管理シートで年間スケジュールを立案",
              "集団授業・交流会・保護者会に参加し意識を高める",
              "志望校・学部・学科を正式決定",
              "オープンキャンパスの予約・参加準備",
              "評定平均・英語資格を再確認（不足があれば補強）",
              "小論文の基礎演習継続",
              "志望理由書の初稿作成開始",
              "研究テーマを決定（興味分野×社会課題×学問領域）",
              "文献・論文・データ分析など調査を開始",
              "ボランティア・地域活動を継続",
              "専願・併願条件の確認・交渉（高校・大学に確認）"
            ]
          },
          "5": {
            title: "研究・書類作成の本格化",
            subtitle: "",
            description: "研究・分析・文献読解など、『自分の研究テーマ』を深める月。出願書類と研究テーマの整合性を取っていく。",
            tasks: [
              "文献・書籍・学術データを用いたリサーチ開始",
              "研究ノート・読書記録をまとめる",
              "小論文の演習を継続（要約・意見・構成練習）",
              "志望理由書を第2稿に更新（根拠を補強）",
              "活動報告書・自己PR文の精度を上げる",
              "評定平均・英語資格の追い込み（最終測定へ）",
              "研究やボランティア活動を習慣化"
            ]
          },
          "6": {
            title: "研究深化と推薦状準備の開始",
            subtitle: "",
            description: "推薦状の依頼を正式に始めるタイミング。研究活動・課外活動・小論文の応用力を強化。",
            tasks: [
              "研究テーマに基づくフィールドワーク・アンケート等を実施",
              "調査報告書・仮レポートを作成",
              "小論文の応用問題演習に移行",
              "出願書類（第一志望）の内容を精査・加筆修正",
              "高校教員に推薦状作成依頼を正式に申し出る",
              "研究成果をまとめ、面接・書類両方で活かせる形に整える"
            ]
          },
          "7": {
            title: "学校連携・書類整理の最終段階",
            subtitle: "",
            description: "いよいよ校内手続きが動き出す。調査書・推薦状・証明書など、出願に必要な全書類を整える重要な月。",
            tasks: [
              "部活動引退・受験専念",
              "志望校・併願校リストを学校に正式提示",
              "調査書記載内容を相談・確認",
              "新年度の大学募集要項を最新版に更新",
              "小論文の応用演習を継続（記述＋口頭説明）",
              "推薦状依頼を完了・内容確認",
              "各種賞状・検定証・活動証明書を整理・コピー",
              "調査書発行願いを提出（大学ごとに申請）",
              "出願日程と学校行事を照合し、重複を回避"
            ]
          },
          "8": {
            title: "夏休み：活動・資格・書類の総仕上げ",
            subtitle: "",
            description: "最も重要な集中特訓期間。EQAOイベントや模試・合宿を活用し、実践力を磨く。",
            tasks: [
              "部活動完全引退・受験一本化",
              "志望理由書以外の書類（活動報告書・課題レポート等）を仕上げる",
              "調査書・証明書の発行・照合作業を完了",
              "英語資格原本照合（高校・大学両方で確認）",
              "指定校推薦の出願判断を確定",
              "研究活動・ボランティア・プログラム参加を集中実施",
              "EQAO CAMP／STUDY TOURなど合宿・研修参加",
              "小論文の過去問演習を開始",
              "提出書類（第一志望）を完成・最終確認",
              "Web出願登録開始（不備チェック）"
            ]
          },
          "9": {
            title: "出願本番と一次審査突破期",
            subtitle: "",
            description: "ついに出願開始。書類提出・一次審査・模試・面接対策が同時進行。焦らず確実に、期限管理が命。",
            tasks: [
              "出願Web登録・郵送作業を本格化",
              "指定校推薦結果発表（一次審査）",
              "小論文の過去問演習を本格化",
              "面接対策を開始（書類からの想定質問100問）",
              "レポート課題 着手開始",
              "課外活動・ボランティアの最終整理",
              "大学から受験番号発行",
              "EQAO出願サポートを受ける",
              "EQAO模試を受験（本番シミュレーション）"
            ]
          },
          "10": {
            title: "総合型選抜ピーク期／二次試験対策本格化",
            subtitle: "",
            description: "最も緊張感の高い月。面接・小論文の最終仕上げ。EQAO模試と面接練習を最大限活用する。",
            tasks: [
              "出願継続（残り大学対応）",
              "EQAO模試本格化／結果分析フィードバック",
              "小論文過去問・応用問題演習",
              "二次試験（面接・小論文）本格練習",
              "EQAO出願サポート・書類最終添削",
              "一次審査結果の確認と再出願準備",
              "面接100問＋書類質問100問の想定練習",
              "大学から受験番号通知"
            ]
          },
          "11": {
            title: "学校推薦型選抜出願・結果ラッシュ期",
            subtitle: "",
            description: "公募推薦と総合型選抜の結果・試験が重なる時期。「合格確定者」と「最終試験者」に分かれ動く。",
            tasks: [
              "公募推薦の出願開始（高校との調整）",
              "二次試験（小論文・面接）本格化",
              "総合型選抜の結果発表開始（順次）",
              "入学手続き関連（合格者向け）を進行",
              "EQAO模試最終実施／最終対策",
              "出願サポート継続（最後の大学まで）",
              "面接練習継続／自己表現力の最終確認",
              "卒塾手続き開始（合格者より順次）"
            ]
          },
          "12": {
            title: "結果発表・卒塾・次のステージへ",
            subtitle: "",
            description: "結果が出揃い始める。受験の総仕上げと次への準備を同時に行う。「合格＝ゴール」ではなく「スタート」として捉える。",
            tasks: [
              "総合型・公募推薦の最終結果発表",
              "第二期募集・追加出願対応者の書類準備",
              "入学手続き・入学金納入・必要書類提出",
              "EQAO PARTY FOR NEXT STAGE（卒塾式）開催",
              "後輩向けメッセージ・インタビュー協力"
            ]
          },
          "1": {
            title: "次への選択と切り替え",
            subtitle: "",
            description: "合格者は入学準備、不合格者は一般・海外・再挑戦を決定する。精神面・方向性を整える重要な時期。",
            tasks: [
              "一般入試への切り替え・対策開始",
              "併願校の入試対策実施",
              "海外大学進学の検討",
              "浪人・再挑戦の判断",
              "大学側から課される入学前課題の対応",
              "各種手続き・書類最終確認"
            ]
          },
          "2": {
            title: "共通テスト利用・後期募集対応",
            subtitle: "",
            description: "最終追い込み。国公立や私立の後期型、共通テスト利用型の対策。最後まで学び続ける姿勢を保つ。",
            tasks: [
              "共通テスト利用の国公立型選抜対策",
              "総合型選抜の2期・3期募集出願",
              "一般入試・後期入試の準備",
              "EQAO講師・メンターとの面談で進路確定"
            ]
          }
        }
      }
    };

    // カテゴリの色と名前のマッピング
    const categoryInfo = {
      self: { name: "自己分析・自己理解", color: "blue" },
      research: { name: "志望校リサーチ", color: "green" },
      grade: { name: "評定・英語資格", color: "yellow" },
      docs: { name: "書類準備", color: "orange" },
      essay: { name: "小論文対策", color: "purple" },
      activity: { name: "課外活動・ボランティア", color: "cyan" },
      study: { name: "研究活動", color: "cyan" },
      interview: { name: "面接対策", color: "red" },
      apply: { name: "出願作業", color: "gray" }
    };

    // 状態
    let selectedGrade = "高2";
    let selectedMonth = null;

    // 初期化
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded fired');
      try {
        setNavUserName();
        console.log('selectedGrade:', selectedGrade);
        console.log('idealScheduleData:', idealScheduleData);
        renderGanttChart();
        console.log('renderGanttChart completed');
        
        // 現在の月を初期選択
        const now = new Date();
        const currentMonth = String(now.getMonth() + 1);
        const data = idealScheduleData[selectedGrade];
        console.log('data:', data);
        if (data && data.months && data.months.includes(currentMonth)) {
          selectMonth(currentMonth);
        } else if (data && data.months && data.months.length > 0) {
          selectMonth(data.months[0]);
        }
        console.log('Initialization complete');
      } catch (e) {
        console.error('Initialization error:', e);
      }
    });

    // 学年選択
    function selectGrade(grade) {
      selectedGrade = grade;
      document.querySelectorAll('.grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
      
      // ガントチャート再描画
      renderGanttChart();
      
      // 最初の月を選択
      const data = idealScheduleData[grade];
      if (data.months.length > 0) {
        selectMonth(data.months[0]);
      } else {
        document.getElementById('monthDetail').classList.remove('show');
        document.getElementById('selectedMonthLabel').textContent = '-';
      }
    }

    // ガントチャート描画
    function renderGanttChart() {
      console.log('renderGanttChart called, selectedGrade:', selectedGrade);
      const data = idealScheduleData[selectedGrade];
      console.log('data for grade:', data);
      const container = document.getElementById('ganttChart');
      const legendContainer = document.getElementById('ganttLegend');
      console.log('container:', container, 'legendContainer:', legendContainer);

      if (!data || !data.months || data.months.length === 0) {
        console.log('No data or months, showing empty state');
        container.innerHTML = '<div class="todo-empty"><span class="material-icons">construction</span><p>準備中です</p></div>';
        legendContainer.innerHTML = '';
        return;
      }

      const months = data.months;
      const categories = data.categories || [];
      console.log('months:', months, 'categories:', categories);

      // 現在の月を取得
      const now = new Date();
      const currentMonth = String(now.getMonth() + 1);

      // ヘッダー（月）
      let html = '<div class="gantt-header">';
      html += '<div class="gantt-label-header">カテゴリ</div>';
      html += '<div class="gantt-months">';
      months.forEach(m => {
        const monthLabel = m + '月';
        const isCurrent = m === currentMonth;
        const isSelected = m === selectedMonth;
        let classes = 'gantt-month';
        if (isCurrent) classes += ' current';
        if (isSelected) classes += ' selected';
        html += `<div class="${classes}" onclick="selectMonth('${m}')">${monthLabel}</div>`;
      });
      html += '</div></div>';

      // 各カテゴリ行
      categories.forEach(cat => {
        html += '<div class="gantt-row">';
        html += `<div class="gantt-category"><div class="category-color bg-${cat.color}"></div>${cat.name}</div>`;
        html += '<div class="gantt-bars">';
        
        months.forEach(m => {
          const isInRange = isMonthInRange(m, cat.start, cat.end, months);
          html += '<div class="gantt-cell">';
          if (isInRange) {
            html += `<div class="gantt-bar color-${cat.color}"></div>`;
          }
          html += '</div>';
        });
        
        html += '</div></div>';
      });

      container.innerHTML = html;

      // 凡例
      let legendHtml = '';
      categories.forEach(cat => {
        legendHtml += `<div class="legend-item"><div class="legend-color bg-${cat.color}"></div>${cat.name}</div>`;
      });
      legendContainer.innerHTML = legendHtml;
    }

    // 月が範囲内かチェック
    function isMonthInRange(month, start, end, monthOrder) {
      const monthIdx = monthOrder.indexOf(month);
      const startIdx = monthOrder.indexOf(start);
      const endIdx = monthOrder.indexOf(end);
      
      if (monthIdx === -1 || startIdx === -1 || endIdx === -1) return false;
      return monthIdx >= startIdx && monthIdx <= endIdx;
    }

    // 月選択
    function selectMonth(month) {
      selectedMonth = month;
      
      // ガントチャートのヘッダー更新
      document.querySelectorAll('.gantt-month').forEach(el => {
        const m = el.textContent.replace('月', '');
        el.classList.toggle('selected', m === month);
      });

      // 詳細カード表示
      renderMonthDetail(month);
      
      // 私のスケジュールのラベル更新
      document.getElementById('selectedMonthLabel').textContent = month + '月';
      
      // Todoリスト更新（今後API連携）
      renderTodoList(month);
    }

    // 月詳細カード描画
    function renderMonthDetail(month) {
      const data = idealScheduleData[selectedGrade];
      const detail = data.monthDetails[month];
      const container = document.getElementById('monthDetail');

      if (!detail) {
        container.classList.remove('show');
        return;
      }

      let html = '<div class="month-detail-header">';
      html += `<div class="month-badge">${month}月</div>`;
      html += `<div class="month-title">${detail.title}</div>`;
      html += '</div>';

      if (detail.description) {
        html += `<div class="month-description">${detail.description}</div>`;
      }

      if (detail.tasks && detail.tasks.length > 0) {
        html += '<div class="month-tasks-title"><span class="material-icons">check_circle</span>具体的な行動</div>';
        html += '<div class="month-tasks">';
        detail.tasks.forEach(task => {
          html += `<div class="month-task-item"><span class="material-icons">check</span><span>${task}</span></div>`;
        });
        html += '</div>';
      }

      container.innerHTML = html;
      container.classList.add('show');
    }

    // Todoリスト描画（仮実装）
    function renderTodoList(month) {
      const container = document.getElementById('todoList');
      
      // TODO: API連携で個人のタスクを取得
      // 今は仮データ
      container.innerHTML = `
        <div class="todo-empty">
          <span class="material-icons">assignment</span>
          <p>${month}月のタスクはまだ登録されていません</p>
        </div>
      `;
    }

    // ナビゲーション
    function openNav() {
      document.getElementById('navMenu').classList.add('open');
      document.getElementById('navOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeNav() {
      document.getElementById('navMenu').classList.remove('open');
      document.getElementById('navOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    function doLogout() {
      localStorage.removeItem('eqao_loggedIn');
      localStorage.removeItem('eqao_studentId');
      localStorage.removeItem('eqao_studentName');
      localStorage.removeItem('eqao_password');
      window.location.href = 'index.html';
    }

    function setNavUserName() {
      const studentName = localStorage.getItem('eqao_studentName');
      const navUserName = document.getElementById('navUserName');
      if (navUserName) {
        navUserName.textContent = studentName || '';
      }
    }
  </script>
</body>
</html>
