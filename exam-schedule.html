<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>受験スケジュール - EQAO PORTAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f8f9fc 0%, #e8ecf4 100%);
      min-height: 100vh;
      padding-bottom: 24px;
    }

    .header {
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 20px rgba(0, 105, 92, 0.4);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .back-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }

    .back-btn .material-icons {
      font-size: 20px;
    }

    .back-btn:hover { background: rgba(255,255,255,0.25); }

    .header-title { font-size: 16px; font-weight: 700; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 12px;
    }

    /* セクション */
    .section {
      background: white;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .section-header {
      background: linear-gradient(135deg, #B2DFDB 0%, #80CBC4 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px solid #00695C;
    }

    .section-header .material-icons {
      color: #00695C;
      font-size: 20px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 700;
      color: #004D40;
    }

    .section-content {
      padding: 16px;
    }

    /* 学年選択ボタン */
    .grade-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .grade-btn {
      flex: 1;
      max-width: 100px;
      padding: 8px 12px;
      border: 2px solid #E05555;
      background: white;
      color: #E05555;
      font-size: 13px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .grade-btn.active {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      border-color: #E05555;
      box-shadow: 0 3px 10px rgba(224, 85, 85, 0.4);
    }

    .grade-btn:hover:not(.active) {
      background: #FFEBEE;
    }

    /* ガントチャート */
    .gantt-wrapper {
      overflow-x: auto;
      margin: 0 -16px;
      padding: 0 16px 8px;
    }

    .gantt-chart {
      min-width: 700px;
    }

    /* ガントヘッダー（月） */
    .gantt-header {
      display: flex;
      margin-bottom: 4px;
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }

    .gantt-label-header {
      width: 130px;
      flex-shrink: 0;
      padding: 6px 8px;
      font-size: 10px;
      font-weight: 700;
      color: #004D40;
      position: sticky;
      left: 0;
      background: white;
      z-index: 5;
    }

    .gantt-months {
      display: flex;
      flex: 1;
    }

    .gantt-month {
      flex: 1;
      min-width: 50px;
      text-align: center;
      padding: 6px 4px;
      font-size: 11px;
      font-weight: 600;
      color: #004D40;
      background: #B2DFDB;
      border-left: 1px solid #80CBC4;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .gantt-month:hover {
      background: #80CBC4;
      color: #004D40;
    }

    .gantt-month.selected {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(224, 85, 85, 0.4);
    }

    .gantt-month.current {
      background: #FFE0B2;
      color: #E65100;
      font-weight: 700;
      position: relative;
    }

    .gantt-month.current::after {
      content: '';
      width: 4px;
      height: 4px;
      background: #E65100;
      border-radius: 50%;
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
    }

    .gantt-month.current:hover {
      background: #FFCC80;
    }

    .gantt-month.current.selected {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
    }

    .gantt-month.current.selected::after {
      background: white;
    }

    /* ガント行 */
    .gantt-row {
      display: flex;
      margin-bottom: 2px;
      align-items: center;
    }

    .gantt-category {
      width: 130px;
      flex-shrink: 0;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 600;
      color: #004D40;
      display: flex;
      align-items: center;
      gap: 6px;
      position: sticky;
      left: 0;
      background: white;
      z-index: 5;
    }

    .category-color {
      width: 10px;
      height: 10px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .gantt-bars {
      display: flex;
      flex: 1;
      position: relative;
      height: 18px;
    }

    .gantt-cell {
      flex: 1;
      min-width: 50px;
      height: 100%;
      border-left: 1px solid #B2DFDB;
      position: relative;
    }

    .gantt-bar {
      position: absolute;
      height: 14px;
      top: 2px;
      border-radius: 7px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    /* カテゴリ色 - ポップ配色（濃いめ） */
    .color-blue { background: linear-gradient(135deg, #3F51B5 0%, #5C6BC0 100%); }
    .color-green { background: linear-gradient(135deg, #00897B 0%, #26A69A 100%); }
    .color-yellow { background: linear-gradient(135deg, #FFA000 0%, #FFB300 100%); }
    .color-orange { background: linear-gradient(135deg, #F4511E 0%, #FF7043 100%); }
    .color-purple { background: linear-gradient(135deg, #8E24AA 0%, #AB47BC 100%); }
    .color-cyan { background: linear-gradient(135deg, #00ACC1 0%, #26C6DA 100%); }
    .color-red { background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%); }
    .color-gray { background: linear-gradient(135deg, #546E7A 0%, #78909C 100%); }

    .bg-blue { background: #3F51B5; }
    .bg-green { background: #00897B; }
    .bg-yellow { background: #FFA000; }
    .bg-orange { background: #F4511E; }
    .bg-purple { background: #8E24AA; }
    .bg-cyan { background: #00ACC1; }
    .bg-red { background: #E05555; }
    .bg-gray { background: #546E7A; }

    /* ヒント */
    .chart-hint {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      font-size: 11px;
      color: #00897B;
      margin-top: 8px;
    }

    .chart-hint .material-icons {
      font-size: 16px;
    }

    /* 月詳細カード */
    .month-detail {
      background: linear-gradient(135deg, #B2DFDB 0%, #80CBC4 100%);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      display: none;
    }

    .month-detail.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .month-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .month-badge {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.4);
    }

    .month-title {
      font-size: 15px;
      font-weight: 700;
      color: #004D40;
    }

    .month-description {
      font-size: 13px;
      color: #333;
      line-height: 1.7;
      margin-bottom: 14px;
      padding: 12px 14px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #00695C;
    }

    /* タスクトグル */
    .tasks-toggle {
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }

    .tasks-toggle-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .tasks-toggle-header:hover {
      background: #E0F2F1;
    }

    .tasks-toggle-title {
      font-size: 13px;
      font-weight: 700;
      color: #00695C;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tasks-toggle-icon {
      color: #00897B;
      transition: transform 0.3s;
    }

    .tasks-toggle.open .tasks-toggle-icon {
      transform: rotate(180deg);
    }

    .tasks-toggle-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .tasks-toggle.open .tasks-toggle-content {
      max-height: 1000px;
    }

    .month-tasks {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 0 14px 14px;
    }

    .month-task-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      background: #E0F2F1;
      border-radius: 8px;
      font-size: 13px;
      color: #333;
      line-height: 1.5;
    }

    .month-task-item .material-icons {
      color: #00897B;
      font-size: 18px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* 私のスケジュール - 2カラムレイアウト */
    .my-schedule-selector {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .mini-grade-selector {
      display: flex;
      gap: 6px;
    }

    .mini-grade-btn {
      padding: 6px 14px;
      border: 2px solid #E05555;
      background: white;
      color: #E05555;
      font-size: 12px;
      font-weight: 700;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mini-grade-btn.active {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.3);
    }

    .mini-grade-btn:hover:not(.active) {
      background: #FFEBEE;
    }

    .month-selector {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #00695C;
    }

    .month-selector .material-icons {
      font-size: 20px;
    }

    .month-select {
      padding: 8px 32px 8px 12px;
      border: 2px solid #00897B;
      border-radius: 8px;
      background: white;
      color: #00695C;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300695C' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
    }

    .month-select:focus {
      outline: none;
      border-color: #004D40;
      box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.2);
    }

    .my-schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .selected-month-label {
      font-size: 16px;
      color: #00695C;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .my-schedule-split {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 768px) {
      .my-schedule-split {
        grid-template-columns: 1fr;
      }
    }

    .my-schedule-panel {
      background: #E0F2F1;
      border-radius: 12px;
      overflow: hidden;
    }

    .panel-header {
      background: linear-gradient(135deg, #00897B 0%, #26A69A 100%);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 700;
    }

    .panel-title .material-icons {
      font-size: 20px;
    }

    .panel-actions {
      display: flex;
      gap: 8px;
    }

    .panel-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: background 0.2s;
    }

    .panel-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    .panel-btn .material-icons {
      font-size: 16px;
    }

    .panel-content {
      padding: 16px;
      min-height: 200px;
    }

    /* 左側: 今月やること */
    .monthly-goals {
      font-size: 14px;
      color: #333;
      line-height: 1.8;
      white-space: pre-wrap;
    }

    .monthly-goals-empty {
      color: #80CBC4;
      text-align: center;
      padding: 40px 20px;
    }

    .monthly-goals-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    .goals-textarea {
      width: 100%;
      min-height: 180px;
      padding: 12px;
      border: 2px solid #80CBC4;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.8;
      resize: vertical;
      background: white;
    }

    .goals-textarea:focus {
      outline: none;
      border-color: #00897B;
    }

    .edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-end;
    }

    .btn-save {
      background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .btn-save:hover {
      box-shadow: 0 2px 8px rgba(224, 85, 85, 0.4);
    }

    .btn-cancel {
      background: #B2DFDB;
      color: #00695C;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-cancel:hover {
      background: #80CBC4;
    }

    /* 右側: ToDo */
    .todo-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .todo-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 12px;
      background: white;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .todo-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .todo-item.completed {
      opacity: 0.6;
    }

    .todo-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #E05555;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .todo-content {
      flex: 1;
      min-width: 0;
    }

    .todo-text {
      font-size: 13px;
      color: #333;
      line-height: 1.4;
    }

    .todo-text.done {
      text-decoration: line-through;
      color: #888;
    }

    .todo-deadline {
      font-size: 11px;
      color: #E05555;
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .todo-deadline .material-icons {
      font-size: 14px;
    }

    .todo-deadline.overdue {
      color: #C62828;
      font-weight: 600;
    }

    .todo-deadline.soon {
      color: #F57C00;
    }

    .todo-actions {
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .todo-item:hover .todo-actions {
      opacity: 1;
    }

    .todo-action-btn {
      background: none;
      border: none;
      color: #80CBC4;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
    }

    .todo-action-btn:hover {
      background: #E0F2F1;
      color: #00695C;
    }

    .todo-action-btn .material-icons {
      font-size: 18px;
    }

    .todo-empty {
      text-align: center;
      padding: 40px 20px;
      color: #80CBC4;
      font-size: 13px;
    }

    .todo-empty .material-icons {
      font-size: 36px;
      margin-bottom: 8px;
      opacity: 0.7;
    }

    /* ToDo追加フォーム */
    .todo-add-form {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      border: 2px dashed #80CBC4;
    }

    .todo-add-form.hidden {
      display: none;
    }

    .todo-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .todo-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #B2DFDB;
      border-radius: 6px;
      font-size: 13px;
    }

    .todo-input:focus {
      outline: none;
      border-color: #00897B;
    }

    .todo-date-input {
      width: 140px;
      padding: 8px 12px;
      border: 1px solid #B2DFDB;
      border-radius: 6px;
      font-size: 13px;
    }

    .todo-date-input:focus {
      outline: none;
      border-color: #00897B;
    }

    /* 進捗バー */
    .progress-section {
      background: #B2DFDB;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      color: #004D40;
    }

    .progress-bar-bg {
      height: 12px;
      background: #80CBC4;
      border-radius: 6px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #E05555, #FF6B6B);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    /* スクロールヒント */
    .scroll-hint {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 6px;
      background: #B2DFDB;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 11px;
      color: #004D40;
    }

    .scroll-hint .material-icons {
      font-size: 16px;
    }

    @media (max-width: 768px) {
      .scroll-hint {
        display: flex;
      }
    }

    /* ハンバーガーメニュー */
    .hamburger-btn {
      position: fixed;
      top: 10px;
      right: 12px;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    .hamburger-btn .material-icons {
      font-size: 22px;
    }

    .nav-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 200;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .nav-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .nav-menu {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100%;
      background: white;
      z-index: 201;
      transition: right 0.3s ease;
      box-shadow: -4px 0 20px rgba(0,0,0,0.15);
      overflow-y: auto;
    }

    .nav-menu.open { right: 0; }

    .nav-header {
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
      color: white;
      padding: 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-header-title {
      font-size: 16px;
      font-weight: 700;
    }

    .nav-close {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 50%;
      color: white;
      cursor: pointer;
    }

    .nav-user-section {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #00695C 0%, #00897B 100%);
    }

    .nav-user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
    }

    .nav-user-info .material-icons {
      font-size: 24px;
      color: rgba(255,255,255,0.7);
    }

    .nav-user-name { font-size: 14px; font-weight: 500; }

    .nav-logout-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.15);
      border: none;
      border-radius: 8px;
      color: rgba(255,255,255,0.9);
      font-size: 12px;
      cursor: pointer;
      font-family: inherit;
    }

    .nav-logout-btn .material-icons { font-size: 16px; }

    .nav-category {
      font-size: 11px;
      font-weight: 700;
      color: #999;
      padding: 16px 16px 8px;
      letter-spacing: 1px;
    }

    .nav-section {
      padding: 4px 0;
      border-bottom: 1px solid #eee;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: #333;
      text-decoration: none;
      transition: background 0.2s;
    }

    .nav-item:hover { background: #f5f5f5; }

    .nav-item .material-icons {
      font-size: 22px;
      color: #00695C;
    }

    .nav-item span {
      font-size: 14px;
      font-weight: 500;
    }

    .nav-badge {
      background: #ff5722;
      color: white;
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 4px;
      margin-left: auto;
    }

    /* ローディング */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #80CBC4;
      border-top-color: #00695C;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="back-btn">
      <span class="material-icons">arrow_back</span>
    </a>
    <h1 class="header-title">受験スケジュール</h1>
  </header>

  <button class="hamburger-btn" onclick="openNav()">
    <span class="material-icons">menu</span>
  </button>

  <div id="navOverlay" class="nav-overlay" onclick="closeNav()"></div>
  <div id="navMenu" class="nav-menu">
    <div class="nav-header">
      <span class="nav-header-title">メニュー</span>
      <button class="nav-close" onclick="closeNav()">
        <span class="material-icons">close</span>
      </button>
    </div>
    <div class="nav-user-section">
      <div class="nav-user-info">
        <span class="material-icons">person</span>
        <span id="navUserName" class="nav-user-name"></span>
      </div>
      <button class="nav-logout-btn" onclick="doLogout()">
        <span class="material-icons">logout</span>
        <span>ログアウト</span>
      </button>
    </div>
    <div class="nav-section">
      <a href="index.html" class="nav-item">
        <span class="material-icons">home</span>
        <span>ホーム</span>
      </a>
    </div>
    <div class="nav-category">スケジュール</div>
    <div class="nav-section">
      <a href="yearly-schedule.html" class="nav-item">
        <span class="material-icons">calendar_month</span>
        <span>年間スケジュール</span>
      </a>
      <a href="exam-schedule.html" class="nav-item">
        <span class="material-icons">school</span>
        <span>受験スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
      <a href="schedule.html" class="nav-item">
        <span class="material-icons">event_note</span>
        <span>授業スケジュール</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">学習管理</div>
    <div class="nav-section">
      <a href="checklist.html" class="nav-item">
        <span class="material-icons">checklist</span>
        <span>チェックリスト教材</span>
        <span class="nav-badge">個別</span>
      </a>
    </div>
    <div class="nav-category">コンテンツ</div>
    <div class="nav-section">
      <a href="videos.html" class="nav-item">
        <span class="material-icons">video_library</span>
        <span>過去の集団授業動画</span>
      </a>
      <a href="column.html" class="nav-item">
        <span class="material-icons">article</span>
        <span>コラム一覧</span>
      </a>
    </div>
    <div class="nav-category">面談申し込み</div>
    <div class="nav-section">
      <a href="meeting-principal.html" class="nav-item">
        <span class="material-icons">person</span>
        <span>塾長面談</span>
      </a>
      <a href="meeting-sansya.html" class="nav-item">
        <span class="material-icons">groups</span>
        <span>三者面談</span>
      </a>
      <a href="meeting-tantou.html" class="nav-item">
        <span class="material-icons">support_agent</span>
        <span>担任面談</span>
      </a>
    </div>
    <div class="nav-category">各種申し込み</div>
    <div class="nav-section">
      <a href="forms.html" class="nav-item">
        <span class="material-icons">list_alt</span>
        <span>各種申し込みフォーム一覧</span>
      </a>
    </div>
    <div class="nav-category">カリキュラム</div>
    <div class="nav-section">
      <a href="zoom-links.html" class="nav-item">
        <span class="material-icons">videocam</span>
        <span>Zoomリンク一覧</span>
      </a>
    </div>
  </div>

  <div class="container">
    <!-- 理想スケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">timeline</span>
        <span class="section-title">理想スケジュール</span>
      </div>
      <div class="section-content">
        <!-- 学年選択 -->
        <div class="grade-selector">
          <button class="grade-btn" data-grade="高1" onclick="selectGrade('高1')">高1</button>
          <button class="grade-btn active" data-grade="高2" onclick="selectGrade('高2')">高2</button>
          <button class="grade-btn" data-grade="高3" onclick="selectGrade('高3')">高3</button>
        </div>

        <!-- スクロールヒント -->
        <div class="scroll-hint">
          <span class="material-icons">swipe</span>
          <span>左右にスクロールできます</span>
        </div>

        <!-- ガントチャート -->
        <div class="gantt-wrapper">
          <div class="gantt-chart" id="ganttChart"></div>
        </div>

        <!-- ヒント -->
        <div class="chart-hint">
          <span class="material-icons">touch_app</span>
          <span>月をタップで詳細表示</span>
        </div>

        <!-- 月詳細カード -->
        <div class="month-detail" id="monthDetail"></div>
      </div>
    </div>

    <!-- 私のスケジュール -->
    <div class="section">
      <div class="section-header">
        <span class="material-icons">checklist</span>
        <span class="section-title">私のスケジュール</span>
      </div>
      <div class="section-content">
        <!-- 学年・月セレクター -->
        <div class="my-schedule-selector">
          <div class="mini-grade-selector">
            <button class="mini-grade-btn active" data-grade="高1" onclick="selectGradeFromMySchedule('高1')">高1</button>
            <button class="mini-grade-btn" data-grade="高2" onclick="selectGradeFromMySchedule('高2')">高2</button>
            <button class="mini-grade-btn" data-grade="高3" onclick="selectGradeFromMySchedule('高3')">高3</button>
          </div>
          <div class="month-selector">
            <span class="material-icons">event</span>
            <select id="monthSelect" class="month-select" onchange="selectMonthFromMySchedule(this.value)">
              <!-- JSで動的に生成 -->
            </select>
          </div>
        </div>

        <!-- 2カラムレイアウト -->
        <div class="my-schedule-split">
          <!-- 左側: 今月やること -->
          <div class="my-schedule-panel">
            <div class="panel-header">
              <div class="panel-title">
                <span class="material-icons">edit_note</span>
                今月やること
              </div>
              <div class="panel-actions">
                <button class="panel-btn" onclick="toggleGoalsEdit()" id="goalsEditBtn">
                  <span class="material-icons">edit</span>
                  編集
                </button>
              </div>
            </div>
            <div class="panel-content">
              <!-- 表示モード -->
              <div id="goalsDisplay">
                <div class="monthly-goals" id="monthlyGoalsText">
                  <!-- サンプルデータ -->
                  ・英検準1級の過去問を週2回解く
・志望理由書の初稿を書き始める
・オープンキャンパスの日程を調べる
・ボランティア活動に月2回参加
                </div>
              </div>
              <!-- 編集モード -->
              <div id="goalsEdit" style="display: none;">
                <textarea class="goals-textarea" id="goalsTextarea" placeholder="今月やることを入力...&#10;&#10;例:&#10;・英検の勉強を毎日30分&#10;・志望理由書の下書き&#10;・ボランティア活動"></textarea>
                <div class="edit-actions">
                  <button class="btn-cancel" onclick="cancelGoalsEdit()">キャンセル</button>
                  <button class="btn-save" onclick="saveGoals()">
                    <span class="material-icons">save</span>
                    保存
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 右側: ToDo -->
          <div class="my-schedule-panel">
            <div class="panel-header" style="background: linear-gradient(135deg, #E05555 0%, #FF6B6B 100%);">
              <div class="panel-title">
                <span class="material-icons">task_alt</span>
                ToDo（期限付き）
              </div>
              <div class="panel-actions">
                <button class="panel-btn" onclick="toggleTodoForm()" id="todoAddBtn">
                  <span class="material-icons">add</span>
                  追加
                </button>
              </div>
            </div>
            <div class="panel-content">
              <!-- ToDo追加フォーム -->
              <div class="todo-add-form hidden" id="todoAddForm">
                <div class="todo-input-row">
                  <input type="text" class="todo-input" id="todoInput" placeholder="やること...">
                  <input type="date" class="todo-date-input" id="todoDateInput">
                </div>
                <div class="edit-actions">
                  <button class="btn-cancel" onclick="cancelTodoAdd()">キャンセル</button>
                  <button class="btn-save" onclick="addTodo()">
                    <span class="material-icons">add</span>
                    追加
                  </button>
                </div>
              </div>

              <!-- ToDoリスト -->
              <div class="todo-list" id="todoList">
                <!-- サンプルデータ -->
                <div class="todo-item" data-id="1">
                  <input type="checkbox" class="todo-checkbox" onchange="toggleTodo(1)">
                  <div class="todo-content">
                    <div class="todo-text">志望理由書の初稿を提出</div>
                    <div class="todo-deadline">
                      <span class="material-icons">schedule</span>
                      12/15まで
                    </div>
                  </div>
                  <div class="todo-actions">
                    <button class="todo-action-btn" onclick="editTodo(1)">
                      <span class="material-icons">edit</span>
                    </button>
                    <button class="todo-action-btn" onclick="deleteTodo(1)">
                      <span class="material-icons">delete</span>
                    </button>
                  </div>
                </div>

                <div class="todo-item completed" data-id="2">
                  <input type="checkbox" class="todo-checkbox" checked onchange="toggleTodo(2)">
                  <div class="todo-content">
                    <div class="todo-text done">英検の過去問3年分を解く</div>
                    <div class="todo-deadline">
                      <span class="material-icons">schedule</span>
                      12/10まで
                    </div>
                  </div>
                  <div class="todo-actions">
                    <button class="todo-action-btn" onclick="editTodo(2)">
                      <span class="material-icons">edit</span>
                    </button>
                    <button class="todo-action-btn" onclick="deleteTodo(2)">
                      <span class="material-icons">delete</span>
                    </button>
                  </div>
                </div>

                <div class="todo-item" data-id="3">
                  <input type="checkbox" class="todo-checkbox" onchange="toggleTodo(3)">
                  <div class="todo-content">
                    <div class="todo-text">面談前に自己分析シートを記入</div>
                    <div class="todo-deadline soon">
                      <span class="material-icons">schedule</span>
                      12/20まで
                    </div>
                  </div>
                  <div class="todo-actions">
                    <button class="todo-action-btn" onclick="editTodo(3)">
                      <span class="material-icons">edit</span>
                    </button>
                    <button class="todo-action-btn" onclick="deleteTodo(3)">
                      <span class="material-icons">delete</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // 理想スケジュールデータ
    // ============================================
    const idealScheduleData = {
      "高1": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3"],
        categories: [
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "3" },
          { id: "club", name: "部活/委員会", color: "blue", start: "4", end: "3" },
          { id: "study", name: "留学/語学学習", color: "cyan", start: "7", end: "8" },
          { id: "info", name: "総合型選抜情報収集", color: "green", start: "6", end: "6" },
          { id: "activity", name: "課外活動/ボランティア", color: "orange", start: "8", end: "2" },
          { id: "career", name: "志望校・進路検討", color: "purple", start: "9", end: "1" },
          { id: "self", name: "自己分析", color: "red", start: "10", end: "11" },
          { id: "research", name: "研究テーマ模索", color: "gray", start: "12", end: "3" }
        ],
        monthDetails: {
          "4": {
            title: "高校生活のスタート",
            subtitle: "目標設定と基盤づくり",
            description: "高校1年生の始まり。受験を見据えた長期的な目標を設定し、学業と課外活動の両立を目指す大切な時期。",
            tasks: [
              "評定平均の目標を設定する（最終目標4.0）",
              "英語資格の目標を設定する（最終目標英検準一級相当スコア）",
              "部活/委員会活動に励む"
            ]
          },
          "5": {
            title: "学習習慣の確立",
            subtitle: "継続と定着",
            description: "4月に立てた目標に向けて、日々の学習習慣を確立していく時期。",
            tasks: [
              "部活/委員会の継続",
              "評定/英語資格の学習継続"
            ]
          },
          "6": {
            title: "情報収集の開始",
            subtitle: "総合型選抜を知る",
            description: "総合型選抜という入試方式について情報を集め始める。早めの情報収集が将来の選択肢を広げる。",
            tasks: [
              "部活/委員会の継続",
              "評定/英語資格の学習継続",
              "総合型選抜の情報を収集する"
            ]
          },
          "7": {
            title: "夏の挑戦",
            subtitle: "新しい経験を積む",
            description: "夏休みを活用して、留学やスタディツアーなど新しい経験に挑戦するチャンス。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続"
            ]
          },
          "8": {
            title: "活動の幅を広げる",
            subtitle: "課外活動・ボランティアの開始",
            description: "夏休み後半は、課外活動やボランティアを始める絶好の機会。継続できる活動を見つけよう。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "ボランティア活動を始めてみる（継続する前提）"
            ]
          },
          "9": {
            title: "将来を考え始める",
            subtitle: "志望校・進路の検討開始",
            description: "2学期のスタート。自分の将来や志望校について考え始める時期。",
            tasks: [
              "志望校/入試方式/進路について考え始める",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "10": {
            title: "自己分析の開始",
            subtitle: "自分を知る",
            description: "自分の強み・弱み、興味・関心を整理し始める。総合型選抜に向けた自己理解の第一歩。",
            tasks: [
              "自己分析を開始する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "11": {
            title: "自己分析の継続",
            subtitle: "深掘りと言語化",
            description: "10月に始めた自己分析をさらに深め、自分の価値観や将来像を言語化していく。",
            tasks: [
              "自己分析を継続する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "12": {
            title: "研究テーマの模索開始",
            subtitle: "興味から研究へ",
            description: "自分の興味・関心から、将来の研究テーマにつながりそうな分野を探り始める。",
            tasks: [
              "自分の興味、個性から研究テーマを模索する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる"
            ]
          },
          "1": {
            title: "志望校情報の収集",
            subtitle: "募集要項を確認",
            description: "研究テーマの模索を続けながら、志望校の募集要項にも目を通し始める。",
            tasks: [
              "自分の興味、個性から研究テーマを模索する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "志望校や併願校の募集要項に目を通してみる"
            ]
          },
          "2": {
            title: "1年間の総まとめ",
            subtitle: "振り返りと準備",
            description: "高1の学習成果を振り返り、高2に向けた準備を進める。",
            tasks: [
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "自分の興味、個性から研究テーマを模索の継続"
            ]
          },
          "3": {
            title: "高2への準備",
            subtitle: "予備受験生としてのスタート",
            description: "高1で培った基盤をもとに、高2では本格的な受験準備が始まる。研究テーマの方向性を定めよう。",
            tasks: [
              "評定/英語資格の学習継続（高校1年で4後半獲得している）",
              "部活/委員会の継続",
              "自分の興味、個性から研究テーマを模索の継続 ー ある程度方向性が定まる",
              "高校2年生（予備受験生）の受験準備"
            ]
          }
        }
      },
      "高2": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2", "3"],
        categories: [
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "3" },
          { id: "club", name: "部活/委員会", color: "blue", start: "4", end: "8" },
          { id: "self", name: "自己分析・研究テーマ", color: "red", start: "4", end: "4" },
          { id: "research", name: "研究活動", color: "green", start: "5", end: "3" },
          { id: "activity", name: "課外活動", color: "orange", start: "7", end: "3" },
          { id: "study", name: "留学/語学学習", color: "cyan", start: "8", end: "8" },
          { id: "volunteer", name: "ボランティア", color: "purple", start: "8", end: "3" },
          { id: "school", name: "志望校・併願校決定", color: "gray", start: "10", end: "3" },
          { id: "docs", name: "書類準備", color: "red", start: "12", end: "3" },
          { id: "essay", name: "小論文対策", color: "blue", start: "2", end: "3" }
        ],
        monthDetails: {
          "4": {
            title: "高2スタート",
            subtitle: "継続と発展",
            description: "高2の始まり。高1で積み上げた基盤をもとに、各活動をさらに発展させていく。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "自己分析と研究テーマの模索継続"
            ]
          },
          "5": {
            title: "研究活動の本格化",
            subtitle: "受験を見据えた研究開始",
            description: "総合型選抜を見据え、本格的な研究活動を開始する重要な時期。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "6": {
            title: "研究の深化",
            subtitle: "テーマを掘り下げる",
            description: "研究活動を継続し、テーマをより深く掘り下げていく。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の継続",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "7": {
            title: "部活引退と新たな挑戦",
            subtitle: "時間の使い方が変わる",
            description: "部活を引退し、受験準備により多くの時間を使えるようになる転換期。課外活動も積極的に。",
            tasks: [
              "評定平均/英語資格の継続",
              "部活/委員会の引退",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "8": {
            title: "夏の集中期間",
            subtitle: "多角的な活動を展開",
            description: "夏休みを最大限活用。留学や語学学習、ボランティアなど、多方面での経験を積む。",
            tasks: [
              "留学/スタディツアー/語学学習に挑戦する",
              "評定/英語資格の学習継続",
              "部活/委員会の継続",
              "課外活動やイベントに参加してみる",
              "ボランティア活動を始めてみる（継続する前提）",
              "受験を見据えた研究活動の本格化"
            ]
          },
          "9": {
            title: "研究テーマの方向性決定",
            subtitle: "焦点を絞る",
            description: "これまでの研究活動をもとに、研究テーマの方向性を仮決定する重要な月。",
            tasks: [
              "研究テーマの方向性の仮決定",
              "評定平均/英語資格の継続",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "10": {
            title: "志望校の検討開始",
            subtitle: "出願先を絞り込む",
            description: "研究テーマと自分の興味をもとに、志望校・併願校を具体的に検討し始める。",
            tasks: [
              "評定平均/英語資格の継続",
              "志望校/併願校の仮決定",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "11": {
            title: "志望校の仮決定",
            subtitle: "出願戦略を立てる",
            description: "志望校・併願校を仮決定し、それぞれの入試に向けた準備計画を立てる。",
            tasks: [
              "評定平均/英語資格の継続",
              "志望校/併願校の仮決定",
              "受験を見据えた研究活動の本格化",
              "課外活動やイベントに参加してみる"
            ]
          },
          "12": {
            title: "インプットと自己分析の開始",
            subtitle: "出願条件の理解と達成準備",
            description: "この段階では、受験というより『自分を知る・制度を知る』ことが中心。まだ焦る必要はなく、総合型選抜・推薦入試がどんな試験かを正しく理解し、長期的に準備を進める土台を作る時期。",
            tasks: [
              "総合型選抜・学校推薦型選抜の制度や流れを学ぶ（基礎理解）",
              "各大学・学部の選抜方式や違いを調べる",
              "志望校や併願校の候補を複数挙げておく",
              "「やるべきこと」「やらないべきこと」を整理し、優先順位を決める",
              "総合型選抜全体のスケジュールを年間で把握",
              "自己分析を開始（価値観・性格・経験・将来像の言語化）",
              "評定平均を上げる努力（4.0以上が目標）",
              "英語資格取得（英検2級レベル）に向けた学習",
              "ボランティア・地域貢献・文化活動などの参加を開始（継続的に）"
            ]
          },
          "1": {
            title: "自己分析の深化と方向性の形成",
            subtitle: "",
            description: "12月に始めた自己分析をより深め、自分の軸や価値観を明確にする時期。同時に、出願条件（評定・資格）を確実に満たす努力を続ける。",
            tasks: [
              "総合型選抜・推薦入試の学習継続（出願条件の確認）",
              "志望校候補を広く調べ、併願可能な大学を比較検討",
              "自己分析を文章化し、自分史・ビジョン・強みを整理",
              "出願書類の書き方や種類を知る（志望理由書・活動報告書など）",
              "評定平均を上げる（主要科目の提出点を意識）",
              "英検・TOEFL・IELTSなど資格試験に向けて対策開始",
              "体験的活動を増やす（ボランティア・講演参加・地域活動など）",
              "長期的に続けられる社会活動・プロジェクトを決めておく"
            ]
          },
          "2": {
            title: "志望方向の具体化と書類準備の開始",
            subtitle: "",
            description: "大学や学部をある程度絞り、出願書類の下書きを開始。ここで「書く・調べる・比べる」を並行しながら、土台を固める。",
            tasks: [
              "志望校・併願校を仮決定（学部・学科レベルまで考える）",
              "自己分析をもとに初期の志望理由文を作成",
              "小論文の基礎問題を学び始める",
              "提出書類（自己PR・活動報告など）の作成を開始",
              "評定・資格の基準値を確実に満たす",
              "過去問請求・出願条件の問い合わせ（大学HP・資料請求）",
              "継続的な社会活動を維持し、体験を記録（報告書に活かす）"
            ]
          },
          "3": {
            title: "志望校仮決定と学習習慣の確立",
            subtitle: "",
            description: "春休みを活かして、学びと行動の両方をバランスよく整える。海外プログラムや新しい経験を積む良いタイミング。",
            tasks: [
              "志望校・学部・学科の仮決定（複数案を用意）",
              "英検などの資格試験を受験し、出願基準を満たす",
              "小論文の基礎問題を継続演習",
              "第一志望の提出書類の下書き完成",
              "短期留学・プログラム・ボランティアへの参加",
              "書類で使える活動実績や体験を蓄積"
            ]
          }
        }
      },
      "高3": {
        months: ["4", "5", "6", "7", "8", "9", "10", "11", "12", "1", "2"],
        categories: [
          { id: "research", name: "志望校リサーチ", color: "green", start: "4", end: "7" },
          { id: "grade", name: "評定・英語資格", color: "yellow", start: "4", end: "8" },
          { id: "docs", name: "書類準備", color: "orange", start: "4", end: "9" },
          { id: "essay", name: "小論文対策", color: "purple", start: "4", end: "11" },
          { id: "study", name: "研究活動", color: "cyan", start: "4", end: "9" },
          { id: "interview", name: "面接対策", color: "red", start: "9", end: "11" },
          { id: "apply", name: "出願作業", color: "gray", start: "8", end: "12" }
        ],
        monthDetails: {
          "4": {
            title: "受験スケジュールの確立と研究テーマ決定",
            subtitle: "",
            description: "ここから本格的に受験モードへ。研究テーマを決め、学びを学術的に深化させる。進捗管理を始め、全体を見える化する。",
            tasks: [
              "EQAO進捗管理シートで年間スケジュールを立案",
              "集団授業・交流会・保護者会に参加し意識を高める",
              "志望校・学部・学科を正式決定",
              "オープンキャンパスの予約・参加準備",
              "評定平均・英語資格を再確認（不足があれば補強）",
              "小論文の基礎演習継続",
              "志望理由書の初稿作成開始",
              "研究テーマを決定（興味分野×社会課題×学問領域）",
              "文献・論文・データ分析など調査を開始",
              "ボランティア・地域活動を継続",
              "専願・併願条件の確認・交渉（高校・大学に確認）"
            ]
          },
          "5": {
            title: "研究・書類作成の本格化",
            subtitle: "",
            description: "研究・分析・文献読解など、『自分の研究テーマ』を深める月。出願書類と研究テーマの整合性を取っていく。",
            tasks: [
              "文献・書籍・学術データを用いたリサーチ開始",
              "研究ノート・読書記録をまとめる",
              "小論文の演習を継続（要約・意見・構成練習）",
              "志望理由書を第2稿に更新（根拠を補強）",
              "活動報告書・自己PR文の精度を上げる",
              "評定平均・英語資格の追い込み（最終測定へ）",
              "研究やボランティア活動を習慣化"
            ]
          },
          "6": {
            title: "研究深化と推薦状準備の開始",
            subtitle: "",
            description: "推薦状の依頼を正式に始めるタイミング。研究活動・課外活動・小論文の応用力を強化。",
            tasks: [
              "研究テーマに基づくフィールドワーク・アンケート等を実施",
              "調査報告書・仮レポートを作成",
              "小論文の応用問題演習に移行",
              "出願書類（第一志望）の内容を精査・加筆修正",
              "高校教員に推薦状作成依頼を正式に申し出る",
              "研究成果をまとめ、面接・書類両方で活かせる形に整える"
            ]
          },
          "7": {
            title: "学校連携・書類整理の最終段階",
            subtitle: "",
            description: "いよいよ校内手続きが動き出す。調査書・推薦状・証明書など、出願に必要な全書類を整える重要な月。",
            tasks: [
              "部活動引退・受験専念",
              "志望校・併願校リストを学校に正式提示",
              "調査書記載内容を相談・確認",
              "新年度の大学募集要項を最新版に更新",
              "小論文の応用演習を継続（記述＋口頭説明）",
              "推薦状依頼を完了・内容確認",
              "各種賞状・検定証・活動証明書を整理・コピー",
              "調査書発行願いを提出（大学ごとに申請）",
              "出願日程と学校行事を照合し、重複を回避"
            ]
          },
          "8": {
            title: "夏休み：活動・資格・書類の総仕上げ",
            subtitle: "",
            description: "最も重要な集中特訓期間。EQAOイベントや模試・合宿を活用し、実践力を磨く。",
            tasks: [
              "部活動完全引退・受験一本化",
              "志望理由書以外の書類（活動報告書・課題レポート等）を仕上げる",
              "調査書・証明書の発行・照合作業を完了",
              "英語資格原本照合（高校・大学両方で確認）",
              "指定校推薦の出願判断を確定",
              "研究活動・ボランティア・プログラム参加を集中実施",
              "EQAO CAMP／STUDY TOURなど合宿・研修参加",
              "小論文の過去問演習を開始",
              "提出書類（第一志望）を完成・最終確認",
              "Web出願登録開始（不備チェック）"
            ]
          },
          "9": {
            title: "出願本番と一次審査突破期",
            subtitle: "",
            description: "ついに出願開始。書類提出・一次審査・模試・面接対策が同時進行。焦らず確実に、期限管理が命。",
            tasks: [
              "出願Web登録・郵送作業を本格化",
              "指定校推薦結果発表（一次審査）",
              "小論文の過去問演習を本格化",
              "面接対策を開始（書類からの想定質問100問）",
              "レポート課題 着手開始",
              "課外活動・ボランティアの最終整理",
              "大学から受験番号発行",
              "EQAO出願サポートを受ける",
              "EQAO模試を受験（本番シミュレーション）"
            ]
          },
          "10": {
            title: "総合型選抜ピーク期／二次試験対策本格化",
            subtitle: "",
            description: "最も緊張感の高い月。面接・小論文の最終仕上げ。EQAO模試と面接練習を最大限活用する。",
            tasks: [
              "出願継続（残り大学対応）",
              "EQAO模試本格化／結果分析フィードバック",
              "小論文過去問・応用問題演習",
              "二次試験（面接・小論文）本格練習",
              "EQAO出願サポート・書類最終添削",
              "一次審査結果の確認と再出願準備",
              "面接100問＋書類質問100問の想定練習",
              "大学から受験番号通知"
            ]
          },
          "11": {
            title: "学校推薦型選抜出願・結果ラッシュ期",
            subtitle: "",
            description: "公募推薦と総合型選抜の結果・試験が重なる時期。「合格確定者」と「最終試験者」に分かれ動く。",
            tasks: [
              "公募推薦の出願開始（高校との調整）",
              "二次試験（小論文・面接）本格化",
              "総合型選抜の結果発表開始（順次）",
              "入学手続き関連（合格者向け）を進行",
              "EQAO模試最終実施／最終対策",
              "出願サポート継続（最後の大学まで）",
              "面接練習継続／自己表現力の最終確認",
              "卒塾手続き開始（合格者より順次）"
            ]
          },
          "12": {
            title: "結果発表・卒塾・次のステージへ",
            subtitle: "",
            description: "結果が出揃い始める。受験の総仕上げと次への準備を同時に行う。「合格＝ゴール」ではなく「スタート」として捉える。",
            tasks: [
              "総合型・公募推薦の最終結果発表",
              "第二期募集・追加出願対応者の書類準備",
              "入学手続き・入学金納入・必要書類提出",
              "EQAO PARTY FOR NEXT STAGE（卒塾式）開催",
              "後輩向けメッセージ・インタビュー協力"
            ]
          },
          "1": {
            title: "次への選択と切り替え",
            subtitle: "",
            description: "合格者は入学準備、不合格者は一般・海外・再挑戦を決定する。精神面・方向性を整える重要な時期。",
            tasks: [
              "一般入試への切り替え・対策開始",
              "併願校の入試対策実施",
              "海外大学進学の検討",
              "浪人・再挑戦の判断",
              "大学側から課される入学前課題の対応",
              "各種手続き・書類最終確認"
            ]
          },
          "2": {
            title: "共通テスト利用・後期募集対応",
            subtitle: "",
            description: "最終追い込み。国公立や私立の後期型、共通テスト利用型の対策。最後まで学び続ける姿勢を保つ。",
            tasks: [
              "共通テスト利用の国公立型選抜対策",
              "総合型選抜の2期・3期募集出願",
              "一般入試・後期入試の準備",
              "EQAO講師・メンターとの面談で進路確定"
            ]
          }
        }
      }
    };

    // カテゴリの色と名前のマッピング
    const categoryInfo = {
      self: { name: "自己分析・自己理解", color: "blue" },
      research: { name: "志望校リサーチ", color: "green" },
      grade: { name: "評定・英語資格", color: "yellow" },
      docs: { name: "書類準備", color: "orange" },
      essay: { name: "小論文対策", color: "purple" },
      activity: { name: "課外活動・ボランティア", color: "cyan" },
      study: { name: "研究活動", color: "cyan" },
      interview: { name: "面接対策", color: "red" },
      apply: { name: "出願作業", color: "gray" }
    };

    // 状態
    let selectedGrade = "高2";
    let selectedMonth = null;

    // ============================================
    // 私のスケジュール関連
    // ============================================
    
    // サンプルデータ（後でAPIから取得する想定）
    let monthlyGoals = {
      "12": "・英検準1級の過去問を週2回解く\n・志望理由書の初稿を書き始める\n・オープンキャンパスの日程を調べる\n・ボランティア活動に月2回参加"
    };

    let todos = [
      { id: 1, text: "志望理由書の初稿を提出", deadline: "2025-12-15", completed: false, month: "12" },
      { id: 2, text: "英検の過去問3年分を解く", deadline: "2025-12-10", completed: true, month: "12" },
      { id: 3, text: "面談前に自己分析シートを記入", deadline: "2025-12-20", completed: false, month: "12" }
    ];

    let nextTodoId = 4;

    // 今月やること: 編集モード切り替え
    function toggleGoalsEdit() {
      const display = document.getElementById('goalsDisplay');
      const edit = document.getElementById('goalsEdit');
      const btn = document.getElementById('goalsEditBtn');
      const textarea = document.getElementById('goalsTextarea');
      const goalsText = document.getElementById('monthlyGoalsText');

      if (display.style.display !== 'none') {
        // 編集モードに切り替え
        textarea.value = goalsText.textContent.trim();
        display.style.display = 'none';
        edit.style.display = 'block';
        btn.innerHTML = '<span class="material-icons">close</span>閉じる';
        textarea.focus();
      } else {
        // 表示モードに戻す
        display.style.display = 'block';
        edit.style.display = 'none';
        btn.innerHTML = '<span class="material-icons">edit</span>編集';
      }
    }

    // 今月やること: 保存
    function saveGoals() {
      const textarea = document.getElementById('goalsTextarea');
      const goalsText = document.getElementById('monthlyGoalsText');
      const month = selectedMonth || '12';

      const newGoals = textarea.value.trim();
      monthlyGoals[month] = newGoals;
      
      if (newGoals) {
        goalsText.textContent = newGoals;
      } else {
        goalsText.innerHTML = '<div class="monthly-goals-empty"><span class="material-icons">edit_note</span><p>まだ入力されていません</p></div>';
      }

      // 編集モードを閉じる
      toggleGoalsEdit();

      // TODO: ここでAPIに保存する
      console.log('Saved goals for month', month, ':', newGoals);
    }

    // 今月やること: キャンセル
    function cancelGoalsEdit() {
      toggleGoalsEdit();
    }

    // ToDo: 追加フォーム表示切り替え
    function toggleTodoForm() {
      const form = document.getElementById('todoAddForm');
      const btn = document.getElementById('todoAddBtn');

      if (form.classList.contains('hidden')) {
        form.classList.remove('hidden');
        btn.innerHTML = '<span class="material-icons">close</span>閉じる';
        document.getElementById('todoInput').focus();
        // 日付のデフォルト値を設定（今月末）
        const now = new Date();
        const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        document.getElementById('todoDateInput').value = lastDay.toISOString().split('T')[0];
      } else {
        form.classList.add('hidden');
        btn.innerHTML = '<span class="material-icons">add</span>追加';
        document.getElementById('todoInput').value = '';
      }
    }

    // ToDo: 追加
    function addTodo() {
      const input = document.getElementById('todoInput');
      const dateInput = document.getElementById('todoDateInput');
      const month = selectedMonth || '12';

      const text = input.value.trim();
      const deadline = dateInput.value;

      if (!text) {
        alert('やることを入力してください');
        input.focus();
        return;
      }

      if (!deadline) {
        alert('期限を設定してください');
        dateInput.focus();
        return;
      }

      const newTodo = {
        id: nextTodoId++,
        text: text,
        deadline: deadline,
        completed: false,
        month: month
      };

      todos.push(newTodo);
      renderTodos();
      toggleTodoForm();

      // TODO: ここでAPIに保存する
      console.log('Added todo:', newTodo);
    }

    // ToDo: 追加キャンセル
    function cancelTodoAdd() {
      toggleTodoForm();
    }

    // ToDo: 完了状態切り替え
    function toggleTodo(id) {
      const todo = todos.find(t => t.id === id);
      if (todo) {
        todo.completed = !todo.completed;
        renderTodos();
        updateProgress();

        // TODO: ここでAPIに保存する
        console.log('Toggled todo:', id, 'completed:', todo.completed);
      }
    }

    // ToDo: 編集
    function editTodo(id) {
      const todo = todos.find(t => t.id === id);
      if (!todo) return;

      const newText = prompt('やることを編集:', todo.text);
      if (newText !== null && newText.trim()) {
        todo.text = newText.trim();

        const newDeadline = prompt('期限を編集 (YYYY-MM-DD):', todo.deadline);
        if (newDeadline !== null && newDeadline.match(/^\d{4}-\d{2}-\d{2}$/)) {
          todo.deadline = newDeadline;
        }

        renderTodos();

        // TODO: ここでAPIに保存する
        console.log('Edited todo:', todo);
      }
    }

    // ToDo: 削除
    function deleteTodo(id) {
      if (confirm('このToDoを削除しますか？')) {
        todos = todos.filter(t => t.id !== id);
        renderTodos();
        updateProgress();

        // TODO: ここでAPIに削除リクエストする
        console.log('Deleted todo:', id);
      }
    }

    // ToDo: 描画
    function renderTodos() {
      const container = document.getElementById('todoList');
      const month = selectedMonth || '12';
      const monthTodos = todos.filter(t => t.month === month);

      if (monthTodos.length === 0) {
        container.innerHTML = `
          <div class="todo-empty">
            <span class="material-icons">task_alt</span>
            <p>この月のToDoはありません</p>
          </div>
        `;
        return;
      }

      // 期限順にソート（未完了を先に）
      monthTodos.sort((a, b) => {
        if (a.completed !== b.completed) return a.completed ? 1 : -1;
        return new Date(a.deadline) - new Date(b.deadline);
      });

      let html = '';
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      monthTodos.forEach(todo => {
        const deadlineDate = new Date(todo.deadline);
        const diffDays = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));
        
        let deadlineClass = '';
        if (diffDays < 0 && !todo.completed) {
          deadlineClass = 'overdue';
        } else if (diffDays <= 3 && !todo.completed) {
          deadlineClass = 'soon';
        }

        const deadlineText = formatDeadline(todo.deadline);

        html += `
          <div class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
            <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${todo.id})">
            <div class="todo-content">
              <div class="todo-text ${todo.completed ? 'done' : ''}">${escapeHtml(todo.text)}</div>
              <div class="todo-deadline ${deadlineClass}">
                <span class="material-icons">schedule</span>
                ${deadlineText}
              </div>
            </div>
            <div class="todo-actions">
              <button class="todo-action-btn" onclick="editTodo(${todo.id})">
                <span class="material-icons">edit</span>
              </button>
              <button class="todo-action-btn" onclick="deleteTodo(${todo.id})">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // 期限フォーマット
    function formatDeadline(dateStr) {
      const date = new Date(dateStr);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      return `${month}/${day}まで`;
    }

    // HTMLエスケープ
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, function(match) {
        const escape = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        };
        return escape[match];
      });
    }

    // 進捗更新
    function updateProgress() {
      const month = selectedMonth || '12';
      const monthTodos = todos.filter(t => t.month === month);
      
      if (monthTodos.length === 0) {
        document.getElementById('progressPercent').textContent = '0%';
        document.getElementById('progressBar').style.width = '0%';
        return;
      }

      const completed = monthTodos.filter(t => t.completed).length;
      const percent = Math.round((completed / monthTodos.length) * 100);
      
      document.getElementById('progressPercent').textContent = `${percent}%`;
      document.getElementById('progressBar').style.width = `${percent}%`;
    }

    // 月の目標を読み込み
    function loadMonthlyGoals(month) {
      const goalsText = document.getElementById('monthlyGoalsText');
      const goals = monthlyGoals[month];

      if (goals) {
        goalsText.textContent = goals;
      } else {
        goalsText.innerHTML = '<div class="monthly-goals-empty"><span class="material-icons">edit_note</span><p>まだ入力されていません<br>「編集」ボタンから入力できます</p></div>';
      }
    }

    // 私のスケジュールから学年選択
    function selectGradeFromMySchedule(grade) {
      // 上の学年ボタンも更新
      selectGrade(grade);
      
      // 下の学年ボタンも更新
      updateMiniGradeButtons(grade);
      
      // 月のドロップダウンを更新
      updateMonthSelect(grade);
    }

    // 私のスケジュールから月選択
    function selectMonthFromMySchedule(month) {
      selectMonth(month);
    }

    // 下の学年ボタンを更新
    function updateMiniGradeButtons(grade) {
      document.querySelectorAll('.mini-grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
    }

    // 月のドロップダウンを更新
    function updateMonthSelect(grade) {
      const select = document.getElementById('monthSelect');
      const data = idealScheduleData[grade];
      
      if (!data || !data.months) {
        select.innerHTML = '<option value="">-</option>';
        return;
      }

      let html = '';
      data.months.forEach(m => {
        const selected = m === selectedMonth ? 'selected' : '';
        html += `<option value="${m}" ${selected}>${m}月</option>`;
      });
      select.innerHTML = html;
    }

    // 月選択ドロップダウンの値を更新（上から選択された時用）
    function updateMonthSelectValue(month) {
      const select = document.getElementById('monthSelect');
      if (select) {
        select.value = month;
      }
    }

    // 初期化
    document.addEventListener('DOMContentLoaded', function() {
      try {
        setNavUserName();
        
        // 下の学年ボタンを初期化
        updateMiniGradeButtons(selectedGrade);
        
        // 月のドロップダウンを初期化
        updateMonthSelect(selectedGrade);
        
        renderGanttChart();
        
        // 現在の月を初期選択
        const now = new Date();
        const currentMonth = String(now.getMonth() + 1);
        const data = idealScheduleData[selectedGrade];
        if (data && data.months && data.months.includes(currentMonth)) {
          selectMonth(currentMonth);
        } else if (data && data.months && data.months.length > 0) {
          selectMonth(data.months[0]);
        }
      } catch (e) {
        console.error('Initialization error:', e);
      }
    });

    // 学年選択
    function selectGrade(grade) {
      selectedGrade = grade;
      document.querySelectorAll('.grade-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.grade === grade);
      });
      
      // 下の学年ボタンも更新
      updateMiniGradeButtons(grade);
      
      // 月のドロップダウンを更新
      updateMonthSelect(grade);
      
      // ガントチャート再描画
      renderGanttChart();
      
      // 最初の月を選択
      const data = idealScheduleData[grade];
      if (data.months.length > 0) {
        selectMonth(data.months[0]);
      } else {
        document.getElementById('monthDetail').classList.remove('show');
      }
    }

    // ガントチャート描画
    function renderGanttChart() {
      const data = idealScheduleData[selectedGrade];
      const container = document.getElementById('ganttChart');

      if (!data || !data.months || data.months.length === 0) {
        container.innerHTML = '<div class="todo-empty"><span class="material-icons">construction</span><p>準備中です</p></div>';
        return;
      }

      const months = data.months;
      const categories = data.categories || [];

      // 現在の月を取得
      const now = new Date();
      const currentMonth = String(now.getMonth() + 1);

      // ヘッダー（月）
      let html = '<div class="gantt-header">';
      html += '<div class="gantt-label-header">カテゴリ</div>';
      html += '<div class="gantt-months">';
      months.forEach(m => {
        const monthLabel = m + '月';
        const isCurrent = m === currentMonth;
        const isSelected = m === selectedMonth;
        let classes = 'gantt-month';
        if (isCurrent) classes += ' current';
        if (isSelected) classes += ' selected';
        html += `<div class="${classes}" onclick="selectMonth('${m}')">${monthLabel}</div>`;
      });
      html += '</div></div>';

      // 各カテゴリ行
      categories.forEach(cat => {
        const startIdx = months.indexOf(cat.start);
        const endIdx = months.indexOf(cat.end);
        
        // バーの位置と幅を計算（パーセント）
        const barLeft = (startIdx / months.length) * 100;
        const barWidth = ((endIdx - startIdx + 1) / months.length) * 100;
        
        html += '<div class="gantt-row">';
        html += `<div class="gantt-category"><div class="category-color bg-${cat.color}"></div>${cat.name}</div>`;
        html += '<div class="gantt-bars">';
        
        // セル（グリッド線用）
        months.forEach(m => {
          html += '<div class="gantt-cell"></div>';
        });
        
        // バー（連続した1本）
        if (startIdx !== -1 && endIdx !== -1) {
          html += `<div class="gantt-bar color-${cat.color}" style="left: ${barLeft}%; width: ${barWidth}%;"></div>`;
        }
        
        html += '</div></div>';
      });

      container.innerHTML = html;
    }

    // 月が範囲内かチェック
    function isMonthInRange(month, start, end, monthOrder) {
      const monthIdx = monthOrder.indexOf(month);
      const startIdx = monthOrder.indexOf(start);
      const endIdx = monthOrder.indexOf(end);
      
      if (monthIdx === -1 || startIdx === -1 || endIdx === -1) return false;
      return monthIdx >= startIdx && monthIdx <= endIdx;
    }

    // 月選択
    function selectMonth(month) {
      selectedMonth = month;
      
      // ガントチャートのヘッダー更新
      document.querySelectorAll('.gantt-month').forEach(el => {
        const m = el.textContent.replace('月', '');
        el.classList.toggle('selected', m === month);
      });

      // 詳細カード表示
      renderMonthDetail(month);
      
      // 私のスケジュール: 月ドロップダウン更新
      updateMonthSelectValue(month);
      
      // 私のスケジュール: 目標を読み込み
      loadMonthlyGoals(month);
      
      // 私のスケジュール: ToDoリスト更新
      renderTodos();

      // 編集モードを閉じる
      const display = document.getElementById('goalsDisplay');
      const edit = document.getElementById('goalsEdit');
      const btn = document.getElementById('goalsEditBtn');
      if (edit && edit.style.display !== 'none') {
        display.style.display = 'block';
        edit.style.display = 'none';
        btn.innerHTML = '<span class="material-icons">edit</span>編集';
      }
      
      // ToDo追加フォームを閉じる
      const form = document.getElementById('todoAddForm');
      const addBtn = document.getElementById('todoAddBtn');
      if (form && !form.classList.contains('hidden')) {
        form.classList.add('hidden');
        addBtn.innerHTML = '<span class="material-icons">add</span>追加';
      }
    }

    // 月詳細カード描画
    function renderMonthDetail(month) {
      const data = idealScheduleData[selectedGrade];
      const detail = data.monthDetails[month];
      const container = document.getElementById('monthDetail');

      if (!detail) {
        container.classList.remove('show');
        return;
      }

      let html = '<div class="month-detail-header">';
      html += `<div class="month-badge">${selectedGrade} ${month}月</div>`;
      html += `<div class="month-title">${detail.title}</div>`;
      html += '</div>';

      if (detail.description) {
        html += `<div class="month-description">${detail.description}</div>`;
      }

      if (detail.tasks && detail.tasks.length > 0) {
        html += '<div class="tasks-toggle" id="tasksToggle">';
        html += '<div class="tasks-toggle-header" onclick="toggleTasks()">';
        html += '<div class="tasks-toggle-title"><span class="material-icons">check_circle</span>具体的な行動（' + detail.tasks.length + '件）</div>';
        html += '<span class="material-icons tasks-toggle-icon">expand_more</span>';
        html += '</div>';
        html += '<div class="tasks-toggle-content">';
        html += '<div class="month-tasks">';
        detail.tasks.forEach(task => {
          html += `<div class="month-task-item"><span class="material-icons">check</span><span>${task}</span></div>`;
        });
        html += '</div>';
        html += '</div>';
        html += '</div>';
      }

      container.innerHTML = html;
      container.classList.add('show');
    }

    // タスクトグル
    function toggleTasks() {
      const toggle = document.getElementById('tasksToggle');
      if (toggle) {
        toggle.classList.toggle('open');
      }
    }

    // Todoリスト描画（仮実装）
    // ナビゲーション
    function openNav() {
      document.getElementById('navMenu').classList.add('open');
      document.getElementById('navOverlay').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeNav() {
      document.getElementById('navMenu').classList.remove('open');
      document.getElementById('navOverlay').classList.remove('open');
      document.body.style.overflow = '';
    }

    function doLogout() {
      localStorage.removeItem('eqao_loggedIn');
      localStorage.removeItem('eqao_studentId');
      localStorage.removeItem('eqao_studentName');
      localStorage.removeItem('eqao_password');
      window.location.href = 'index.html';
    }

    function setNavUserName() {
      const studentName = localStorage.getItem('eqao_studentName');
      const navUserName = document.getElementById('navUserName');
      if (navUserName) {
        navUserName.textContent = studentName || '';
      }
    }
  </script>
</body>
</html>
